<!DOCTYPE html>
<html lang="en" class="wf-firasans-n4-active wf-active">
	<head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Enable responsiveness on mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    
    
    <meta name="generator" content="Hugo 0.40.3" />
    
    <title>Preventing traffic accidents with Artificial Intelligence. &middot; Ahmed Lahlou Mimi</title>
    <meta content="Preventing traffic accidents with Artificial Intelligence. - Ahmed Lahlou Mimi" property="og:title">
    <meta content=" - " property="og:description">
    <!-- CSS -->
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i|Roboto+Mono:300,300i,400,400i" rel="stylesheet">
    <link rel="stylesheet" href="https://ahmedlahloum.github.io/css/print.css" media="print">
    <link rel="stylesheet" href="https://ahmedlahloum.github.io/css/poole.css">
    <link rel="stylesheet" href="https://ahmedlahloum.github.io/css/hyde.css">
    <!-- Font-Awesome -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.10/js/all.js" integrity="sha384-slN8GvtUJGnv6ca26v8EzVaR9DC58QEwsIk9q1QXdCU8Yu8ck/tL/5szYlBbqmS+" crossorigin="anonymous"></script>
    <!-- highlight.js-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <!-- Customised CSS -->
    <link rel="stylesheet" href="https://ahmedlahloum.github.io/css/custom.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

	</head>
    <body>
        <div class="sidebar">
	<div class="container text-center sidebar-sticky">
		<div class="sidebar-about text-center">
			<a href="https://ahmedlahloum.github.io/"><h1 class="brand">Ahmed Lahlou Mimi</h1></a>
			 <img src="/img/autor.jpg" alt="Author Image" class="img-circle headshot center"> 
			<p class="lead">
				 Student in Data Science. 
			</p>
		</div>
		
<div>
	<ul class="sidebar-nav">
		
		
				<li>
					<a href="/posts/"> <span>Posts</span></a>
				</li>
		</li>
	</ul>
</div>

        <p>
		<section class="row text-center">
	
	<a href="https://twitter.com/LahlouMimiAhme1"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	&nbsp;<a href="https://linkedin.com/in/ahmed-lahlou-mimi-6ba924122"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	&nbsp;<a href="https://stackoverflow.com/users/9160548"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	&nbsp;<a href="mailto:ahmed.lahlou-mimi@student.ecp.fr"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
</section>

        </p>
	</div>
	<div>
	</div>
</div>

        <div class="content container">
            <div class="post">
  <h1>Preventing traffic accidents with Artificial Intelligence.</h1>
  
  <div class="col-sm-12 col-md-12">
    <span class="text-left post-date meta">
            
       
        <i class="fas fa-calendar-alt"></i> Jun 13, 2018
      
      
        
        
            in
            
            
                <a class="meta" href="/categories/code">CODE</a>
                ,
            
                <a class="meta" href="/categories/tutorials">TUTORIALS</a>
                
            
        
      
      
      
        
        
            <br/>
             <i class="fas fa-tags"></i>
            
            <a class="meta" href="/tags/deep-learning">deep learning</a> 
        
            <a class="meta" href="/tags/keras">keras</a> 
        
            <a class="meta" href="/tags/lstm">lstm</a> 
        
            <a class="meta" href="/tags/plotly">plotly</a> 
        
            <a class="meta" href="/tags/prophet">prophet</a> 
        
            <a class="meta" href="/tags/python">python</a> 
        
            <a class="meta" href="/tags/time-series">time series</a>
        
      
      
      <br/>
      <i class="fas fa-clock"></i> 73 min read 
      </span>  
  </div>    
  
  <h2 id="introduction">Introduction</h2>

<p><img src="/accidents/traffic.jpg" style="width: 600px;"></p>

<p>In the last years, Machine learning has found its place in several fields of application of our daily life.</p>

<p>Personally, I strongly believe that artificial intelligence can be used for good purposes, and even to save lives. I recently came across this very interesting <a href = 'https://apolitical.co/solution_article/las-vegas-forging-big-data-partnership-predict-traffic-accidents/'> article </a>, which talks about a Machine Learning project whose goal is to predict the number of accidents over the next two hours in Los Angeles to improve road traffic management.</p>

<p>I found this idea very promising and with great potential for all the big cities of the world, so I decided to apply it to the city where I live currently, Paris. I started by gathering all the possible data made available by the government on this site. I cleaned the data and put it together in one dataset, then translated it and made it available on Kaggle so that anyone interested in this type of project could participate.</p>

<p></p>

<p>As a result, a lot of very interesting analyzes have been done by other Data Scientists that describe the data we have quite well. You can find those analyzes along with the datasets and their full description on this <a href = 'https://www.kaggle.com/ahmedlahlou/accidents-in-france-from-2005-to-2016'>link</a>.</p>

<p>For this article, no need to redo these type of study, I will work directly on the time series part of the problem where I will model the number of accidents in Paris per day, using several methods: GAMs (Prophet by Facebook), LSTMs etc.
the purpose of such a model is to be able to predict when conditions will be more prone to accidents, and therefore take preventive measures. We will even try to locate more precisely future accidents in order to provide rapid care for example.</p>

<p>I hope that this contribution will gain more popularity and be the cause of a bigger project with results as promising as in Los Angeles.</p>

<p>We will start by construction the time series, then we will analyze it using various statistical and visual tools. After that, we will implement a Naïve model that we will use as a comparison basis for other more sophisticated models : GAMs: Generalized additive models (Facebook’s Prophet library) and LSTMs with Keras.</p>

<h2 id="time-series-construction-analysis">Time Series Construction &amp; Analysis:</h2>

<pre><code class="language-python">%pylab inline

import warnings
warnings.filterwarnings('ignore')

import pandas as pd

import seaborn as sns
sns.set()

from workalendar.europe import France
from statsmodels.tsa.stattools import adfuller


from statsmodels.tsa.stattools import acf, pacf
from copy import deepcopy


from datetime import datetime

from plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot
import plotly.graph_objs as go
init_notebook_mode(connected=True)
</code></pre>

<pre><code>Populating the interactive namespace from numpy and matplotlib
</code></pre>

<script>requirejs.config({paths: { 'plotly': ['https://cdn.plot.ly/plotly-latest.min']},});if(!window.Plotly) {{require(['plotly'],function(plotly) {window.Plotly=plotly;});}}</script>

<p>Below is a set of useful function that we will use in the first part. You can find their description in their code.</p>

<pre><code class="language-python"># Functions :

&quot;&quot;&quot;Plots a simple serie in PLOTLY.&quot;&quot;&quot;
def jsplot(dates , values , mode = 'lines+markers'):

    data = [go.Scatter(
              x=dates,
              y=values,
              mode = mode)]

    iplot(data)
    
    
&quot;&quot;&quot;Plot multiple series in PLOTLY:&quot;&quot;&quot;
def jsplot_multiple(dates , values , mode = 'lines+markers'):

    data = []
    for col in values.columns:
        splot = go.Scatter(
                        x=dates,
                        y=values[col],
                        mode = mode,
                        name = str(col) )
        data.append(splot)

    iplot(data)
    
    
&quot;&quot;&quot;Function that test the stationarity of a Time series by
computing and plotting rolling statistics, and then by performing
An augmented Dickey Fuller test.&quot;&quot;&quot; 

def test_stationarity(timeseries , window = 50):
    #Determing rolling statistics
    rolmean = pd.rolling_mean(timeseries, window=window)
    rolstd = pd.rolling_std(timeseries, window=window)

    #Plot rolling statistics:
    fig = plt.figure(figsize=(12, 8))
    orig = plt.plot(timeseries,label='Original')
    mean = plt.plot(rolmean, color='red' , label='Rolling Mean')
    std = plt.plot(rolstd, label = 'Rolling Std')
    plt.legend(loc='best')
    plt.title('Rolling Mean &amp; Standard Deviation')
    plt.show()
    
    #Perform Dickey-Fuller test:
    print('Results of Dickey-Fuller Test:')
    try:
        dftest = adfuller(timeseries.dropna(), autolag='AIC')
        dfoutput = pd.Series(dftest[0:4], index=['Test Statistic','p-value','#Lags Used','Number of Observations Used'])
        for key,value in dftest[4].items():
            dfoutput['Critical Value (%s)'%key] = value
        print(dfoutput) 
    except:
        print('test failed')
        

        
&quot;&quot;&quot;Performs Acp - Pacp Analysis on a time serie.&quot;&quot;&quot;
def acp_pacp(timeseries , nlags = 30):
    lag_acf = acf(timeseries, nlags=nlags)
    lag_pacf = pacf(timeseries, nlags=nlags, method='ols')
    
    print('lag_acf')
    fig = plt.figure(figsize=(7 , 6))

    sns.barplot( np.arange(len(lag_acf)) , lag_acf , palette = 'GnBu_d')
    
    
    plt.axhline(y=0,linestyle='--',color='gray')
    plt.axhline(y=-1.96/np.sqrt(len(timeseries)),linestyle='--',color='gray')
    plt.axhline(y=1.96/np.sqrt(len(timeseries)),linestyle='--',color='gray')

    plt.show()
    print('lag_pacf')
    fig = plt.figure(figsize=(7, 6))

    sns.barplot( np.arange(len(lag_pacf)) , lag_pacf , palette = 'GnBu_d')

    plt.axhline(y=0,linestyle='--',color='gray')
    plt.axhline(y=-1.96/np.sqrt(len(timeseries)),linestyle='--',color='gray')
    plt.axhline(y=1.96/np.sqrt(len(timeseries)),linestyle='--',color='gray')

    plt.show()
</code></pre>

<h3 id="importing-data">Importing data:</h3>

<pre><code class="language-python">caracs = pd.read_csv('caracteristics.csv' , encoding = 'latin-1') # Caracteristics of the accidents.
places = pd.read_csv('places.csv' ) # Places features.
users = pd.read_csv('users.csv' ) # Users involved in the accdient features.
vehicles = pd.read_csv('vehicles.csv') # Vehicles features.
</code></pre>

<p>We also import all the holidays in France between 2005 and 2017. This information is valuable since it generally affects road traffic and conductors’ behavior.</p>

<pre><code class="language-python">#Holidays in France :
cal = France()
holidays = []
for year in range(2005,2017):
    holidays.extend(cal.holidays(year))
    
holidays = pd.DataFrame(holidays , columns = ['ds' , 'holiday'])
</code></pre>

<h3 id="time-series-construction">Time series construction:</h3>

<p>We construct the time series by counting the number of accidents per day in Paris between 2005 and 2017. And then we visualize the results in Plotly to see if we can already notify some trends or patterns.</p>

<pre><code class="language-python">dtsers = caracs.loc[(caracs.dep.isin([750])) , ['Num_Acc' , 'jour' , 'mois' , 'an']]

dtsers['day'] = pd.to_datetime((2000+dtsers.an)*10000+dtsers.mois*100+dtsers.jour,format='%Y%m%d')
dtsers.drop(['jour' , 'mois' , 'an'] , axis = 1 ,inplace = True)


dtsers = dtsers.groupby('day' , as_index = False).count()

# Dummy Variable Holiday
dtsers['isholiday'] = 0
dtsers.loc[dtsers.day.isin(holidays.ds) , 'isholiday'] = 1

# Week day and month
dtsers['weekday'] = dtsers.day.dt.weekday
dtsers['month'] = dtsers.day.dt.month
# Dummification
dtsers = pd.get_dummies(dtsers , columns = ['weekday' , 'month'])

print(' the 3 last years of the time series:')
jsplot(dtsers.day[3500:] , dtsers.Num_Acc[3500:] )
</code></pre>

<pre><code> the 3 last years of the time series:
</code></pre>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<div>
<html><head><meta charset="utf-8" /></head><body><div id="21d4d405-eb35-4707-9fda-7393d0b88ffb" style="height: 100%; width: 100%;" class="plotly-graph-div"></div><script type="text/javascript">window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("21d4d405-eb35-4707-9fda-7393d0b88ffb", [{"type": "scatter", "x": ["2014-08-02", "2014-08-03", "2014-08-04", "2014-08-05", "2014-08-06", "2014-08-07", "2014-08-08", "2014-08-09", "2014-08-10", "2014-08-11", "2014-08-12", "2014-08-13", "2014-08-14", "2014-08-15", "2014-08-16", "2014-08-17", "2014-08-18", "2014-08-19", "2014-08-20", "2014-08-21", "2014-08-22", "2014-08-23", "2014-08-24", "2014-08-25", "2014-08-26", "2014-08-27", "2014-08-28", "2014-08-29", "2014-08-30", "2014-08-31", "2014-09-01", "2014-09-02", "2014-09-03", "2014-09-04", "2014-09-05", "2014-09-06", "2014-09-07", "2014-09-08", "2014-09-09", "2014-09-10", "2014-09-11", "2014-09-12", "2014-09-13", "2014-09-14", "2014-09-15", "2014-09-16", "2014-09-17", "2014-09-18", "2014-09-19", "2014-09-20", "2014-09-21", "2014-09-22", "2014-09-23", "2014-09-24", "2014-09-25", "2014-09-26", "2014-09-27", "2014-09-28", "2014-09-29", "2014-09-30", "2014-10-01", "2014-10-02", "2014-10-03", "2014-10-04", "2014-10-05", "2014-10-06", "2014-10-07", "2014-10-08", "2014-10-09", "2014-10-10", "2014-10-11", "2014-10-12", "2014-10-13", "2014-10-14", "2014-10-15", "2014-10-16", "2014-10-17", "2014-10-18", "2014-10-19", "2014-10-20", "2014-10-21", "2014-10-22", "2014-10-23", "2014-10-24", "2014-10-25", "2014-10-26", "2014-10-27", "2014-10-28", "2014-10-29", "2014-10-30", "2014-10-31", "2014-11-01", "2014-11-02", "2014-11-03", "2014-11-04", "2014-11-05", "2014-11-06", "2014-11-07", "2014-11-08", "2014-11-09", "2014-11-10", "2014-11-11", "2014-11-12", "2014-11-13", "2014-11-14", "2014-11-15", "2014-11-16", "2014-11-17", "2014-11-18", "2014-11-19", "2014-11-20", "2014-11-21", "2014-11-22", "2014-11-23", "2014-11-24", "2014-11-25", "2014-11-26", "2014-11-27", "2014-11-28", "2014-11-29", "2014-11-30", "2014-12-01", "2014-12-02", "2014-12-03", "2014-12-04", "2014-12-05", "2014-12-06", "2014-12-07", "2014-12-08", "2014-12-09", "2014-12-10", "2014-12-11", "2014-12-12", "2014-12-13", "2014-12-14", "2014-12-15", "2014-12-16", "2014-12-17", "2014-12-18", "2014-12-19", "2014-12-20", "2014-12-21", "2014-12-22", "2014-12-23", "2014-12-24", "2014-12-25", "2014-12-26", "2014-12-27", "2014-12-28", "2014-12-29", "2014-12-30", "2014-12-31", "2015-01-01", "2015-01-02", "2015-01-03", "2015-01-04", "2015-01-05", "2015-01-06", "2015-01-07", "2015-01-08", "2015-01-09", "2015-01-10", "2015-01-11", "2015-01-12", "2015-01-13", "2015-01-14", "2015-01-15", "2015-01-16", "2015-01-17", "2015-01-18", "2015-01-19", "2015-01-20", "2015-01-21", "2015-01-22", "2015-01-23", "2015-01-24", "2015-01-25", "2015-01-26", "2015-01-27", "2015-01-28", "2015-01-29", "2015-01-30", "2015-01-31", "2015-02-01", "2015-02-02", "2015-02-03", "2015-02-04", "2015-02-05", "2015-02-06", "2015-02-07", "2015-02-08", "2015-02-09", "2015-02-10", "2015-02-11", "2015-02-12", "2015-02-13", "2015-02-14", "2015-02-15", "2015-02-16", "2015-02-17", "2015-02-18", "2015-02-19", "2015-02-20", "2015-02-21", "2015-02-22", "2015-02-23", "2015-02-24", "2015-02-25", "2015-02-26", "2015-02-27", "2015-02-28", "2015-03-01", "2015-03-02", "2015-03-03", "2015-03-04", "2015-03-05", "2015-03-06", "2015-03-07", "2015-03-08", "2015-03-09", "2015-03-10", "2015-03-11", "2015-03-12", "2015-03-13", "2015-03-14", "2015-03-15", "2015-03-16", "2015-03-17", "2015-03-18", "2015-03-19", "2015-03-20", "2015-03-21", "2015-03-22", "2015-03-23", "2015-03-24", "2015-03-25", "2015-03-26", "2015-03-27", "2015-03-28", "2015-03-29", "2015-03-30", "2015-03-31", "2015-04-01", "2015-04-02", "2015-04-03", "2015-04-04", "2015-04-05", "2015-04-06", "2015-04-07", "2015-04-08", "2015-04-09", "2015-04-10", "2015-04-11", "2015-04-12", "2015-04-13", "2015-04-14", "2015-04-15", "2015-04-16", "2015-04-17", "2015-04-18", "2015-04-19", "2015-04-20", "2015-04-21", "2015-04-22", "2015-04-23", "2015-04-24", "2015-04-25", "2015-04-26", "2015-04-27", "2015-04-28", "2015-04-29", "2015-04-30", "2015-05-01", "2015-05-02", "2015-05-03", "2015-05-04", "2015-05-05", "2015-05-06", "2015-05-07", "2015-05-08", "2015-05-09", "2015-05-10", "2015-05-11", "2015-05-12", "2015-05-13", "2015-05-14", "2015-05-15", "2015-05-16", "2015-05-17", "2015-05-18", "2015-05-19", "2015-05-20", "2015-05-21", "2015-05-22", "2015-05-23", "2015-05-24", "2015-05-25", "2015-05-26", "2015-05-27", "2015-05-28", "2015-05-29", "2015-05-30", "2015-05-31", "2015-06-01", "2015-06-02", "2015-06-03", "2015-06-04", "2015-06-05", "2015-06-06", "2015-06-07", "2015-06-08", "2015-06-09", "2015-06-10", "2015-06-11", "2015-06-12", "2015-06-13", "2015-06-14", "2015-06-15", "2015-06-16", "2015-06-17", "2015-06-18", "2015-06-19", "2015-06-20", "2015-06-21", "2015-06-22", "2015-06-23", "2015-06-24", "2015-06-25", "2015-06-26", "2015-06-27", "2015-06-28", "2015-06-29", "2015-06-30", "2015-07-01", "2015-07-02", "2015-07-03", "2015-07-04", "2015-07-05", "2015-07-06", "2015-07-07", "2015-07-08", "2015-07-09", "2015-07-10", "2015-07-11", "2015-07-12", "2015-07-13", "2015-07-14", "2015-07-15", "2015-07-16", "2015-07-17", "2015-07-18", "2015-07-19", "2015-07-20", "2015-07-21", "2015-07-22", "2015-07-23", "2015-07-24", "2015-07-25", "2015-07-26", "2015-07-27", "2015-07-28", "2015-07-29", "2015-07-30", "2015-07-31", "2015-08-01", "2015-08-02", "2015-08-03", "2015-08-04", "2015-08-05", "2015-08-06", "2015-08-07", "2015-08-08", "2015-08-09", "2015-08-10", "2015-08-11", "2015-08-12", "2015-08-13", "2015-08-14", "2015-08-15", "2015-08-16", "2015-08-17", "2015-08-18", "2015-08-19", "2015-08-20", "2015-08-21", "2015-08-22", "2015-08-23", "2015-08-24", "2015-08-25", "2015-08-26", "2015-08-27", "2015-08-28", "2015-08-29", "2015-08-30", "2015-08-31", "2015-09-01", "2015-09-02", "2015-09-03", "2015-09-04", "2015-09-05", "2015-09-06", "2015-09-07", "2015-09-08", "2015-09-09", "2015-09-10", "2015-09-11", "2015-09-12", "2015-09-13", "2015-09-14", "2015-09-15", "2015-09-16", "2015-09-17", "2015-09-18", "2015-09-19", "2015-09-20", "2015-09-21", "2015-09-22", "2015-09-23", "2015-09-24", "2015-09-25", "2015-09-26", "2015-09-27", "2015-09-28", "2015-09-29", "2015-09-30", "2015-10-01", "2015-10-02", "2015-10-03", "2015-10-04", "2015-10-05", "2015-10-06", "2015-10-07", "2015-10-08", "2015-10-09", "2015-10-10", "2015-10-11", "2015-10-12", "2015-10-13", "2015-10-14", "2015-10-15", "2015-10-16", "2015-10-17", "2015-10-18", "2015-10-19", "2015-10-20", "2015-10-21", "2015-10-22", "2015-10-23", "2015-10-24", "2015-10-25", "2015-10-26", "2015-10-27", "2015-10-28", "2015-10-29", "2015-10-30", "2015-10-31", "2015-11-01", "2015-11-02", "2015-11-03", "2015-11-04", "2015-11-05", "2015-11-06", "2015-11-07", "2015-11-08", "2015-11-09", "2015-11-10", "2015-11-11", "2015-11-12", "2015-11-13", "2015-11-14", "2015-11-15", "2015-11-16", "2015-11-17", "2015-11-18", "2015-11-19", "2015-11-20", "2015-11-21", "2015-11-22", "2015-11-23", "2015-11-24", "2015-11-25", "2015-11-26", "2015-11-27", "2015-11-28", "2015-11-29", "2015-11-30", "2015-12-01", "2015-12-02", "2015-12-03", "2015-12-04", "2015-12-05", "2015-12-06", "2015-12-07", "2015-12-08", "2015-12-09", "2015-12-10", "2015-12-11", "2015-12-12", "2015-12-13", "2015-12-14", "2015-12-15", "2015-12-16", "2015-12-17", "2015-12-18", "2015-12-19", "2015-12-20", "2015-12-21", "2015-12-22", "2015-12-23", "2015-12-24", "2015-12-25", "2015-12-26", "2015-12-27", "2015-12-28", "2015-12-29", "2015-12-30", "2015-12-31", "2016-01-01", "2016-01-02", "2016-01-03", "2016-01-04", "2016-01-05", "2016-01-06", "2016-01-07", "2016-01-08", "2016-01-09", "2016-01-10", "2016-01-11", "2016-01-12", "2016-01-13", "2016-01-14", "2016-01-15", "2016-01-16", "2016-01-17", "2016-01-18", "2016-01-19", "2016-01-20", "2016-01-21", "2016-01-22", "2016-01-23", "2016-01-24", "2016-01-25", "2016-01-26", "2016-01-27", "2016-01-28", "2016-01-29", "2016-01-30", "2016-01-31", "2016-02-01", "2016-02-02", "2016-02-03", "2016-02-04", "2016-02-05", "2016-02-06", "2016-02-07", "2016-02-08", "2016-02-09", "2016-02-10", "2016-02-11", "2016-02-12", "2016-02-13", "2016-02-14", "2016-02-15", "2016-02-16", "2016-02-17", "2016-02-18", "2016-02-19", "2016-02-20", "2016-02-21", "2016-02-22", "2016-02-23", "2016-02-24", "2016-02-25", "2016-02-26", "2016-02-27", "2016-02-28", "2016-02-29", "2016-03-01", "2016-03-02", "2016-03-03", "2016-03-04", "2016-03-05", "2016-03-06", "2016-03-07", "2016-03-08", "2016-03-09", "2016-03-10", "2016-03-11", "2016-03-12", "2016-03-13", "2016-03-14", "2016-03-15", "2016-03-16", "2016-03-17", "2016-03-18", "2016-03-19", "2016-03-20", "2016-03-21", "2016-03-22", "2016-03-23", "2016-03-24", "2016-03-25", "2016-03-26", "2016-03-27", "2016-03-28", "2016-03-29", "2016-03-30", "2016-03-31", "2016-04-01", "2016-04-02", "2016-04-03", "2016-04-04", "2016-04-05", "2016-04-06", "2016-04-07", "2016-04-08", "2016-04-09", "2016-04-10", "2016-04-11", "2016-04-12", "2016-04-13", "2016-04-14", "2016-04-15", "2016-04-16", "2016-04-17", "2016-04-18", "2016-04-19", "2016-04-20", "2016-04-21", "2016-04-22", "2016-04-23", "2016-04-24", "2016-04-25", "2016-04-26", "2016-04-27", "2016-04-28", "2016-04-29", "2016-04-30", "2016-05-01", "2016-05-02", "2016-05-03", "2016-05-04", "2016-05-05", "2016-05-06", "2016-05-07", "2016-05-08", "2016-05-09", "2016-05-10", "2016-05-11", "2016-05-12", "2016-05-13", "2016-05-14", "2016-05-15", "2016-05-16", "2016-05-17", "2016-05-18", "2016-05-19", "2016-05-20", "2016-05-21", "2016-05-22", "2016-05-23", "2016-05-24", "2016-05-25", "2016-05-26", "2016-05-27", "2016-05-28", "2016-05-29", "2016-05-30", "2016-05-31", "2016-06-01", "2016-06-02", "2016-06-03", "2016-06-04", "2016-06-05", "2016-06-06", "2016-06-07", "2016-06-08", "2016-06-09", "2016-06-10", "2016-06-11", "2016-06-12", "2016-06-13", "2016-06-14", "2016-06-15", "2016-06-16", "2016-06-17", "2016-06-18", "2016-06-19", "2016-06-20", "2016-06-21", "2016-06-22", "2016-06-23", "2016-06-24", "2016-06-25", "2016-06-26", "2016-06-27", "2016-06-28", "2016-06-29", "2016-06-30", "2016-07-01", "2016-07-02", "2016-07-03", "2016-07-04", "2016-07-05", "2016-07-06", "2016-07-07", "2016-07-08", "2016-07-09", "2016-07-10", "2016-07-11", "2016-07-12", "2016-07-13", "2016-07-14", "2016-07-15", "2016-07-16", "2016-07-17", "2016-07-18", "2016-07-19", "2016-07-20", "2016-07-21", "2016-07-22", "2016-07-23", "2016-07-24", "2016-07-25", "2016-07-26", "2016-07-27", "2016-07-28", "2016-07-29", "2016-07-30", "2016-07-31", "2016-08-01", "2016-08-02", "2016-08-03", "2016-08-04", "2016-08-05", "2016-08-06", "2016-08-07", "2016-08-08", "2016-08-09", "2016-08-10", "2016-08-11", "2016-08-12", "2016-08-13", "2016-08-14", "2016-08-15", "2016-08-16", "2016-08-17", "2016-08-18", "2016-08-19", "2016-08-20", "2016-08-21", "2016-08-22", "2016-08-23", "2016-08-24", "2016-08-25", "2016-08-26", "2016-08-27", "2016-08-28", "2016-08-29", "2016-08-30", "2016-08-31", "2016-09-01", "2016-09-02", "2016-09-03", "2016-09-04", "2016-09-05", "2016-09-06", "2016-09-07", "2016-09-08", "2016-09-09", "2016-09-10", "2016-09-11", "2016-09-12", "2016-09-13", "2016-09-14", "2016-09-15", "2016-09-16", "2016-09-17", "2016-09-18", "2016-09-19", "2016-09-20", "2016-09-21", "2016-09-22", "2016-09-23", "2016-09-24", "2016-09-25", "2016-09-26", "2016-09-27", "2016-09-28", "2016-09-29", "2016-09-30", "2016-10-01", "2016-10-02", "2016-10-03", "2016-10-04", "2016-10-05", "2016-10-06", "2016-10-07", "2016-10-08", "2016-10-09", "2016-10-10", "2016-10-11", "2016-10-12", "2016-10-13", "2016-10-14", "2016-10-15", "2016-10-16", "2016-10-17", "2016-10-18", "2016-10-19", "2016-10-20", "2016-10-21", "2016-10-22", "2016-10-23", "2016-10-24", "2016-10-25", "2016-10-26", "2016-10-27", "2016-10-28", "2016-10-29", "2016-10-30", "2016-10-31", "2016-11-01", "2016-11-02", "2016-11-03", "2016-11-04", "2016-11-05", "2016-11-06", "2016-11-07", "2016-11-08", "2016-11-09", "2016-11-10", "2016-11-11", "2016-11-12", "2016-11-13", "2016-11-14", "2016-11-15", "2016-11-16", "2016-11-17", "2016-11-18", "2016-11-19", "2016-11-20", "2016-11-21", "2016-11-22", "2016-11-23", "2016-11-24", "2016-11-25", "2016-11-26", "2016-11-27", "2016-11-28", "2016-11-29", "2016-11-30", "2016-12-01", "2016-12-02", "2016-12-03", "2016-12-04", "2016-12-05", "2016-12-06", "2016-12-07", "2016-12-08", "2016-12-09", "2016-12-10", "2016-12-11", "2016-12-12", "2016-12-13", "2016-12-14", "2016-12-15", "2016-12-16", "2016-12-17", "2016-12-18", "2016-12-19", "2016-12-20", "2016-12-21", "2016-12-22", "2016-12-23", "2016-12-24", "2016-12-25", "2016-12-26", "2016-12-27", "2016-12-28", "2016-12-29", "2016-12-30", "2016-12-31"], "y": [12, 8, 10, 14, 12, 18, 16, 7, 6, 12, 18, 12, 12, 7, 13, 4, 8, 15, 7, 9, 17, 9, 13, 10, 17, 12, 20, 9, 12, 15, 16, 9, 14, 17, 20, 17, 11, 18, 24, 18, 24, 26, 19, 20, 18, 22, 21, 23, 22, 15, 19, 14, 23, 33, 30, 23, 20, 12, 23, 27, 23, 28, 31, 10, 17, 27, 27, 32, 22, 22, 25, 18, 20, 22, 25, 21, 19, 19, 19, 15, 17, 24, 20, 19, 11, 13, 18, 25, 17, 18, 30, 17, 12, 25, 26, 20, 21, 19, 11, 9, 12, 12, 14, 18, 29, 20, 13, 23, 25, 14, 24, 9, 9, 13, 22, 28, 25, 20, 21, 16, 18, 14, 26, 23, 19, 21, 14, 19, 22, 22, 32, 14, 37, 17, 13, 37, 23, 27, 22, 23, 19, 14, 17, 13, 7, 1, 7, 17, 11, 11, 11, 11, 10, 7, 9, 13, 8, 11, 6, 19, 15, 8, 12, 12, 18, 19, 19, 25, 13, 9, 16, 22, 16, 17, 25, 14, 7, 17, 16, 19, 28, 24, 13, 12, 12, 15, 21, 19, 23, 13, 8, 11, 18, 16, 14, 18, 15, 10, 9, 14, 17, 16, 19, 14, 14, 19, 14, 16, 17, 20, 17, 8, 16, 11, 26, 14, 23, 16, 11, 11, 15, 25, 24, 20, 16, 3, 11, 21, 14, 14, 13, 6, 10, 11, 21, 20, 16, 16, 17, 16, 16, 24, 17, 16, 25, 16, 7, 6, 18, 23, 17, 18, 16, 17, 21, 24, 20, 17, 20, 15, 11, 21, 16, 24, 32, 23, 10, 10, 13, 15, 17, 30, 14, 11, 9, 15, 11, 21, 19, 17, 18, 11, 20, 17, 15, 9, 14, 16, 10, 25, 15, 26, 17, 16, 11, 10, 9, 23, 24, 20, 21, 19, 20, 15, 30, 24, 13, 34, 22, 10, 29, 23, 19, 24, 28, 18, 8, 15, 24, 27, 29, 20, 13, 10, 14, 16, 24, 24, 19, 17, 6, 30, 20, 33, 17, 20, 16, 11, 25, 21, 18, 22, 25, 15, 9, 20, 12, 24, 13, 20, 7, 11, 14, 15, 10, 9, 16, 11, 10, 13, 23, 21, 10, 15, 10, 17, 19, 14, 10, 13, 12, 12, 6, 7, 13, 11, 16, 10, 10, 4, 15, 5, 6, 11, 13, 11, 11, 19, 9, 16, 14, 21, 17, 9, 18, 12, 14, 21, 20, 17, 12, 16, 15, 39, 30, 21, 16, 11, 19, 22, 24, 19, 31, 23, 14, 14, 19, 19, 21, 20, 16, 15, 22, 31, 23, 32, 31, 21, 6, 22, 28, 19, 17, 26, 23, 16, 18, 19, 18, 15, 29, 16, 8, 15, 17, 18, 29, 16, 13, 10, 20, 17, 23, 13, 25, 22, 11, 18, 19, 24, 30, 25, 15, 18, 16, 22, 10, 18, 15, 14, 8, 18, 22, 21, 25, 31, 19, 11, 26, 24, 19, 21, 24, 10, 11, 12, 20, 17, 23, 19, 15, 12, 27, 25, 15, 19, 19, 12, 10, 18, 22, 12, 21, 21, 20, 10, 21, 11, 22, 11, 4, 6, 6, 16, 11, 7, 15, 6, 7, 11, 12, 27, 21, 24, 16, 13, 12, 16, 15, 15, 25, 17, 15, 9, 8, 22, 20, 26, 29, 12, 13, 18, 23, 17, 24, 20, 13, 17, 21, 18, 30, 16, 12, 16, 11, 21, 22, 17, 17, 23, 13, 9, 14, 20, 20, 24, 18, 17, 12, 13, 16, 10, 12, 19, 13, 5, 17, 23, 24, 20, 25, 22, 13, 16, 25, 17, 13, 22, 17, 9, 15, 13, 16, 19, 19, 11, 13, 12, 20, 16, 28, 26, 7, 17, 9, 20, 22, 22, 19, 8, 17, 21, 22, 22, 26, 25, 17, 11, 26, 14, 21, 33, 20, 13, 19, 14, 17, 18, 19, 9, 15, 3, 14, 15, 13, 22, 16, 16, 12, 17, 25, 21, 16, 13, 10, 21, 18, 30, 22, 14, 15, 12, 17, 24, 18, 25, 24, 21, 18, 18, 24, 14, 23, 23, 23, 17, 11, 25, 22, 24, 16, 19, 15, 8, 13, 21, 20, 28, 30, 12, 17, 20, 18, 29, 25, 17, 19, 18, 16, 15, 25, 27, 18, 20, 25, 19, 26, 29, 24, 21, 18, 12, 19, 24, 29, 28, 19, 17, 20, 33, 19, 23, 6, 14, 11, 12, 14, 17, 19, 15, 19, 16, 11, 27, 20, 19, 18, 19, 13, 11, 15, 14, 18, 15, 10, 13, 10, 10, 6, 13, 2, 11, 8, 8, 3, 12, 5, 15, 8, 10, 10, 14, 19, 15, 22, 10, 10, 11, 12, 19, 15, 16, 23, 9, 15, 29, 20, 27, 20, 22, 20, 12, 16, 23, 27, 25, 21, 16, 10, 20, 10, 24, 26, 21, 18, 9, 19, 20, 18, 19, 22, 20, 15, 18, 25, 9, 45, 18, 17, 16, 23, 27, 18, 30, 30, 15, 14, 20, 23, 24, 23, 18, 10, 17, 19, 17, 16, 18, 18, 15, 11, 23, 14, 23, 14, 30, 15, 12, 18, 18, 26, 31, 15, 19, 9, 19, 19, 21, 34, 23, 18, 16, 21, 13, 24, 17, 20, 14, 17, 20, 31, 27, 23, 23, 14, 10, 16, 16, 18, 20, 13, 16, 8, 17, 23, 18, 19, 18, 11, 6, 13, 10, 17, 26, 15, 12, 9, 16, 17, 12, 12, 16, 8], "mode": "lines+markers"}], {}, {"showLink": true, "linkText": "Export to plot.ly"})</script><script type="text/javascript">window.addEventListener("resize", function(){Plotly.Plots.resize(document.getElementById("21d4d405-eb35-4707-9fda-7393d0b88ffb"));});</script></body></html>
</div>

<p>There doesn’t seem to be any particular trend in the time series. But we can notice seasonal patterns that will be of great value to our model and a high number of spikes that we can try to explain to gain more insights into the problem. Let’s take a closer look at all that.</p>

<h3 id="time-series-analysis">Time series Analysis :</h3>

<h4 id="some-statistics">Some statistics</h4>

<p>Let&rsquo;s first compute some statistics like the rolling mean and the rolling standard deviation, and use a statistical test (Dickey-Fuler) to determine if the series is stationary.</p>

<p>The stationarity of a time series is important when it comes to modeling. Some models can only work with stationary time series. It&rsquo;s also a good insight on the structure of the time series: Doing this analysis helps us detect trends, structural breaks, and all sort of abnormal pattern which can help us gain a better understanding and allow us to adapt our models and make them generalize better.</p>

<pre><code class="language-python"># Some statistics :
test_stationarity(dtsers.Num_Acc , window = 28)
</code></pre>

<p><img src="/accidents/output_18_0.png" alt="png" /></p>

<pre><code>Results of Dickey-Fuller Test:
Test Statistic                -8.672545e+00
p-value                        4.505532e-14
#Lags Used                     3.100000e+01
Number of Observations Used    4.351000e+03
Critical Value (1%)           -3.431854e+00
Critical Value (5%)           -2.862205e+00
Critical Value (10%)          -2.567124e+00
dtype: float64
</code></pre>

<p>The p-value of the test indicates that the series is stationary. We don&rsquo;t notice any significant trend, but we can clearly see seasonal patterns.</p>

<p>Let&rsquo;s now look at the auto correlation plots:</p>

<pre><code class="language-python">acp_pacp(dtsers.Num_Acc)
</code></pre>

<pre><code>lag_acf
</code></pre>

<p><img src="/accidents/output_20_1.png" alt="png" /></p>

<pre><code>lag_pacf
</code></pre>

<p><img src="/accidents/output_20_3.png" alt="png" /></p>

<p>These plots confirm that there is strong seasonality in our data. We can clearly see that we have here a weekly seasonality, thus a pattern repeating every week. This kind of pattern is valuable because it will allow us to improve our prediction based on what happened last week for example. We can also notice a strong correlation with what happened the day before.</p>

<p>Let&rsquo;s track more kinds of seasonality:</p>

<h4 id="seasonality">Seasonality:</h4>

<p><strong>Hourly Seasonality</strong></p>

<p>This kind of seasonality won&rsquo;t be of any use to our model, but it&rsquo;s good to know in case we want to build an hourly model instead of a daily model. We will simply sum the number of accidents per hour after distinguishing grave accidents (Death or grave injury) from the rest and see what we can find:</p>

<pre><code class="language-python">tempas = caracs.loc[caracs.dep == 750 , ['Num_Acc' , 'hrmn']]
tempas['hour'] = tempas['hrmn'].apply(lambda x:str(x).zfill(4)[:2])


grave_accs = users[users.grav.isin([2,3]) ].Num_Acc

tempas['gravity'] = 0
tempas.loc[tempas.Num_Acc.isin(grave_accs),'gravity'] = 1


occs = tempas.drop('hrmn' , axis = 1).groupby('hour' , as_index = False).agg({'Num_Acc' : 'count' , 'gravity' : 'sum'})



trace1 = go.Area(
    r=list(occs.Num_Acc),
    t=list(occs.hour),
    name='Total Number of accidents',
    marker=dict(
        color='rgb(106,81,163)'
    )
)

trace2 = go.Area(
    r=list(occs.gravity),
    t=list(occs.hour),
    name='Grave accidents',
    marker=dict(
        color='rgb(158,154,200)'
    )
)

data = [trace1 , trace2]

layout = go.Layout(
    title='Repartition of accidents per Hour',
    autosize = False,
    width = 1000,
    height = 500,
    orientation=-90
)
fig = go.Figure(data=data, layout=layout)
iplot(fig)

</code></pre>

<div>
<html><head><meta charset="utf-8" /></head><body><div id="a26572a0-85d4-46c3-848e-3a3269083568" style="height: 500px; width: 1000px;" class="plotly-graph-div"></div><script type="text/javascript">window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("a26572a0-85d4-46c3-848e-3a3269083568", [{"type": "area", "r": [2166, 1722, 1558, 1040, 911, 981, 1448, 2244, 4495, 5671, 4406, 4372, 4629, 4784, 5017, 5457, 5743, 6282, 6316, 5758, 4548, 3084, 2498, 2352], "t": ["00", "01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23"], "name": "Total Number of accidents", "marker": {"color": "rgb(106,81,163)"}}, {"type": "area", "r": [314, 258, 244, 188, 161, 174, 223, 229, 357, 480, 410, 418, 405, 390, 424, 493, 539, 609, 570, 598, 430, 339, 343, 308], "t": ["00", "01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23"], "name": "Grave accidents", "marker": {"color": "rgb(158,154,200)"}}] , {}, {"showLink": true, "linkText": "Export to plot.ly"})</script><script type="text/javascript">window.addEventListener("resize", function(){Plotly.Plots.resize(document.getElementById("21d4d405-eb35-4707-9fda-7393d0b88ffb"));});</script></body></html>
</div>

<p>We can clearly notice two spikes, one at 09h00, the time people go to work and another one between 17h00 and 18h00, time when people return home. The number of accidents decreases between these two spikes Nothing unusual but it proves there is a pattern here.</p>

<p>We can also see that there are few grave accidents in Paris since there re only in-town roads.</p>

<p><strong>Daily Seasonality</strong></p>

<pre><code class="language-python">tempas = caracs.loc[caracs.dep == 750 ,['Num_Acc']]
tempas['date'] = pd.to_datetime((2000+caracs.an)*10000+caracs.mois*100+caracs.jour,format='%Y%m%d')
tempas['weekday'] = tempas['date'].dt.weekday.apply(lambda x:str(x).zfill(2))

tempas['gravity'] = 0
tempas.loc[tempas.Num_Acc.isin(grave_accs),'gravity'] = 1


occs = tempas.drop('date' , axis = 1).groupby('weekday' , as_index = False).agg({'Num_Acc' : 'count' , 'gravity' : 'sum'})



trace1 = go.Area(
    r=list(occs.Num_Acc),
    t=list(occs.weekday),
    name='Total Number of accidents',
    marker=dict(
        color='rgb(106,81,163)'
    )
)

trace2 = go.Area(
    r=list(occs.gravity),
    t=list(occs.weekday),
    name='Grave accidents',
    marker=dict(
        color='rgb(158,154,200)'
    )
)

data = [trace1 , trace2]

layout = go.Layout(
    title='Repartition of accidents per weekday',
    autosize = False,
    width = 1000,
    height = 500,
    orientation=-90
)
fig = go.Figure(data=data, layout=layout)
iplot(fig)
</code></pre>

<div>
<html><head><meta charset="utf-8" /></head><body><div id="962c48e6-cf74-4b47-b152-cc72a707ba08" style="height: 100%; width: 100%;" class="plotly-graph-div"></div><script type="text/javascript">window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("962c48e6-cf74-4b47-b152-cc72a707ba08", [{"type": "area", "r": [12270, 13574, 14017, 13938, 14358, 10819, 8506], "t": ["00", "01", "02", "03", "04", "05", "06"], "name": "Total Number of accidents", "marker": {"color": "rgb(106,81,163)"}}, {"type": "area", "r": [1134, 1348, 1378, 1418, 1471, 1203, 952], "t": ["00", "01", "02", "03", "04", "05", "06"], "name": "Grave accidents", "marker": {"color": "rgb(158,154,200)"}}] , {}, {"showLink": true, "linkText": "Export to plot.ly"})</script><script type="text/javascript">window.addEventListener("resize", function(){Plotly.Plots.resize(document.getElementById("21d4d405-eb35-4707-9fda-7393d0b88ffb"));});</script></body></html>
</div>

<p>Same thing here, we can clearly notice a pattern, where the number of accidents decrease in Fridays and Sundays and reach its minimum in Saturdays. The other days are roughly the same (working days).</p>

<p><strong>Monthly Seasonality</strong></p>

<pre><code class="language-python">tempas = caracs.loc[caracs.dep == 750 ,['Num_Acc' , 'mois']]
tempas['mois'] = tempas['mois'].apply(lambda x:str(x).zfill(2))

tempas['gravity'] = 0
tempas.loc[tempas.Num_Acc.isin(grave_accs),'gravity'] = 1


occs = tempas.groupby('mois' , as_index = False).agg({'Num_Acc' : 'count' , 'gravity' : 'sum'})



trace1 = go.Area(
    r=list(occs.Num_Acc),
    t=list(occs.mois),
    name='Total Number of accidents',
    marker=dict(
        color='rgb(106,81,163)'
    )
)

trace2 = go.Area(
    r=list(occs.gravity),
    t=list(occs.mois),
    name='Grave accidents',
    marker=dict(
        color='rgb(158,154,200)'
    )
)

data = [trace1 , trace2]

layout = go.Layout(
    title='Repartition of accidents per Hour',
    autosize = False,
    width = 1000,
    height = 500,
    orientation=-90
)
fig = go.Figure(data=data, layout=layout)
iplot(fig)
</code></pre>

<div>
<html><head><meta charset="utf-8" /></head><body><div id="52c4552b-3ced-4862-859b-5db04f4d3c5a" style="height: 100%; width: 100%;" class="plotly-graph-div"></div><script type="text/javascript">window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("52c4552b-3ced-4862-859b-5db04f4d3c5a", [{"type": "area", "r": [6409, 6019, 7254, 7226, 7625, 8353, 7271, 5100, 8178, 8833, 8123, 7091], "t": ["01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12"], "name": "Total Number of accidents", "marker": {"color": "rgb(106,81,163)"}}, {"type": "area", "r": [697, 602, 761, 786, 794, 839, 714, 565, 802, 813, 802, 729], "t": ["01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12"], "name": "Grave accidents", "marker": {"color": "rgb(158,154,200)"}}] , {}, {"showLink": true, "linkText": "Export to plot.ly"})</script><script type="text/javascript">window.addEventListener("resize", function(){Plotly.Plots.resize(document.getElementById("21d4d405-eb35-4707-9fda-7393d0b88ffb"));});</script></body></html>
</div>

<p>Again, we can see an anual pattern in the time series, strongly related to the time go on vacation (August, December, &hellip;).</p>

<p>By incorporating these patterns in our models, we will be able to make better predictions.</p>

<h4 id="impact-of-weather">Impact of weather:</h4>

<p>I haven&rsquo;t made this part available on Kaggle since I could only retrieve weather data for Paris, but I think there is a lot of value to gain here since the weather has a big influence on traffic and the quality of roads. Let&rsquo;s see if we can find some interesting patterns.</p>

<pre><code class="language-python"># Weather Data

wdata = pd.read_csv('weather_data2.csv' , sep = ';')
wdata = wdata.loc[wdata.numer_sta == 7149 , ['date', 't', 'dd' ,
                                             'ff', 'u', 'n' ,'raf10', 'rr1', 'rr3', 'rr6', 'rr12']].reset_index(drop = True)
wdata.date = pd.to_datetime(wdata.date)
wdata.date = wdata.date.dt.strftime('%Y-%m-%d')

for col in ['t' , 'dd' , 'ff' , 'u' , 'n']:
    index_missing = wdata[wdata[col] == 'mq'].index.values
    wdata[col][list(index_missing)] = wdata[col][list(index_missing - 1)]
    
wdata.replace('mq' , 0 , inplace = True)

wdata = wdata.convert_objects(convert_numeric=True)    

wdata = wdata.groupby('date' , as_index = False).mean()

# Merging with our data :
wdata.columns = ['day' , 'temperature' , 'dd' , 'windspeed' , 'u' , 'nebulosity' , 'raf10' , 'rr1' , 'rr3' , 'rr6' , 'rr12']
wdata.day = pd.to_datetime(wdata.day)
</code></pre>

<pre><code class="language-python"># Adding weather to the time series.
dtsers = dtsers.merge(wdata , on = 'day')

dtsers.temperature[dtsers.temperature &lt; 260] = 260
for col in [ 'temperature'  , 'windspeed' , 'nebulosity' ]:
    sns.jointplot(x=col, y=&quot;Num_Acc&quot;, data=dtsers, kind=&quot;reg&quot;)
    plt.show()
</code></pre>

<p><img src="/accidents/output_36_0.png" alt="png" /></p>

<p><img src="/accidents/output_36_1.png" alt="png" /></p>

<p><img src="/accidents/output_36_2.png" alt="png" /></p>

<h2 id="modeling">Modeling:</h2>

<p>To score our models, we will use this function that computes a set of meaningful statistics for the predictions we make. We will backtest our model for the last year and see how it performs.</p>

<p>The function below will compute the Mean Error, Mean absolute error (MAE), the Root mean squared error (RMSE), the Mean Percentage error (MPE), the correlation between the true value and the error to see if there is any information left. It will also plot the distribution of the error and the prediction versus the true value according to time.</p>

<pre><code class="language-python">def evaluate(y_true , y_pred , dates):
    
    try:
        true_value , prediction = y_true.sum(axis = 1), y_pred.sum(axis=1).round()
    except:
        true_value , prediction = y_true, y_pred.round()
    
    print('Mean Absolute Error   :' , round(abs(true_value - prediction).mean() , 2)) 
    print('Root Mean Square Error:' , round(sqrt(((true_value - prediction)**2).mean()) , 2) )
    print('Mean Percentage Error :' , round((abs(true_value - prediction)/true_value).mean() , 2)  )
    
    error = pd.Series(true_value - prediction)
    
    #density plot :
    print('Error Density :')
    error.plot.density()
    plt.show()
    
    # mean of error and correlation :
    print('Mean Error                       :' , round(mean(error) , 2 ))
    print('True Value And error Correlation :' , round(np.corrcoef(error , true_value)[0 , 1] , 2))
    
    # plot :
    
    to_plot = pd.DataFrame({'target' : y_true.reshape(-1) , 'prediction' : y_pred.reshape(-1)})
    
    jsplot_multiple(dates , to_plot)
</code></pre>

<h3 id="naïve-model">Naïve Model:</h3>

<p>Before going further, we need to build a &lsquo;Naïve&rsquo; model that will represent the minimum acceptable performance in order to benchmark the models we are going to build. This model must be the simplest and more intuitive possible.</p>

<p>Since we have strong seasonality patterns and no trends, we will take the number of accidents last year in the same day the same week as the prediction for this year, and see what performances we get:</p>

<pre><code class="language-python"># Naive Model :

new , old = (dtsers.loc[dtsers.day.dt.year == 2016 , ['day' , 'Num_Acc']].reset_index(drop = True) ,
             dtsers.loc[dtsers.day.dt.year == 2015 , ['day' , 'Num_Acc']].reset_index(drop = True)[:365])

old.columns = ['day' , 'old']

new['weekofyear'] , new['dayofweek'] = new.day.dt.weekofyear , new.day.dt.dayofweek
old['weekofyear'] , old['dayofweek'] = old.day.dt.weekofyear , old.day.dt.dayofweek

merged = new.merge(old , on = ['weekofyear' , 'dayofweek'])


evaluate(merged.Num_Acc , merged.old , dtsers.day[-365:])
</code></pre>

<pre><code>Mean Absolute Error   : 5.07
Root Mean Square Error: 6.53
Mean Percentage Error : 0.33
Error Density :
</code></pre>

<p><img src="/accidents/output_42_1.png" alt="png" /></p>

<pre><code>Mean Error                       : 0.79
True Value And error Correlation : 0.52
</code></pre>

<div>
<html><head><meta charset="utf-8" /></head><body><div id="0ee7a9d6-cfb1-417c-8fd1-4308e656ed17" style="height: 100%; width: 100%;" class="plotly-graph-div"></div><script type="text/javascript">window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("0ee7a9d6-cfb1-417c-8fd1-4308e656ed17", [{"type": "scatter", "x": ["2016-01-02", "2016-01-03", "2016-01-04", "2016-01-05", "2016-01-06", "2016-01-07", "2016-01-08", "2016-01-09", "2016-01-10", "2016-01-11", "2016-01-12", "2016-01-13", "2016-01-14", "2016-01-15", "2016-01-16", "2016-01-17", "2016-01-18", "2016-01-19", "2016-01-20", "2016-01-21", "2016-01-22", "2016-01-23", "2016-01-24", "2016-01-25", "2016-01-26", "2016-01-27", "2016-01-28", "2016-01-29", "2016-01-30", "2016-01-31", "2016-02-01", "2016-02-02", "2016-02-03", "2016-02-04", "2016-02-05", "2016-02-06", "2016-02-07", "2016-02-08", "2016-02-09", "2016-02-10", "2016-02-11", "2016-02-12", "2016-02-13", "2016-02-14", "2016-02-15", "2016-02-16", "2016-02-17", "2016-02-18", "2016-02-19", "2016-02-20", "2016-02-21", "2016-02-22", "2016-02-23", "2016-02-24", "2016-02-25", "2016-02-26", "2016-02-27", "2016-02-28", "2016-02-29", "2016-03-01", "2016-03-02", "2016-03-03", "2016-03-04", "2016-03-05", "2016-03-06", "2016-03-07", "2016-03-08", "2016-03-09", "2016-03-10", "2016-03-11", "2016-03-12", "2016-03-13", "2016-03-14", "2016-03-15", "2016-03-16", "2016-03-17", "2016-03-18", "2016-03-19", "2016-03-20", "2016-03-21", "2016-03-22", "2016-03-23", "2016-03-24", "2016-03-25", "2016-03-26", "2016-03-27", "2016-03-28", "2016-03-29", "2016-03-30", "2016-03-31", "2016-04-01", "2016-04-02", "2016-04-03", "2016-04-04", "2016-04-05", "2016-04-06", "2016-04-07", "2016-04-08", "2016-04-09", "2016-04-10", "2016-04-11", "2016-04-12", "2016-04-13", "2016-04-14", "2016-04-15", "2016-04-16", "2016-04-17", "2016-04-18", "2016-04-19", "2016-04-20", "2016-04-21", "2016-04-22", "2016-04-23", "2016-04-24", "2016-04-25", "2016-04-26", "2016-04-27", "2016-04-28", "2016-04-29", "2016-04-30", "2016-05-01", "2016-05-02", "2016-05-03", "2016-05-04", "2016-05-05", "2016-05-06", "2016-05-07", "2016-05-08", "2016-05-09", "2016-05-10", "2016-05-11", "2016-05-12", "2016-05-13", "2016-05-14", "2016-05-15", "2016-05-16", "2016-05-17", "2016-05-18", "2016-05-19", "2016-05-20", "2016-05-21", "2016-05-22", "2016-05-23", "2016-05-24", "2016-05-25", "2016-05-26", "2016-05-27", "2016-05-28", "2016-05-29", "2016-05-30", "2016-05-31", "2016-06-01", "2016-06-02", "2016-06-03", "2016-06-04", "2016-06-05", "2016-06-06", "2016-06-07", "2016-06-08", "2016-06-09", "2016-06-10", "2016-06-11", "2016-06-12", "2016-06-13", "2016-06-14", "2016-06-15", "2016-06-16", "2016-06-17", "2016-06-18", "2016-06-19", "2016-06-20", "2016-06-21", "2016-06-22", "2016-06-23", "2016-06-24", "2016-06-25", "2016-06-26", "2016-06-27", "2016-06-28", "2016-06-29", "2016-06-30", "2016-07-01", "2016-07-02", "2016-07-03", "2016-07-04", "2016-07-05", "2016-07-06", "2016-07-07", "2016-07-08", "2016-07-09", "2016-07-10", "2016-07-11", "2016-07-12", "2016-07-13", "2016-07-14", "2016-07-15", "2016-07-16", "2016-07-17", "2016-07-18", "2016-07-19", "2016-07-20", "2016-07-21", "2016-07-22", "2016-07-23", "2016-07-24", "2016-07-25", "2016-07-26", "2016-07-27", "2016-07-28", "2016-07-29", "2016-07-30", "2016-07-31", "2016-08-01", "2016-08-02", "2016-08-03", "2016-08-04", "2016-08-05", "2016-08-06", "2016-08-07", "2016-08-08", "2016-08-09", "2016-08-10", "2016-08-11", "2016-08-12", "2016-08-13", "2016-08-14", "2016-08-15", "2016-08-16", "2016-08-17", "2016-08-18", "2016-08-19", "2016-08-20", "2016-08-21", "2016-08-22", "2016-08-23", "2016-08-24", "2016-08-25", "2016-08-26", "2016-08-27", "2016-08-28", "2016-08-29", "2016-08-30", "2016-08-31", "2016-09-01", "2016-09-02", "2016-09-03", "2016-09-04", "2016-09-05", "2016-09-06", "2016-09-07", "2016-09-08", "2016-09-09", "2016-09-10", "2016-09-11", "2016-09-12", "2016-09-13", "2016-09-14", "2016-09-15", "2016-09-16", "2016-09-17", "2016-09-18", "2016-09-19", "2016-09-20", "2016-09-21", "2016-09-22", "2016-09-23", "2016-09-24", "2016-09-25", "2016-09-26", "2016-09-27", "2016-09-28", "2016-09-29", "2016-09-30", "2016-10-01", "2016-10-02", "2016-10-03", "2016-10-04", "2016-10-05", "2016-10-06", "2016-10-07", "2016-10-08", "2016-10-09", "2016-10-10", "2016-10-11", "2016-10-12", "2016-10-13", "2016-10-14", "2016-10-15", "2016-10-16", "2016-10-17", "2016-10-18", "2016-10-19", "2016-10-20", "2016-10-21", "2016-10-22", "2016-10-23", "2016-10-24", "2016-10-25", "2016-10-26", "2016-10-27", "2016-10-28", "2016-10-29", "2016-10-30", "2016-10-31", "2016-11-01", "2016-11-02", "2016-11-03", "2016-11-04", "2016-11-05", "2016-11-06", "2016-11-07", "2016-11-08", "2016-11-09", "2016-11-10", "2016-11-11", "2016-11-12", "2016-11-13", "2016-11-14", "2016-11-15", "2016-11-16", "2016-11-17", "2016-11-18", "2016-11-19", "2016-11-20", "2016-11-21", "2016-11-22", "2016-11-23", "2016-11-24", "2016-11-25", "2016-11-26", "2016-11-27", "2016-11-28", "2016-11-29", "2016-11-30", "2016-12-01", "2016-12-02", "2016-12-03", "2016-12-04", "2016-12-05", "2016-12-06", "2016-12-07", "2016-12-08", "2016-12-09", "2016-12-10", "2016-12-11", "2016-12-12", "2016-12-13", "2016-12-14", "2016-12-15", "2016-12-16", "2016-12-17", "2016-12-18", "2016-12-19", "2016-12-20", "2016-12-21", "2016-12-22", "2016-12-23", "2016-12-24", "2016-12-25", "2016-12-26", "2016-12-27", "2016-12-28", "2016-12-29", "2016-12-30", "2016-12-31"], "y": [10, 7, 9, 13, 8, 11, 6, 19, 15, 8, 12, 12, 18, 19, 19, 25, 13, 9, 16, 22, 16, 17, 25, 14, 7, 17, 16, 19, 28, 24, 13, 12, 12, 15, 21, 19, 23, 13, 8, 11, 18, 16, 14, 18, 15, 10, 9, 14, 17, 16, 19, 14, 14, 19, 14, 16, 17, 20, 17, 8, 16, 11, 26, 14, 23, 16, 11, 11, 15, 25, 24, 20, 16, 3, 11, 21, 14, 14, 13, 6, 10, 11, 21, 20, 16, 16, 17, 16, 16, 24, 17, 16, 25, 16, 7, 6, 18, 23, 17, 18, 16, 17, 21, 24, 20, 17, 20, 15, 11, 21, 16, 24, 32, 23, 10, 10, 13, 15, 17, 30, 14, 11, 9, 15, 11, 21, 19, 17, 18, 11, 20, 17, 15, 9, 14, 16, 10, 25, 15, 26, 17, 16, 11, 10, 9, 23, 24, 20, 21, 19, 20, 15, 30, 24, 13, 34, 22, 10, 29, 23, 19, 24, 28, 18, 8, 15, 24, 27, 29, 20, 13, 10, 14, 16, 24, 24, 19, 17, 6, 30, 20, 33, 17, 20, 16, 11, 25, 21, 18, 22, 25, 15, 9, 20, 12, 24, 13, 20, 7, 11, 14, 15, 10, 9, 16, 11, 10, 13, 23, 21, 10, 15, 10, 17, 19, 14, 10, 13, 12, 12, 6, 7, 13, 11, 16, 10, 10, 4, 15, 5, 6, 11, 13, 11, 11, 19, 9, 16, 14, 21, 17, 9, 18, 12, 14, 21, 20, 17, 12, 16, 15, 39, 30, 21, 16, 11, 19, 22, 24, 19, 31, 23, 14, 14, 19, 19, 21, 20, 16, 15, 22, 31, 23, 32, 31, 21, 6, 22, 28, 19, 17, 26, 23, 16, 18, 19, 18, 15, 29, 16, 8, 15, 17, 18, 29, 16, 13, 10, 20, 17, 23, 13, 25, 22, 11, 18, 19, 24, 30, 25, 15, 18, 16, 22, 10, 18, 15, 14, 8, 18, 22, 21, 25, 31, 19, 11, 26, 24, 19, 21, 24, 10, 11, 12, 20, 17, 23, 19, 15, 12, 27, 25, 15, 19, 19, 12, 10, 18, 22, 12, 21, 21, 20, 10, 21, 11, 22, 11, 4, 6], "mode": "lines+markers", "name": "prediction"}, {"type": "scatter", "x": ["2016-01-02", "2016-01-03", "2016-01-04", "2016-01-05", "2016-01-06", "2016-01-07", "2016-01-08", "2016-01-09", "2016-01-10", "2016-01-11", "2016-01-12", "2016-01-13", "2016-01-14", "2016-01-15", "2016-01-16", "2016-01-17", "2016-01-18", "2016-01-19", "2016-01-20", "2016-01-21", "2016-01-22", "2016-01-23", "2016-01-24", "2016-01-25", "2016-01-26", "2016-01-27", "2016-01-28", "2016-01-29", "2016-01-30", "2016-01-31", "2016-02-01", "2016-02-02", "2016-02-03", "2016-02-04", "2016-02-05", "2016-02-06", "2016-02-07", "2016-02-08", "2016-02-09", "2016-02-10", "2016-02-11", "2016-02-12", "2016-02-13", "2016-02-14", "2016-02-15", "2016-02-16", "2016-02-17", "2016-02-18", "2016-02-19", "2016-02-20", "2016-02-21", "2016-02-22", "2016-02-23", "2016-02-24", "2016-02-25", "2016-02-26", "2016-02-27", "2016-02-28", "2016-02-29", "2016-03-01", "2016-03-02", "2016-03-03", "2016-03-04", "2016-03-05", "2016-03-06", "2016-03-07", "2016-03-08", "2016-03-09", "2016-03-10", "2016-03-11", "2016-03-12", "2016-03-13", "2016-03-14", "2016-03-15", "2016-03-16", "2016-03-17", "2016-03-18", "2016-03-19", "2016-03-20", "2016-03-21", "2016-03-22", "2016-03-23", "2016-03-24", "2016-03-25", "2016-03-26", "2016-03-27", "2016-03-28", "2016-03-29", "2016-03-30", "2016-03-31", "2016-04-01", "2016-04-02", "2016-04-03", "2016-04-04", "2016-04-05", "2016-04-06", "2016-04-07", "2016-04-08", "2016-04-09", "2016-04-10", "2016-04-11", "2016-04-12", "2016-04-13", "2016-04-14", "2016-04-15", "2016-04-16", "2016-04-17", "2016-04-18", "2016-04-19", "2016-04-20", "2016-04-21", "2016-04-22", "2016-04-23", "2016-04-24", "2016-04-25", "2016-04-26", "2016-04-27", "2016-04-28", "2016-04-29", "2016-04-30", "2016-05-01", "2016-05-02", "2016-05-03", "2016-05-04", "2016-05-05", "2016-05-06", "2016-05-07", "2016-05-08", "2016-05-09", "2016-05-10", "2016-05-11", "2016-05-12", "2016-05-13", "2016-05-14", "2016-05-15", "2016-05-16", "2016-05-17", "2016-05-18", "2016-05-19", "2016-05-20", "2016-05-21", "2016-05-22", "2016-05-23", "2016-05-24", "2016-05-25", "2016-05-26", "2016-05-27", "2016-05-28", "2016-05-29", "2016-05-30", "2016-05-31", "2016-06-01", "2016-06-02", "2016-06-03", "2016-06-04", "2016-06-05", "2016-06-06", "2016-06-07", "2016-06-08", "2016-06-09", "2016-06-10", "2016-06-11", "2016-06-12", "2016-06-13", "2016-06-14", "2016-06-15", "2016-06-16", "2016-06-17", "2016-06-18", "2016-06-19", "2016-06-20", "2016-06-21", "2016-06-22", "2016-06-23", "2016-06-24", "2016-06-25", "2016-06-26", "2016-06-27", "2016-06-28", "2016-06-29", "2016-06-30", "2016-07-01", "2016-07-02", "2016-07-03", "2016-07-04", "2016-07-05", "2016-07-06", "2016-07-07", "2016-07-08", "2016-07-09", "2016-07-10", "2016-07-11", "2016-07-12", "2016-07-13", "2016-07-14", "2016-07-15", "2016-07-16", "2016-07-17", "2016-07-18", "2016-07-19", "2016-07-20", "2016-07-21", "2016-07-22", "2016-07-23", "2016-07-24", "2016-07-25", "2016-07-26", "2016-07-27", "2016-07-28", "2016-07-29", "2016-07-30", "2016-07-31", "2016-08-01", "2016-08-02", "2016-08-03", "2016-08-04", "2016-08-05", "2016-08-06", "2016-08-07", "2016-08-08", "2016-08-09", "2016-08-10", "2016-08-11", "2016-08-12", "2016-08-13", "2016-08-14", "2016-08-15", "2016-08-16", "2016-08-17", "2016-08-18", "2016-08-19", "2016-08-20", "2016-08-21", "2016-08-22", "2016-08-23", "2016-08-24", "2016-08-25", "2016-08-26", "2016-08-27", "2016-08-28", "2016-08-29", "2016-08-30", "2016-08-31", "2016-09-01", "2016-09-02", "2016-09-03", "2016-09-04", "2016-09-05", "2016-09-06", "2016-09-07", "2016-09-08", "2016-09-09", "2016-09-10", "2016-09-11", "2016-09-12", "2016-09-13", "2016-09-14", "2016-09-15", "2016-09-16", "2016-09-17", "2016-09-18", "2016-09-19", "2016-09-20", "2016-09-21", "2016-09-22", "2016-09-23", "2016-09-24", "2016-09-25", "2016-09-26", "2016-09-27", "2016-09-28", "2016-09-29", "2016-09-30", "2016-10-01", "2016-10-02", "2016-10-03", "2016-10-04", "2016-10-05", "2016-10-06", "2016-10-07", "2016-10-08", "2016-10-09", "2016-10-10", "2016-10-11", "2016-10-12", "2016-10-13", "2016-10-14", "2016-10-15", "2016-10-16", "2016-10-17", "2016-10-18", "2016-10-19", "2016-10-20", "2016-10-21", "2016-10-22", "2016-10-23", "2016-10-24", "2016-10-25", "2016-10-26", "2016-10-27", "2016-10-28", "2016-10-29", "2016-10-30", "2016-10-31", "2016-11-01", "2016-11-02", "2016-11-03", "2016-11-04", "2016-11-05", "2016-11-06", "2016-11-07", "2016-11-08", "2016-11-09", "2016-11-10", "2016-11-11", "2016-11-12", "2016-11-13", "2016-11-14", "2016-11-15", "2016-11-16", "2016-11-17", "2016-11-18", "2016-11-19", "2016-11-20", "2016-11-21", "2016-11-22", "2016-11-23", "2016-11-24", "2016-11-25", "2016-11-26", "2016-11-27", "2016-11-28", "2016-11-29", "2016-11-30", "2016-12-01", "2016-12-02", "2016-12-03", "2016-12-04", "2016-12-05", "2016-12-06", "2016-12-07", "2016-12-08", "2016-12-09", "2016-12-10", "2016-12-11", "2016-12-12", "2016-12-13", "2016-12-14", "2016-12-15", "2016-12-16", "2016-12-17", "2016-12-18", "2016-12-19", "2016-12-20", "2016-12-21", "2016-12-22", "2016-12-23", "2016-12-24", "2016-12-25", "2016-12-26", "2016-12-27", "2016-12-28", "2016-12-29", "2016-12-30", "2016-12-31"], "y": [24, 16, 13, 12, 16, 15, 15, 25, 17, 15, 9, 8, 22, 20, 26, 29, 12, 13, 18, 23, 17, 24, 20, 13, 17, 21, 18, 30, 16, 12, 16, 11, 21, 22, 17, 17, 23, 13, 9, 14, 20, 20, 24, 18, 17, 12, 13, 16, 10, 12, 19, 13, 5, 17, 23, 24, 20, 25, 22, 13, 16, 25, 17, 13, 22, 17, 9, 15, 13, 16, 19, 19, 11, 13, 12, 20, 16, 28, 26, 7, 17, 9, 20, 22, 22, 19, 8, 17, 21, 22, 22, 26, 25, 17, 11, 26, 14, 21, 33, 20, 13, 19, 14, 17, 18, 19, 9, 15, 3, 14, 15, 13, 22, 16, 16, 12, 17, 25, 21, 16, 13, 10, 21, 18, 30, 22, 14, 15, 12, 17, 24, 18, 25, 24, 21, 18, 18, 24, 14, 23, 23, 23, 17, 11, 25, 22, 24, 16, 19, 15, 8, 13, 21, 20, 28, 30, 12, 17, 20, 18, 29, 25, 17, 19, 18, 16, 15, 25, 27, 18, 20, 25, 19, 26, 29, 24, 21, 18, 12, 19, 24, 29, 28, 19, 17, 20, 33, 19, 23, 6, 14, 11, 12, 14, 17, 19, 15, 19, 16, 11, 27, 20, 19, 18, 19, 13, 11, 15, 14, 18, 15, 10, 13, 10, 10, 6, 13, 2, 11, 8, 8, 3, 12, 5, 15, 8, 10, 10, 14, 19, 15, 22, 10, 10, 11, 12, 19, 15, 16, 23, 9, 15, 29, 20, 27, 20, 22, 20, 12, 16, 23, 27, 25, 21, 16, 10, 20, 10, 24, 26, 21, 18, 9, 19, 20, 18, 19, 22, 20, 15, 18, 25, 9, 45, 18, 17, 16, 23, 27, 18, 30, 30, 15, 14, 20, 23, 24, 23, 18, 10, 17, 19, 17, 16, 18, 18, 15, 11, 23, 14, 23, 14, 30, 15, 12, 18, 18, 26, 31, 15, 19, 9, 19, 19, 21, 34, 23, 18, 16, 21, 13, 24, 17, 20, 14, 17, 20, 31, 27, 23, 23, 14, 10, 16, 16, 18, 20, 13, 16, 8, 17, 23, 18, 19, 18, 11, 6, 13, 10, 17, 26, 15, 12, 9, 16, 17, 12, 12, 16, 8], "mode": "lines+markers", "name": "target"}], {}, {"showLink": true, "linkText": "Export to plot.ly"})</script><script type="text/javascript">window.addEventListener("resize", function(){Plotly.Plots.resize(document.getElementById("21d4d405-eb35-4707-9fda-7393d0b88ffb"));});</script></body></html>
</div>

<h3 id="prophet">Prophet:</h3>

<p>We will first try the Prophet library, made by Facebook. Prophet is a forecasting tool developed by Facebook for its capacity planning. It is Highly efficient when it comes to human-scale problems. It is based on Generalized additive models.</p>

<p>The Library itself is easily usable since the model will parameter itself for the most part. It also takes directly raw dates and Holidays without the need of preprocessing those variables.</p>

<p>Let&rsquo;s try this model on our data.</p>

<pre><code class="language-python">from fbprophet import Prophet
</code></pre>

<pre><code class="language-python">#Initialisation of the model.
model = Prophet(holidays = holidays , yearly_seasonality=True , weekly_seasonality=True, daily_seasonality=False)

#Regressors we want to add to the model.
for col in ['temperature' , 'dd' , 'windspeed' , 'u' , 'nebulosity']:
    model.add_regressor(col)

#train &amp; test set.
histo , new = dtsers[dtsers.day.dt.year &lt; 2016].reset_index(drop = True) , dtsers[dtsers.day.dt.year 
                                                                                  == 2016].reset_index(drop = True)

# We rename the columns before fitting the model to Prophet.
ncols = histo.columns.values
ncols[0] , ncols[1] = 'ds' , 'y'

histo.columns , new.columns = ncols , ncols

# We fit the model.
model.fit(histo)


# Prediction
ypred = model.predict(new)['yhat'].round()

# Evaluation
evaluate(new.y , ypred , dtsers.day[-365:])
</code></pre>

<pre><code>Mean Absolute Error   : 3.91
Root Mean Square Error: 5.1
Mean Percentage Error : 0.25
Error Density :
</code></pre>

<p><img src="/accidents/output_46_1.png" alt="png" /></p>

<pre><code>Mean Error                       : 1.49
True Value And error Correlation : 0.64
</code></pre>

<div>
<html><head><meta charset="utf-8" /></head><body><div id="2fb4f8f8-a717-4725-b8c1-5ace2752a487" style="height: 100%; width: 100%;" class="plotly-graph-div"></div><script type="text/javascript">window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("2fb4f8f8-a717-4725-b8c1-5ace2752a487", [{"type": "scatter", "x": ["2016-01-02", "2016-01-03", "2016-01-04", "2016-01-05", "2016-01-06", "2016-01-07", "2016-01-08", "2016-01-09", "2016-01-10", "2016-01-11", "2016-01-12", "2016-01-13", "2016-01-14", "2016-01-15", "2016-01-16", "2016-01-17", "2016-01-18", "2016-01-19", "2016-01-20", "2016-01-21", "2016-01-22", "2016-01-23", "2016-01-24", "2016-01-25", "2016-01-26", "2016-01-27", "2016-01-28", "2016-01-29", "2016-01-30", "2016-01-31", "2016-02-01", "2016-02-02", "2016-02-03", "2016-02-04", "2016-02-05", "2016-02-06", "2016-02-07", "2016-02-08", "2016-02-09", "2016-02-10", "2016-02-11", "2016-02-12", "2016-02-13", "2016-02-14", "2016-02-15", "2016-02-16", "2016-02-17", "2016-02-18", "2016-02-19", "2016-02-20", "2016-02-21", "2016-02-22", "2016-02-23", "2016-02-24", "2016-02-25", "2016-02-26", "2016-02-27", "2016-02-28", "2016-02-29", "2016-03-01", "2016-03-02", "2016-03-03", "2016-03-04", "2016-03-05", "2016-03-06", "2016-03-07", "2016-03-08", "2016-03-09", "2016-03-10", "2016-03-11", "2016-03-12", "2016-03-13", "2016-03-14", "2016-03-15", "2016-03-16", "2016-03-17", "2016-03-18", "2016-03-19", "2016-03-20", "2016-03-21", "2016-03-22", "2016-03-23", "2016-03-24", "2016-03-25", "2016-03-26", "2016-03-27", "2016-03-28", "2016-03-29", "2016-03-30", "2016-03-31", "2016-04-01", "2016-04-02", "2016-04-03", "2016-04-04", "2016-04-05", "2016-04-06", "2016-04-07", "2016-04-08", "2016-04-09", "2016-04-10", "2016-04-11", "2016-04-12", "2016-04-13", "2016-04-14", "2016-04-15", "2016-04-16", "2016-04-17", "2016-04-18", "2016-04-19", "2016-04-20", "2016-04-21", "2016-04-22", "2016-04-23", "2016-04-24", "2016-04-25", "2016-04-26", "2016-04-27", "2016-04-28", "2016-04-29", "2016-04-30", "2016-05-01", "2016-05-02", "2016-05-03", "2016-05-04", "2016-05-05", "2016-05-06", "2016-05-07", "2016-05-08", "2016-05-09", "2016-05-10", "2016-05-11", "2016-05-12", "2016-05-13", "2016-05-14", "2016-05-15", "2016-05-16", "2016-05-17", "2016-05-18", "2016-05-19", "2016-05-20", "2016-05-21", "2016-05-22", "2016-05-23", "2016-05-24", "2016-05-25", "2016-05-26", "2016-05-27", "2016-05-28", "2016-05-29", "2016-05-30", "2016-05-31", "2016-06-01", "2016-06-02", "2016-06-03", "2016-06-04", "2016-06-05", "2016-06-06", "2016-06-07", "2016-06-08", "2016-06-09", "2016-06-10", "2016-06-11", "2016-06-12", "2016-06-13", "2016-06-14", "2016-06-15", "2016-06-16", "2016-06-17", "2016-06-18", "2016-06-19", "2016-06-20", "2016-06-21", "2016-06-22", "2016-06-23", "2016-06-24", "2016-06-25", "2016-06-26", "2016-06-27", "2016-06-28", "2016-06-29", "2016-06-30", "2016-07-01", "2016-07-02", "2016-07-03", "2016-07-04", "2016-07-05", "2016-07-06", "2016-07-07", "2016-07-08", "2016-07-09", "2016-07-10", "2016-07-11", "2016-07-12", "2016-07-13", "2016-07-14", "2016-07-15", "2016-07-16", "2016-07-17", "2016-07-18", "2016-07-19", "2016-07-20", "2016-07-21", "2016-07-22", "2016-07-23", "2016-07-24", "2016-07-25", "2016-07-26", "2016-07-27", "2016-07-28", "2016-07-29", "2016-07-30", "2016-07-31", "2016-08-01", "2016-08-02", "2016-08-03", "2016-08-04", "2016-08-05", "2016-08-06", "2016-08-07", "2016-08-08", "2016-08-09", "2016-08-10", "2016-08-11", "2016-08-12", "2016-08-13", "2016-08-14", "2016-08-15", "2016-08-16", "2016-08-17", "2016-08-18", "2016-08-19", "2016-08-20", "2016-08-21", "2016-08-22", "2016-08-23", "2016-08-24", "2016-08-25", "2016-08-26", "2016-08-27", "2016-08-28", "2016-08-29", "2016-08-30", "2016-08-31", "2016-09-01", "2016-09-02", "2016-09-03", "2016-09-04", "2016-09-05", "2016-09-06", "2016-09-07", "2016-09-08", "2016-09-09", "2016-09-10", "2016-09-11", "2016-09-12", "2016-09-13", "2016-09-14", "2016-09-15", "2016-09-16", "2016-09-17", "2016-09-18", "2016-09-19", "2016-09-20", "2016-09-21", "2016-09-22", "2016-09-23", "2016-09-24", "2016-09-25", "2016-09-26", "2016-09-27", "2016-09-28", "2016-09-29", "2016-09-30", "2016-10-01", "2016-10-02", "2016-10-03", "2016-10-04", "2016-10-05", "2016-10-06", "2016-10-07", "2016-10-08", "2016-10-09", "2016-10-10", "2016-10-11", "2016-10-12", "2016-10-13", "2016-10-14", "2016-10-15", "2016-10-16", "2016-10-17", "2016-10-18", "2016-10-19", "2016-10-20", "2016-10-21", "2016-10-22", "2016-10-23", "2016-10-24", "2016-10-25", "2016-10-26", "2016-10-27", "2016-10-28", "2016-10-29", "2016-10-30", "2016-10-31", "2016-11-01", "2016-11-02", "2016-11-03", "2016-11-04", "2016-11-05", "2016-11-06", "2016-11-07", "2016-11-08", "2016-11-09", "2016-11-10", "2016-11-11", "2016-11-12", "2016-11-13", "2016-11-14", "2016-11-15", "2016-11-16", "2016-11-17", "2016-11-18", "2016-11-19", "2016-11-20", "2016-11-21", "2016-11-22", "2016-11-23", "2016-11-24", "2016-11-25", "2016-11-26", "2016-11-27", "2016-11-28", "2016-11-29", "2016-11-30", "2016-12-01", "2016-12-02", "2016-12-03", "2016-12-04", "2016-12-05", "2016-12-06", "2016-12-07", "2016-12-08", "2016-12-09", "2016-12-10", "2016-12-11", "2016-12-12", "2016-12-13", "2016-12-14", "2016-12-15", "2016-12-16", "2016-12-17", "2016-12-18", "2016-12-19", "2016-12-20", "2016-12-21", "2016-12-22", "2016-12-23", "2016-12-24", "2016-12-25", "2016-12-26", "2016-12-27", "2016-12-28", "2016-12-29", "2016-12-30", "2016-12-31"], "y": [12.0, 9.0, 4.0, 12.0, 13.0, 14.0, 14.0, 14.0, 9.0, 6.0, 13.0, 16.0, 16.0, 16.0, 18.0, 12.0, 6.0, 13.0, 15.0, 16.0, 17.0, 18.0, 13.0, 9.0, 17.0, 19.0, 19.0, 18.0, 21.0, 14.0, 10.0, 16.0, 18.0, 19.0, 18.0, 18.0, 12.0, 9.0, 16.0, 17.0, 17.0, 16.0, 16.0, 11.0, 7.0, 14.0, 16.0, 15.0, 15.0, 17.0, 12.0, 8.0, 14.0, 15.0, 16.0, 17.0, 17.0, 11.0, 8.0, 16.0, 16.0, 18.0, 18.0, 18.0, 12.0, 8.0, 14.0, 16.0, 17.0, 16.0, 18.0, 14.0, 11.0, 16.0, 18.0, 18.0, 19.0, 20.0, 12.0, 8.0, 15.0, 17.0, 18.0, 17.0, 19.0, 14.0, 10.0, 8.0, 19.0, 18.0, 19.0, 19.0, 14.0, 11.0, 16.0, 19.0, 20.0, 20.0, 19.0, 14.0, 11.0, 16.0, 19.0, 19.0, 19.0, 20.0, 14.0, 9.0, 17.0, 19.0, 19.0, 17.0, 18.0, 12.0, 8.0, 15.0, 16.0, 17.0, 17.0, 18.0, 13.0, 7.0, 15.0, 18.0, 20.0, 9.0, 20.0, 14.0, 4.0, 17.0, 19.0, 19.0, 19.0, 21.0, 15.0, 11.0, 10.0, 20.0, 20.0, 20.0, 21.0, 15.0, 11.0, 17.0, 19.0, 21.0, 20.0, 22.0, 15.0, 11.0, 18.0, 19.0, 20.0, 20.0, 20.0, 15.0, 11.0, 18.0, 22.0, 22.0, 22.0, 21.0, 16.0, 12.0, 19.0, 21.0, 22.0, 21.0, 22.0, 17.0, 13.0, 20.0, 22.0, 23.0, 25.0, 23.0, 17.0, 14.0, 19.0, 21.0, 22.0, 22.0, 23.0, 16.0, 11.0, 18.0, 20.0, 20.0, 22.0, 22.0, 16.0, 12.0, 16.0, 18.0, 18.0, 10.0, 19.0, 13.0, 11.0, 16.0, 19.0, 18.0, 17.0, 17.0, 12.0, 8.0, 12.0, 15.0, 14.0, 14.0, 16.0, 8.0, 4.0, 10.0, 12.0, 12.0, 11.0, 13.0, 7.0, 4.0, 8.0, 11.0, 11.0, 10.0, 12.0, 6.0, 2.0, 7.0, 12.0, 12.0, 11.0, 12.0, 8.0, 3.0, 11.0, 15.0, 16.0, 16.0, 17.0, 11.0, 8.0, 12.0, 17.0, 18.0, 18.0, 18.0, 13.0, 9.0, 15.0, 19.0, 21.0, 22.0, 22.0, 16.0, 11.0, 19.0, 21.0, 22.0, 21.0, 22.0, 17.0, 13.0, 19.0, 21.0, 23.0, 22.0, 24.0, 19.0, 14.0, 20.0, 22.0, 23.0, 25.0, 23.0, 19.0, 15.0, 22.0, 25.0, 25.0, 25.0, 24.0, 18.0, 15.0, 20.0, 23.0, 24.0, 22.0, 22.0, 18.0, 14.0, 20.0, 22.0, 22.0, 21.0, 21.0, 16.0, 12.0, 17.0, 19.0, 21.0, 20.0, 20.0, 15.0, 13.0, 19.0, 14.0, 20.0, 20.0, 20.0, 15.0, 11.0, 17.0, 19.0, 21.0, 21.0, 16.0, 15.0, 12.0, 17.0, 20.0, 22.0, 23.0, 24.0, 17.0, 14.0, 20.0, 22.0, 22.0, 23.0, 23.0, 17.0, 14.0, 22.0, 23.0, 22.0, 23.0, 21.0, 18.0, 14.0, 20.0, 20.0, 20.0, 21.0, 22.0, 15.0, 11.0, 16.0, 18.0, 19.0, 18.0, 19.0, 14.0, 7.0, 13.0, 15.0, 16.0, 15.0, 15.0, 10.0, -4.0, 12.0, 13.0, 13.0, 12.0, 11.0, 5.0], "mode": "lines+markers", "name": "prediction"}, {"type": "scatter", "x": ["2016-01-02", "2016-01-03", "2016-01-04", "2016-01-05", "2016-01-06", "2016-01-07", "2016-01-08", "2016-01-09", "2016-01-10", "2016-01-11", "2016-01-12", "2016-01-13", "2016-01-14", "2016-01-15", "2016-01-16", "2016-01-17", "2016-01-18", "2016-01-19", "2016-01-20", "2016-01-21", "2016-01-22", "2016-01-23", "2016-01-24", "2016-01-25", "2016-01-26", "2016-01-27", "2016-01-28", "2016-01-29", "2016-01-30", "2016-01-31", "2016-02-01", "2016-02-02", "2016-02-03", "2016-02-04", "2016-02-05", "2016-02-06", "2016-02-07", "2016-02-08", "2016-02-09", "2016-02-10", "2016-02-11", "2016-02-12", "2016-02-13", "2016-02-14", "2016-02-15", "2016-02-16", "2016-02-17", "2016-02-18", "2016-02-19", "2016-02-20", "2016-02-21", "2016-02-22", "2016-02-23", "2016-02-24", "2016-02-25", "2016-02-26", "2016-02-27", "2016-02-28", "2016-02-29", "2016-03-01", "2016-03-02", "2016-03-03", "2016-03-04", "2016-03-05", "2016-03-06", "2016-03-07", "2016-03-08", "2016-03-09", "2016-03-10", "2016-03-11", "2016-03-12", "2016-03-13", "2016-03-14", "2016-03-15", "2016-03-16", "2016-03-17", "2016-03-18", "2016-03-19", "2016-03-20", "2016-03-21", "2016-03-22", "2016-03-23", "2016-03-24", "2016-03-25", "2016-03-26", "2016-03-27", "2016-03-28", "2016-03-29", "2016-03-30", "2016-03-31", "2016-04-01", "2016-04-02", "2016-04-03", "2016-04-04", "2016-04-05", "2016-04-06", "2016-04-07", "2016-04-08", "2016-04-09", "2016-04-10", "2016-04-11", "2016-04-12", "2016-04-13", "2016-04-14", "2016-04-15", "2016-04-16", "2016-04-17", "2016-04-18", "2016-04-19", "2016-04-20", "2016-04-21", "2016-04-22", "2016-04-23", "2016-04-24", "2016-04-25", "2016-04-26", "2016-04-27", "2016-04-28", "2016-04-29", "2016-04-30", "2016-05-01", "2016-05-02", "2016-05-03", "2016-05-04", "2016-05-05", "2016-05-06", "2016-05-07", "2016-05-08", "2016-05-09", "2016-05-10", "2016-05-11", "2016-05-12", "2016-05-13", "2016-05-14", "2016-05-15", "2016-05-16", "2016-05-17", "2016-05-18", "2016-05-19", "2016-05-20", "2016-05-21", "2016-05-22", "2016-05-23", "2016-05-24", "2016-05-25", "2016-05-26", "2016-05-27", "2016-05-28", "2016-05-29", "2016-05-30", "2016-05-31", "2016-06-01", "2016-06-02", "2016-06-03", "2016-06-04", "2016-06-05", "2016-06-06", "2016-06-07", "2016-06-08", "2016-06-09", "2016-06-10", "2016-06-11", "2016-06-12", "2016-06-13", "2016-06-14", "2016-06-15", "2016-06-16", "2016-06-17", "2016-06-18", "2016-06-19", "2016-06-20", "2016-06-21", "2016-06-22", "2016-06-23", "2016-06-24", "2016-06-25", "2016-06-26", "2016-06-27", "2016-06-28", "2016-06-29", "2016-06-30", "2016-07-01", "2016-07-02", "2016-07-03", "2016-07-04", "2016-07-05", "2016-07-06", "2016-07-07", "2016-07-08", "2016-07-09", "2016-07-10", "2016-07-11", "2016-07-12", "2016-07-13", "2016-07-14", "2016-07-15", "2016-07-16", "2016-07-17", "2016-07-18", "2016-07-19", "2016-07-20", "2016-07-21", "2016-07-22", "2016-07-23", "2016-07-24", "2016-07-25", "2016-07-26", "2016-07-27", "2016-07-28", "2016-07-29", "2016-07-30", "2016-07-31", "2016-08-01", "2016-08-02", "2016-08-03", "2016-08-04", "2016-08-05", "2016-08-06", "2016-08-07", "2016-08-08", "2016-08-09", "2016-08-10", "2016-08-11", "2016-08-12", "2016-08-13", "2016-08-14", "2016-08-15", "2016-08-16", "2016-08-17", "2016-08-18", "2016-08-19", "2016-08-20", "2016-08-21", "2016-08-22", "2016-08-23", "2016-08-24", "2016-08-25", "2016-08-26", "2016-08-27", "2016-08-28", "2016-08-29", "2016-08-30", "2016-08-31", "2016-09-01", "2016-09-02", "2016-09-03", "2016-09-04", "2016-09-05", "2016-09-06", "2016-09-07", "2016-09-08", "2016-09-09", "2016-09-10", "2016-09-11", "2016-09-12", "2016-09-13", "2016-09-14", "2016-09-15", "2016-09-16", "2016-09-17", "2016-09-18", "2016-09-19", "2016-09-20", "2016-09-21", "2016-09-22", "2016-09-23", "2016-09-24", "2016-09-25", "2016-09-26", "2016-09-27", "2016-09-28", "2016-09-29", "2016-09-30", "2016-10-01", "2016-10-02", "2016-10-03", "2016-10-04", "2016-10-05", "2016-10-06", "2016-10-07", "2016-10-08", "2016-10-09", "2016-10-10", "2016-10-11", "2016-10-12", "2016-10-13", "2016-10-14", "2016-10-15", "2016-10-16", "2016-10-17", "2016-10-18", "2016-10-19", "2016-10-20", "2016-10-21", "2016-10-22", "2016-10-23", "2016-10-24", "2016-10-25", "2016-10-26", "2016-10-27", "2016-10-28", "2016-10-29", "2016-10-30", "2016-10-31", "2016-11-01", "2016-11-02", "2016-11-03", "2016-11-04", "2016-11-05", "2016-11-06", "2016-11-07", "2016-11-08", "2016-11-09", "2016-11-10", "2016-11-11", "2016-11-12", "2016-11-13", "2016-11-14", "2016-11-15", "2016-11-16", "2016-11-17", "2016-11-18", "2016-11-19", "2016-11-20", "2016-11-21", "2016-11-22", "2016-11-23", "2016-11-24", "2016-11-25", "2016-11-26", "2016-11-27", "2016-11-28", "2016-11-29", "2016-11-30", "2016-12-01", "2016-12-02", "2016-12-03", "2016-12-04", "2016-12-05", "2016-12-06", "2016-12-07", "2016-12-08", "2016-12-09", "2016-12-10", "2016-12-11", "2016-12-12", "2016-12-13", "2016-12-14", "2016-12-15", "2016-12-16", "2016-12-17", "2016-12-18", "2016-12-19", "2016-12-20", "2016-12-21", "2016-12-22", "2016-12-23", "2016-12-24", "2016-12-25", "2016-12-26", "2016-12-27", "2016-12-28", "2016-12-29", "2016-12-30", "2016-12-31"], "y": [6, 7, 11, 12, 27, 21, 24, 16, 13, 12, 16, 15, 15, 25, 17, 15, 9, 8, 22, 20, 26, 29, 12, 13, 18, 23, 17, 24, 20, 13, 17, 21, 18, 30, 16, 12, 16, 11, 21, 22, 17, 17, 23, 13, 9, 14, 20, 20, 24, 18, 17, 12, 13, 16, 10, 12, 19, 13, 5, 17, 23, 24, 20, 25, 22, 13, 16, 25, 17, 13, 22, 17, 9, 15, 13, 16, 19, 19, 11, 13, 12, 20, 16, 28, 26, 7, 17, 9, 20, 22, 22, 19, 8, 17, 21, 22, 22, 26, 25, 17, 11, 26, 14, 21, 33, 20, 13, 19, 14, 17, 18, 19, 9, 15, 3, 14, 15, 13, 22, 16, 16, 12, 17, 25, 21, 16, 13, 10, 21, 18, 30, 22, 14, 15, 12, 17, 24, 18, 25, 24, 21, 18, 18, 24, 14, 23, 23, 23, 17, 11, 25, 22, 24, 16, 19, 15, 8, 13, 21, 20, 28, 30, 12, 17, 20, 18, 29, 25, 17, 19, 18, 16, 15, 25, 27, 18, 20, 25, 19, 26, 29, 24, 21, 18, 12, 19, 24, 29, 28, 19, 17, 20, 33, 19, 23, 6, 14, 11, 12, 14, 17, 19, 15, 19, 16, 11, 27, 20, 19, 18, 19, 13, 11, 15, 14, 18, 15, 10, 13, 10, 10, 6, 13, 2, 11, 8, 8, 3, 12, 5, 15, 8, 10, 10, 14, 19, 15, 22, 10, 10, 11, 12, 19, 15, 16, 23, 9, 15, 29, 20, 27, 20, 22, 20, 12, 16, 23, 27, 25, 21, 16, 10, 20, 10, 24, 26, 21, 18, 9, 19, 20, 18, 19, 22, 20, 15, 18, 25, 9, 45, 18, 17, 16, 23, 27, 18, 30, 30, 15, 14, 20, 23, 24, 23, 18, 10, 17, 19, 17, 16, 18, 18, 15, 11, 23, 14, 23, 14, 30, 15, 12, 18, 18, 26, 31, 15, 19, 9, 19, 19, 21, 34, 23, 18, 16, 21, 13, 24, 17, 20, 14, 17, 20, 31, 27, 23, 23, 14, 10, 16, 16, 18, 20, 13, 16, 8, 17, 23, 18, 19, 18, 11, 6, 13, 10, 17, 26, 15, 12, 9, 16, 17, 12, 12, 16, 8], "mode": "lines+markers", "name": "target"}] , {}, {"showLink": true, "linkText": "Export to plot.ly"})</script><script type="text/javascript">window.addEventListener("resize", function(){Plotly.Plots.resize(document.getElementById("21d4d405-eb35-4707-9fda-7393d0b88ffb"));});</script></body></html>
</div>

<p>We can see a clear improvement compared to the Naïve model. we were able to reduce the Mean Percentage error by 7% and we also improved the other metrics.</p>

<h3 id="lstms">LSTMs:</h3>

<p>Let&rsquo;s now try LSTMs (Long short-term memory networks). this architecture is adapted to sequence models and is usually used for NLP tasks, but we can also use it for time series modeling.</p>

<pre><code class="language-python">import keras
from keras.models import Sequential , load_model
from keras.layers import Dense , LSTM, Dropout , Conv1D , MaxPooling1D , Reshape , Activation
from keras.layers import Masking , TimeDistributed, Bidirectional
from keras.preprocessing.sequence import TimeseriesGenerator
from sklearn.preprocessing import MinMaxScaler
from sklearn.metrics import mean_squared_error
from keras.callbacks import History , ModelCheckpoint
</code></pre>

<pre><code>Using TensorFlow backend.
</code></pre>

<p>First, We need to reshape the data we have from a 2D input to a 3D input.</p>

<p>To model our problem. We will take small windows from our time series and predict the last values with the previous values (lags). This way we will have multiple small sequences rather than a single big sequence.</p>

<p>The input the LSTM needs is as the following: (batch_size, timesteps, features). Timesteps is the number of steps in our sequence (the window size in our case) and features are the number of features per step (lag + other features).</p>

<p>We will suppose that we have the weather features for the day we want to predict, so we will add these data to the sequence with a lag of -2 to keep the same shape.</p>

<p>The function below applies all these transformations to a time series and scales the output before fitting it to our model.</p>

<pre><code class="language-python">def reshape_timeseries(series , target_ids, window_size , take_curr = True , scale = True):
    
    
    # Converting the dataset to a suitable format :
    X = series.values
    Y = series.iloc[ : , target_ids].values
    
    # Scaling the data  
    if scale:
        maxes = Y.max(axis = 0)
        Y = np.divide( Y , maxes)
        X = MinMaxScaler().fit_transform(X)
    
    # Conversion to time series with keras object
    ts = TimeseriesGenerator(X , Y , length = window_size , batch_size = X.shape[0])
    X , Y = ts[0]
    
    # Masking
    if take_curr:
        for timestep in X[: , window_size - 1]:
            timestep[target_ids] = [-2 for i in target_ids]
    else:
        X = X[: , :-1]
        
    if scale:
        return X , Y , maxes

    return X,Y
</code></pre>

<p>Now let&rsquo;s build our model. The function below constructs a Keras sequential model by stacking a Masking layer, multiple BI-LSTM layers and multiple Dense Layers (number of layers and number of neurons per layer, as well as Dropout per layer, are set by the user).</p>

<pre><code class="language-python">def model(X , Y , lr = 0.001,
          lstm_layers = [] , lstm_dropout = [],
          dense_layers = [] , dense_dropout = [] ,
          ntest_day = 365 , epochs = 10 , batch_size = 32):
        
        
    # training and testing set :
    length , timesteps , features = X.shape[0] , X.shape[1] , X.shape[2]
    target_shape = Y.shape[1]
    
    # Validation rate to pass to the Sequential Model :
    val_rate = ntest_day/length
    
    
    ############################################ Model :
    
    checkpoint = ModelCheckpoint('models/model' , save_best_only=True)
    
    model = Sequential()
    
    # Masking Layer.
    model.add(Masking(mask_value = -2 , input_shape=(X.shape[1],  X.shape[2])    ))
    
    
    # BI-LSTM Layers.
    for i in range(len(lstm_layers)):
        rsequs  = not (i == (len(lstm_layers) - 1))
        model.add(Bidirectional( LSTM(lstm_layers[i] , return_sequences = rsequs) ,input_shape=(X.shape[1], X.shape[2]) ) )
        model.add(Dropout(lstm_dropout[i]))


    # Dense Layers.
    for i in range(len(dense_layers)): 
        model.add(Dense(dense_layers[i]) )
        model.add(Dropout(dense_dropout[i]))
        model.add(Activation('relu'))
        
    
    model.add(Dense(target_shape))
    Nadam = keras.optimizers.Nadam(lr = lr , beta_1=0.9, beta_2=0.999, epsilon=1e-08)#, schedule_decay=0.0004)
    model.compile(loss='mean_squared_error', optimizer='adam')
    
    print('Model Summary:')
    print(model.summary())
    
    # fitting the data
    print('\n\n Training :')
    model.fit(X, Y, epochs= epochs, batch_size=batch_size, validation_split = val_rate, callbacks = [checkpoint])
    
    
    # loading best_model
    model = load_model('models/model')
    return model
</code></pre>

<p>Training the model.</p>

<pre><code class="language-python">X , Y , maxes  = reshape_timeseries(dtsers.iloc[:, 1:] , [0], window_size = 28 , take_curr = True , scale = True)
ntest_day = 365

nmodel = model(X , Y , lr = 0.002, lstm_layers = [20 ] , lstm_dropout = [.3 ] ,
               dense_layers = [500] , dense_dropout = [.5] , batch_size = 64 , epochs = 20)

# Computing Validation scores : MAE - RMSE - MPE
y_predict = nmodel.predict(X[- ntest_day:]) * maxes
y_true = Y[- ntest_day:] * maxes

evaluate(y_true , y_predict , dtsers.day[-365:])
</code></pre>

<pre><code>Model Summary:
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
masking_1 (Masking)          (None, 28, 31)            0         
_________________________________________________________________
bidirectional_1 (Bidirection (None, 40)                8320      
_________________________________________________________________
dropout_1 (Dropout)          (None, 40)                0         
_________________________________________________________________
dense_1 (Dense)              (None, 500)               20500     
_________________________________________________________________
dropout_2 (Dropout)          (None, 500)               0         
_________________________________________________________________
activation_1 (Activation)    (None, 500)               0         
_________________________________________________________________
dense_2 (Dense)              (None, 1)                 501       
=================================================================
Total params: 29,321
Trainable params: 29,321
Non-trainable params: 0
_________________________________________________________________
None


 Training :
Train on 3986 samples, validate on 365 samples
Epoch 1/20
3986/3986 [==============================] - 30s 7ms/step - loss: 0.0353 - val_loss: 0.0100
Epoch 2/20
3986/3986 [==============================] - 13s 3ms/step - loss: 0.0183 - val_loss: 0.0093
Epoch 3/20
3986/3986 [==============================] - 13s 3ms/step - loss: 0.0175 - val_loss: 0.0094
Epoch 4/20
3986/3986 [==============================] - 13s 3ms/step - loss: 0.0161 - val_loss: 0.0098
Epoch 5/20
3986/3986 [==============================] - 13s 3ms/step - loss: 0.0151 - val_loss: 0.0110
Epoch 6/20
3986/3986 [==============================] - 12s 3ms/step - loss: 0.0147 - val_loss: 0.0099
Epoch 7/20
3986/3986 [==============================] - 11s 3ms/step - loss: 0.0145 - val_loss: 0.0109
Epoch 8/20
3986/3986 [==============================] - 12s 3ms/step - loss: 0.0133 - val_loss: 0.0090
Epoch 9/20
3986/3986 [==============================] - 13s 3ms/step - loss: 0.0136 - val_loss: 0.0098
Epoch 10/20
3986/3986 [==============================] - 13s 3ms/step - loss: 0.0135 - val_loss: 0.0095
Epoch 11/20
3986/3986 [==============================] - 13s 3ms/step - loss: 0.0134 - val_loss: 0.0095
Epoch 12/20
3986/3986 [==============================] - 12s 3ms/step - loss: 0.0132 - val_loss: 0.0114
Epoch 13/20
3986/3986 [==============================] - 13s 3ms/step - loss: 0.0131 - val_loss: 0.0103
Epoch 14/20
3986/3986 [==============================] - 13s 3ms/step - loss: 0.0127 - val_loss: 0.0120
Epoch 15/20
3986/3986 [==============================] - 13s 3ms/step - loss: 0.0128 - val_loss: 0.0103
Epoch 16/20
3986/3986 [==============================] - 12s 3ms/step - loss: 0.0129 - val_loss: 0.0094
Epoch 17/20
3986/3986 [==============================] - 12s 3ms/step - loss: 0.0123 - val_loss: 0.0103
Epoch 18/20
3986/3986 [==============================] - 13s 3ms/step - loss: 0.0125 - val_loss: 0.0094
Epoch 19/20
3986/3986 [==============================] - 12s 3ms/step - loss: 0.0123 - val_loss: 0.0089
Epoch 20/20
3986/3986 [==============================] - 13s 3ms/step - loss: 0.0124 - val_loss: 0.0097
Mean Absolute Error   : 3.66
Root Mean Square Error: 4.81
Mean Percentage Error : 0.25
Error Density :
</code></pre>

<p><img src="/accidents/output_56_1.png" alt="png" /></p>

<pre><code>Mean Error                       : 0.69
True Value And error Correlation : 0.8
</code></pre>

<div>
<html><head><meta charset="utf-8" /></head><body><div id="c684af64-4ff0-488c-9549-4310dc19ee4e" style="height: 100%; width: 100%;" class="plotly-graph-div"></div><script type="text/javascript">window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("c684af64-4ff0-488c-9549-4310dc19ee4e", [{"type": "scatter", "x": ["2016-01-02", "2016-01-03", "2016-01-04", "2016-01-05", "2016-01-06", "2016-01-07", "2016-01-08", "2016-01-09", "2016-01-10", "2016-01-11", "2016-01-12", "2016-01-13", "2016-01-14", "2016-01-15", "2016-01-16", "2016-01-17", "2016-01-18", "2016-01-19", "2016-01-20", "2016-01-21", "2016-01-22", "2016-01-23", "2016-01-24", "2016-01-25", "2016-01-26", "2016-01-27", "2016-01-28", "2016-01-29", "2016-01-30", "2016-01-31", "2016-02-01", "2016-02-02", "2016-02-03", "2016-02-04", "2016-02-05", "2016-02-06", "2016-02-07", "2016-02-08", "2016-02-09", "2016-02-10", "2016-02-11", "2016-02-12", "2016-02-13", "2016-02-14", "2016-02-15", "2016-02-16", "2016-02-17", "2016-02-18", "2016-02-19", "2016-02-20", "2016-02-21", "2016-02-22", "2016-02-23", "2016-02-24", "2016-02-25", "2016-02-26", "2016-02-27", "2016-02-28", "2016-02-29", "2016-03-01", "2016-03-02", "2016-03-03", "2016-03-04", "2016-03-05", "2016-03-06", "2016-03-07", "2016-03-08", "2016-03-09", "2016-03-10", "2016-03-11", "2016-03-12", "2016-03-13", "2016-03-14", "2016-03-15", "2016-03-16", "2016-03-17", "2016-03-18", "2016-03-19", "2016-03-20", "2016-03-21", "2016-03-22", "2016-03-23", "2016-03-24", "2016-03-25", "2016-03-26", "2016-03-27", "2016-03-28", "2016-03-29", "2016-03-30", "2016-03-31", "2016-04-01", "2016-04-02", "2016-04-03", "2016-04-04", "2016-04-05", "2016-04-06", "2016-04-07", "2016-04-08", "2016-04-09", "2016-04-10", "2016-04-11", "2016-04-12", "2016-04-13", "2016-04-14", "2016-04-15", "2016-04-16", "2016-04-17", "2016-04-18", "2016-04-19", "2016-04-20", "2016-04-21", "2016-04-22", "2016-04-23", "2016-04-24", "2016-04-25", "2016-04-26", "2016-04-27", "2016-04-28", "2016-04-29", "2016-04-30", "2016-05-01", "2016-05-02", "2016-05-03", "2016-05-04", "2016-05-05", "2016-05-06", "2016-05-07", "2016-05-08", "2016-05-09", "2016-05-10", "2016-05-11", "2016-05-12", "2016-05-13", "2016-05-14", "2016-05-15", "2016-05-16", "2016-05-17", "2016-05-18", "2016-05-19", "2016-05-20", "2016-05-21", "2016-05-22", "2016-05-23", "2016-05-24", "2016-05-25", "2016-05-26", "2016-05-27", "2016-05-28", "2016-05-29", "2016-05-30", "2016-05-31", "2016-06-01", "2016-06-02", "2016-06-03", "2016-06-04", "2016-06-05", "2016-06-06", "2016-06-07", "2016-06-08", "2016-06-09", "2016-06-10", "2016-06-11", "2016-06-12", "2016-06-13", "2016-06-14", "2016-06-15", "2016-06-16", "2016-06-17", "2016-06-18", "2016-06-19", "2016-06-20", "2016-06-21", "2016-06-22", "2016-06-23", "2016-06-24", "2016-06-25", "2016-06-26", "2016-06-27", "2016-06-28", "2016-06-29", "2016-06-30", "2016-07-01", "2016-07-02", "2016-07-03", "2016-07-04", "2016-07-05", "2016-07-06", "2016-07-07", "2016-07-08", "2016-07-09", "2016-07-10", "2016-07-11", "2016-07-12", "2016-07-13", "2016-07-14", "2016-07-15", "2016-07-16", "2016-07-17", "2016-07-18", "2016-07-19", "2016-07-20", "2016-07-21", "2016-07-22", "2016-07-23", "2016-07-24", "2016-07-25", "2016-07-26", "2016-07-27", "2016-07-28", "2016-07-29", "2016-07-30", "2016-07-31", "2016-08-01", "2016-08-02", "2016-08-03", "2016-08-04", "2016-08-05", "2016-08-06", "2016-08-07", "2016-08-08", "2016-08-09", "2016-08-10", "2016-08-11", "2016-08-12", "2016-08-13", "2016-08-14", "2016-08-15", "2016-08-16", "2016-08-17", "2016-08-18", "2016-08-19", "2016-08-20", "2016-08-21", "2016-08-22", "2016-08-23", "2016-08-24", "2016-08-25", "2016-08-26", "2016-08-27", "2016-08-28", "2016-08-29", "2016-08-30", "2016-08-31", "2016-09-01", "2016-09-02", "2016-09-03", "2016-09-04", "2016-09-05", "2016-09-06", "2016-09-07", "2016-09-08", "2016-09-09", "2016-09-10", "2016-09-11", "2016-09-12", "2016-09-13", "2016-09-14", "2016-09-15", "2016-09-16", "2016-09-17", "2016-09-18", "2016-09-19", "2016-09-20", "2016-09-21", "2016-09-22", "2016-09-23", "2016-09-24", "2016-09-25", "2016-09-26", "2016-09-27", "2016-09-28", "2016-09-29", "2016-09-30", "2016-10-01", "2016-10-02", "2016-10-03", "2016-10-04", "2016-10-05", "2016-10-06", "2016-10-07", "2016-10-08", "2016-10-09", "2016-10-10", "2016-10-11", "2016-10-12", "2016-10-13", "2016-10-14", "2016-10-15", "2016-10-16", "2016-10-17", "2016-10-18", "2016-10-19", "2016-10-20", "2016-10-21", "2016-10-22", "2016-10-23", "2016-10-24", "2016-10-25", "2016-10-26", "2016-10-27", "2016-10-28", "2016-10-29", "2016-10-30", "2016-10-31", "2016-11-01", "2016-11-02", "2016-11-03", "2016-11-04", "2016-11-05", "2016-11-06", "2016-11-07", "2016-11-08", "2016-11-09", "2016-11-10", "2016-11-11", "2016-11-12", "2016-11-13", "2016-11-14", "2016-11-15", "2016-11-16", "2016-11-17", "2016-11-18", "2016-11-19", "2016-11-20", "2016-11-21", "2016-11-22", "2016-11-23", "2016-11-24", "2016-11-25", "2016-11-26", "2016-11-27", "2016-11-28", "2016-11-29", "2016-11-30", "2016-12-01", "2016-12-02", "2016-12-03", "2016-12-04", "2016-12-05", "2016-12-06", "2016-12-07", "2016-12-08", "2016-12-09", "2016-12-10", "2016-12-11", "2016-12-12", "2016-12-13", "2016-12-14", "2016-12-15", "2016-12-16", "2016-12-17", "2016-12-18", "2016-12-19", "2016-12-20", "2016-12-21", "2016-12-22", "2016-12-23", "2016-12-24", "2016-12-25", "2016-12-26", "2016-12-27", "2016-12-28", "2016-12-29", "2016-12-30", "2016-12-31"], "y": [11.867555111646652, 9.655715078115463, 8.490680873394012, 10.582425311207771, 12.74128782749176, 14.962469279766083, 15.599918514490128, 15.462017834186554, 12.512062847614288, 9.924174472689629, 13.381687223911285, 15.49677836894989, 17.877042084932327, 18.14927163720131, 18.325120121240616, 14.057857900857925, 11.210502728819847, 15.18177679181099, 16.988862544298172, 18.75766611099243, 18.61800992488861, 19.095164000988007, 14.684489876031876, 11.794434875249863, 16.11534109711647, 18.964271664619446, 20.66818991303444, 20.166141092777252, 19.80359646677971, 15.846665114164352, 12.061517983675003, 16.844330459833145, 18.89195242524147, 20.12254223227501, 19.746327459812164, 20.759509652853012, 15.787368535995483, 11.981074780225754, 16.489335268735886, 18.95099213719368, 19.122913151979446, 18.902459621429443, 18.686535447835922, 14.306056022644043, 11.203810527920723, 14.158233314752579, 16.429409444332123, 18.022945135831833, 17.753437757492065, 18.034002542495728, 14.459139168262482, 11.780983597040176, 15.503949344158173, 17.344681531190872, 17.138911932706833, 17.405732095241547, 17.60482621192932, 13.555506616830826, 11.294960796833038, 15.236730962991714, 17.93018451333046, 18.391767024993896, 18.266621500253677, 19.13909724354744, 14.260181844234467, 11.286251664161682, 14.66899886727333, 17.21781089901924, 18.748230457305908, 18.93680825829506, 19.572491347789764, 14.420888900756836, 12.112996101379395, 17.104484260082245, 19.806371837854385, 20.676436990499496, 19.841453075408936, 20.218544840812683, 15.267092853784561, 11.671385318040848, 14.595340579748154, 16.797398418188095, 17.93175306916237, 18.114146322011948, 18.100862234830856, 14.116320043802261, 11.556090384721756, 14.328125238418579, 17.19934692978859, 17.70570319890976, 17.289356499910355, 17.241026133298874, 13.87105992436409, 11.33150115609169, 15.049723237752914, 17.135010302066803, 17.739203721284866, 18.87893584370613, 19.88539695739746, 15.047742784023285, 12.481702476739883, 16.916981041431427, 18.613734394311905, 19.485591530799866, 18.975382268428802, 19.34438654780388, 15.189779162406921, 12.478314578533173, 16.41842955350876, 19.604020535945892, 21.200313359498978, 20.87771826982498, 20.041203796863556, 14.547099888324738, 11.248247623443604, 15.475937247276306, 17.30674284696579, 17.549717009067535, 16.98821809887886, 18.366177678108215, 14.619337052106857, 12.300899058580399, 16.461373329162598, 18.97429856657982, 20.414787590503693, 20.442640095949173, 20.032356351614, 16.176604449748993, 13.723484963178635, 17.60328197479248, 20.16218474507332, 21.147693783044815, 20.540624678134918, 19.740814715623856, 16.04805278778076, 13.511187314987183, 17.677400797605515, 18.558143377304077, 20.599690228700638, 19.330834954977036, 19.7034809589386, 15.79594087600708, 13.22655674815178, 16.861054122447968, 18.89106023311615, 21.10058543086052, 20.51400026679039, 20.897861748933792, 16.595650523900986, 13.309355825185776, 17.812845289707184, 19.24361139535904, 19.517044723033905, 18.23888298869133, 18.831395834684372, 14.144309341907501, 11.35612839460373, 17.631978034973145, 20.564501076936722, 22.71495920419693, 22.68242383003235, 23.990108460187912, 17.187879145145416, 12.672627031803131, 18.146791130304337, 20.343922913074493, 22.464295774698257, 22.157860457897186, 20.415435075759888, 15.820995211601257, 11.9799302816391, 17.803493231534958, 19.650715470314026, 21.754680812358856, 21.45112270116806, 22.695951104164124, 16.003362625837326, 12.162139624357224, 19.093113631010056, 22.202663093805313, 24.49454203248024, 24.055547028779984, 24.206695318222046, 17.053814738988876, 12.624342262744904, 18.84819397330284, 20.058395594358444, 20.599629431962967, 19.616146445274353, 20.685167402029037, 15.020179063081741, 12.080152183771133, 18.57840996980667, 19.12965551018715, 19.853542506694794, 17.983696281909943, 18.097895354032516, 13.404522478580475, 10.606768324971199, 16.881270557641983, 18.609714210033417, 20.111022770404816, 18.395281076431274, 17.374009877443314, 12.204235285520554, 10.027418732643127, 15.002453774213791, 15.69851866364479, 16.882722079753876, 15.83079868555069, 16.289900690317154, 12.43445885181427, 10.227035701274872, 13.709155172109604, 14.492901116609573, 14.679817646741867, 13.566475868225098, 13.376315832138062, 10.803366735577583, 8.796877562999725, 11.687867313623428, 12.358283579349518, 13.277996867895126, 12.78294575214386, 12.770360827445984, 10.532386556267738, 8.795100018382072, 11.476755201816559, 12.414553999900818, 13.442499160766602, 13.345715314149857, 12.58630782365799, 10.58262214064598, 8.720104962587357, 11.368179827928543, 12.856876105070114, 14.364901185035706, 14.856184422969818, 15.66401195526123, 13.139889478683472, 11.398462682962418, 16.773724168539047, 17.263519406318665, 18.357810527086258, 18.540074586868286, 19.89079114794731, 15.549245953559875, 12.646622747182846, 16.76070910692215, 18.448149919509888, 20.322691172361374, 20.942448556423187, 22.994967699050903, 17.930204272270203, 14.079680889844894, 19.90984332561493, 20.75753527879715, 21.564352065324783, 21.20557987689972, 21.101853042840958, 17.201556891202927, 14.044807881116867, 19.876883894205093, 21.539332687854767, 22.539645731449127, 22.6070237159729, 23.36876732110977, 18.34190610051155, 14.800455093383789, 19.909135043621063, 21.550007075071335, 22.426963537931442, 22.048035711050034, 23.816960871219635, 17.653887659311295, 13.952994167804718, 20.44183149933815, 23.200354278087616, 24.219496071338654, 23.7107352912426, 24.445395469665527, 18.481785714626312, 14.103338420391083, 19.34691873192787, 20.795410126447678, 21.601807415485382, 21.500819474458694, 22.479379445314407, 16.639150589704514, 13.179901331663132, 18.29329150915146, 20.002651065587997, 20.765413016080856, 20.148639231920242, 21.0040280520916, 15.739652216434479, 12.030193984508514, 16.442360669374466, 17.77980074286461, 18.100562810897827, 17.737926989793777, 19.019707649946213, 15.410667389631271, 12.857392877340317, 17.688778907060623, 18.95950672030449, 18.042517125606537, 18.87517860531807, 19.6287921667099, 14.66027757525444, 12.229658961296082, 17.358325839042664, 19.006444841623306, 20.0910647213459, 19.10290038585663, 19.778165191411972, 14.662417620420456, 12.223939508199692, 17.117406606674194, 19.479803681373596, 20.158270955085754, 20.421792894601822, 21.70061883330345, 16.523024260997772, 13.29846864938736, 19.20118135213852, 21.868239998817444, 23.07085570693016, 21.87770301103592, 23.20599165558815, 16.62227037549019, 12.941164702177048, 18.492466181516647, 21.098677933216095, 22.258328586816788, 23.001880288124084, 23.764745593070984, 16.85831218957901, 13.991423785686493, 19.180425345897675, 20.541943967342377, 20.866855412721634, 20.07080116868019, 20.752095490694046, 16.221507400274277, 13.317902326583862, 17.90590837597847, 17.93455731868744, 18.13832062482834, 18.067007571458817, 17.67547506093979, 13.929117769002914, 11.802026867866516, 14.802216678857803, 14.762720078229904, 15.130114763975143, 14.451519817113876, 13.619072645902634, 10.880412921309471, 8.817952752113342, 9.681104555726051, 10.537607476115227, 11.47538423538208, 11.955652624368668, 12.084249883890152], "mode": "lines+markers", "name": "prediction"}, {"type": "scatter", "x": ["2016-01-02", "2016-01-03", "2016-01-04", "2016-01-05", "2016-01-06", "2016-01-07", "2016-01-08", "2016-01-09", "2016-01-10", "2016-01-11", "2016-01-12", "2016-01-13", "2016-01-14", "2016-01-15", "2016-01-16", "2016-01-17", "2016-01-18", "2016-01-19", "2016-01-20", "2016-01-21", "2016-01-22", "2016-01-23", "2016-01-24", "2016-01-25", "2016-01-26", "2016-01-27", "2016-01-28", "2016-01-29", "2016-01-30", "2016-01-31", "2016-02-01", "2016-02-02", "2016-02-03", "2016-02-04", "2016-02-05", "2016-02-06", "2016-02-07", "2016-02-08", "2016-02-09", "2016-02-10", "2016-02-11", "2016-02-12", "2016-02-13", "2016-02-14", "2016-02-15", "2016-02-16", "2016-02-17", "2016-02-18", "2016-02-19", "2016-02-20", "2016-02-21", "2016-02-22", "2016-02-23", "2016-02-24", "2016-02-25", "2016-02-26", "2016-02-27", "2016-02-28", "2016-02-29", "2016-03-01", "2016-03-02", "2016-03-03", "2016-03-04", "2016-03-05", "2016-03-06", "2016-03-07", "2016-03-08", "2016-03-09", "2016-03-10", "2016-03-11", "2016-03-12", "2016-03-13", "2016-03-14", "2016-03-15", "2016-03-16", "2016-03-17", "2016-03-18", "2016-03-19", "2016-03-20", "2016-03-21", "2016-03-22", "2016-03-23", "2016-03-24", "2016-03-25", "2016-03-26", "2016-03-27", "2016-03-28", "2016-03-29", "2016-03-30", "2016-03-31", "2016-04-01", "2016-04-02", "2016-04-03", "2016-04-04", "2016-04-05", "2016-04-06", "2016-04-07", "2016-04-08", "2016-04-09", "2016-04-10", "2016-04-11", "2016-04-12", "2016-04-13", "2016-04-14", "2016-04-15", "2016-04-16", "2016-04-17", "2016-04-18", "2016-04-19", "2016-04-20", "2016-04-21", "2016-04-22", "2016-04-23", "2016-04-24", "2016-04-25", "2016-04-26", "2016-04-27", "2016-04-28", "2016-04-29", "2016-04-30", "2016-05-01", "2016-05-02", "2016-05-03", "2016-05-04", "2016-05-05", "2016-05-06", "2016-05-07", "2016-05-08", "2016-05-09", "2016-05-10", "2016-05-11", "2016-05-12", "2016-05-13", "2016-05-14", "2016-05-15", "2016-05-16", "2016-05-17", "2016-05-18", "2016-05-19", "2016-05-20", "2016-05-21", "2016-05-22", "2016-05-23", "2016-05-24", "2016-05-25", "2016-05-26", "2016-05-27", "2016-05-28", "2016-05-29", "2016-05-30", "2016-05-31", "2016-06-01", "2016-06-02", "2016-06-03", "2016-06-04", "2016-06-05", "2016-06-06", "2016-06-07", "2016-06-08", "2016-06-09", "2016-06-10", "2016-06-11", "2016-06-12", "2016-06-13", "2016-06-14", "2016-06-15", "2016-06-16", "2016-06-17", "2016-06-18", "2016-06-19", "2016-06-20", "2016-06-21", "2016-06-22", "2016-06-23", "2016-06-24", "2016-06-25", "2016-06-26", "2016-06-27", "2016-06-28", "2016-06-29", "2016-06-30", "2016-07-01", "2016-07-02", "2016-07-03", "2016-07-04", "2016-07-05", "2016-07-06", "2016-07-07", "2016-07-08", "2016-07-09", "2016-07-10", "2016-07-11", "2016-07-12", "2016-07-13", "2016-07-14", "2016-07-15", "2016-07-16", "2016-07-17", "2016-07-18", "2016-07-19", "2016-07-20", "2016-07-21", "2016-07-22", "2016-07-23", "2016-07-24", "2016-07-25", "2016-07-26", "2016-07-27", "2016-07-28", "2016-07-29", "2016-07-30", "2016-07-31", "2016-08-01", "2016-08-02", "2016-08-03", "2016-08-04", "2016-08-05", "2016-08-06", "2016-08-07", "2016-08-08", "2016-08-09", "2016-08-10", "2016-08-11", "2016-08-12", "2016-08-13", "2016-08-14", "2016-08-15", "2016-08-16", "2016-08-17", "2016-08-18", "2016-08-19", "2016-08-20", "2016-08-21", "2016-08-22", "2016-08-23", "2016-08-24", "2016-08-25", "2016-08-26", "2016-08-27", "2016-08-28", "2016-08-29", "2016-08-30", "2016-08-31", "2016-09-01", "2016-09-02", "2016-09-03", "2016-09-04", "2016-09-05", "2016-09-06", "2016-09-07", "2016-09-08", "2016-09-09", "2016-09-10", "2016-09-11", "2016-09-12", "2016-09-13", "2016-09-14", "2016-09-15", "2016-09-16", "2016-09-17", "2016-09-18", "2016-09-19", "2016-09-20", "2016-09-21", "2016-09-22", "2016-09-23", "2016-09-24", "2016-09-25", "2016-09-26", "2016-09-27", "2016-09-28", "2016-09-29", "2016-09-30", "2016-10-01", "2016-10-02", "2016-10-03", "2016-10-04", "2016-10-05", "2016-10-06", "2016-10-07", "2016-10-08", "2016-10-09", "2016-10-10", "2016-10-11", "2016-10-12", "2016-10-13", "2016-10-14", "2016-10-15", "2016-10-16", "2016-10-17", "2016-10-18", "2016-10-19", "2016-10-20", "2016-10-21", "2016-10-22", "2016-10-23", "2016-10-24", "2016-10-25", "2016-10-26", "2016-10-27", "2016-10-28", "2016-10-29", "2016-10-30", "2016-10-31", "2016-11-01", "2016-11-02", "2016-11-03", "2016-11-04", "2016-11-05", "2016-11-06", "2016-11-07", "2016-11-08", "2016-11-09", "2016-11-10", "2016-11-11", "2016-11-12", "2016-11-13", "2016-11-14", "2016-11-15", "2016-11-16", "2016-11-17", "2016-11-18", "2016-11-19", "2016-11-20", "2016-11-21", "2016-11-22", "2016-11-23", "2016-11-24", "2016-11-25", "2016-11-26", "2016-11-27", "2016-11-28", "2016-11-29", "2016-11-30", "2016-12-01", "2016-12-02", "2016-12-03", "2016-12-04", "2016-12-05", "2016-12-06", "2016-12-07", "2016-12-08", "2016-12-09", "2016-12-10", "2016-12-11", "2016-12-12", "2016-12-13", "2016-12-14", "2016-12-15", "2016-12-16", "2016-12-17", "2016-12-18", "2016-12-19", "2016-12-20", "2016-12-21", "2016-12-22", "2016-12-23", "2016-12-24", "2016-12-25", "2016-12-26", "2016-12-27", "2016-12-28", "2016-12-29", "2016-12-30", "2016-12-31"], "y": [6.0, 7.000000000000001, 11.0, 12.0, 27.0, 21.0, 24.0, 16.0, 13.0, 12.0, 16.0, 15.0, 15.0, 25.0, 17.0, 15.0, 9.0, 8.0, 22.0, 20.0, 26.0, 29.0, 12.0, 13.0, 18.0, 23.0, 17.0, 24.0, 20.0, 13.0, 17.0, 21.0, 18.0, 30.0, 16.0, 12.0, 16.0, 11.0, 21.0, 22.0, 17.0, 17.0, 23.0, 13.0, 9.0, 14.000000000000002, 20.0, 20.0, 24.0, 18.0, 17.0, 12.0, 13.0, 16.0, 10.0, 12.0, 19.0, 13.0, 5.0, 17.0, 23.0, 24.0, 20.0, 25.0, 22.0, 13.0, 16.0, 25.0, 17.0, 13.0, 22.0, 17.0, 9.0, 15.0, 13.0, 16.0, 19.0, 19.0, 11.0, 13.0, 12.0, 20.0, 16.0, 28.000000000000004, 26.0, 7.000000000000001, 17.0, 9.0, 20.0, 22.0, 22.0, 19.0, 8.0, 17.0, 21.0, 22.0, 22.0, 26.0, 25.0, 17.0, 11.0, 26.0, 14.000000000000002, 21.0, 33.0, 20.0, 13.0, 19.0, 14.000000000000002, 17.0, 18.0, 19.0, 9.0, 15.0, 3.0, 14.000000000000002, 15.0, 13.0, 22.0, 16.0, 16.0, 12.0, 17.0, 25.0, 21.0, 16.0, 13.0, 10.0, 21.0, 18.0, 30.0, 22.0, 14.000000000000002, 15.0, 12.0, 17.0, 24.0, 18.0, 25.0, 24.0, 21.0, 18.0, 18.0, 24.0, 14.000000000000002, 23.0, 23.0, 23.0, 17.0, 11.0, 25.0, 22.0, 24.0, 16.0, 19.0, 15.0, 8.0, 13.0, 21.0, 20.0, 28.000000000000004, 30.0, 12.0, 17.0, 20.0, 18.0, 29.0, 25.0, 17.0, 19.0, 18.0, 16.0, 15.0, 25.0, 27.0, 18.0, 20.0, 25.0, 19.0, 26.0, 29.0, 24.0, 21.0, 18.0, 12.0, 19.0, 24.0, 29.0, 28.000000000000004, 19.0, 17.0, 20.0, 33.0, 19.0, 23.0, 6.0, 14.000000000000002, 11.0, 12.0, 14.000000000000002, 17.0, 19.0, 15.0, 19.0, 16.0, 11.0, 27.0, 20.0, 19.0, 18.0, 19.0, 13.0, 11.0, 15.0, 14.000000000000002, 18.0, 15.0, 10.0, 13.0, 10.0, 10.0, 6.0, 13.0, 2.0, 11.0, 8.0, 8.0, 3.0, 12.0, 5.0, 15.0, 8.0, 10.0, 10.0, 14.000000000000002, 19.0, 15.0, 22.0, 10.0, 10.0, 11.0, 12.0, 19.0, 15.0, 16.0, 23.0, 9.0, 15.0, 29.0, 20.0, 27.0, 20.0, 22.0, 20.0, 12.0, 16.0, 23.0, 27.0, 25.0, 21.0, 16.0, 10.0, 20.0, 10.0, 24.0, 26.0, 21.0, 18.0, 9.0, 19.0, 20.0, 18.0, 19.0, 22.0, 20.0, 15.0, 18.0, 25.0, 9.0, 45.0, 18.0, 17.0, 16.0, 23.0, 27.0, 18.0, 30.0, 30.0, 15.0, 14.000000000000002, 20.0, 23.0, 24.0, 23.0, 18.0, 10.0, 17.0, 19.0, 17.0, 16.0, 18.0, 18.0, 15.0, 11.0, 23.0, 14.000000000000002, 23.0, 14.000000000000002, 30.0, 15.0, 12.0, 18.0, 18.0, 26.0, 30.999999999999996, 15.0, 19.0, 9.0, 19.0, 19.0, 21.0, 34.0, 23.0, 18.0, 16.0, 21.0, 13.0, 24.0, 17.0, 20.0, 14.000000000000002, 17.0, 20.0, 30.999999999999996, 27.0, 23.0, 23.0, 14.000000000000002, 10.0, 16.0, 16.0, 18.0, 20.0, 13.0, 16.0, 8.0, 17.0, 23.0, 18.0, 19.0, 18.0, 11.0, 6.0, 13.0, 10.0, 17.0, 26.0, 15.0, 12.0, 9.0, 16.0, 17.0, 12.0, 12.0, 16.0], "mode": "lines+markers", "name": "target"}] , {}, {"showLink": true, "linkText": "Export to plot.ly"})</script><script type="text/javascript">window.addEventListener("resize", function(){Plotly.Plots.resize(document.getElementById("21d4d405-eb35-4707-9fda-7393d0b88ffb"));});</script></body></html>
</div>

<p>The performances are roughly the same than Prophet. But the prediction made here is a day+1 prediction rather than a prediction of the whole year like we made with Prophet. So let&rsquo;s write a function that will predict the next year step by step:</p>

<pre><code class="language-python">def long_term_prediction(model , X , nb_target):
#Function also adapted to multiple targets    
    predictions = []
    new_line = X[0].reshape(1 , *X.shape[1:])
    pred = model.predict(new_line)
    predictions.append(pred)
    
    for line in X[1:]:
        old_line = deepcopy(line)
        old_line[-2 , :nb_target] = pred
        pred= model.predict(old_line.reshape(1 , *X.shape[1:]))
        predictions.append(pred)
        
    return np.array(predictions).reshape(-1 , nb_target )
</code></pre>

<pre><code class="language-python"># Computing Validation scores : MAE - RMSE - MPE
y_predict = long_term_prediction(nmodel , X[- ntest_day:] , 1)* maxes
y_true = Y[- ntest_day:] * maxes
    
evaluate(y_true , y_predict , dtsers.day[-365:])
</code></pre>

<pre><code>Mean Absolute Error   : 3.68
Root Mean Square Error: 4.82
Mean Percentage Error : 0.25
Error Density :
</code></pre>

<p><img src="/accidents/output_59_1.png" alt="png" /></p>

<pre><code>Mean Error                       : 0.68
True Value And error Correlation : 0.8
</code></pre>

<div>
<html><head><meta charset="utf-8" /></head><body><div id="7b486bc0-9f83-4404-a817-b7b39909e32c" style="height: 100%; width: 100%;" class="plotly-graph-div"></div><script type="text/javascript">window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("7b486bc0-9f83-4404-a817-b7b39909e32c", [{"type": "scatter", "x": ["2016-01-02", "2016-01-03", "2016-01-04", "2016-01-05", "2016-01-06", "2016-01-07", "2016-01-08", "2016-01-09", "2016-01-10", "2016-01-11", "2016-01-12", "2016-01-13", "2016-01-14", "2016-01-15", "2016-01-16", "2016-01-17", "2016-01-18", "2016-01-19", "2016-01-20", "2016-01-21", "2016-01-22", "2016-01-23", "2016-01-24", "2016-01-25", "2016-01-26", "2016-01-27", "2016-01-28", "2016-01-29", "2016-01-30", "2016-01-31", "2016-02-01", "2016-02-02", "2016-02-03", "2016-02-04", "2016-02-05", "2016-02-06", "2016-02-07", "2016-02-08", "2016-02-09", "2016-02-10", "2016-02-11", "2016-02-12", "2016-02-13", "2016-02-14", "2016-02-15", "2016-02-16", "2016-02-17", "2016-02-18", "2016-02-19", "2016-02-20", "2016-02-21", "2016-02-22", "2016-02-23", "2016-02-24", "2016-02-25", "2016-02-26", "2016-02-27", "2016-02-28", "2016-02-29", "2016-03-01", "2016-03-02", "2016-03-03", "2016-03-04", "2016-03-05", "2016-03-06", "2016-03-07", "2016-03-08", "2016-03-09", "2016-03-10", "2016-03-11", "2016-03-12", "2016-03-13", "2016-03-14", "2016-03-15", "2016-03-16", "2016-03-17", "2016-03-18", "2016-03-19", "2016-03-20", "2016-03-21", "2016-03-22", "2016-03-23", "2016-03-24", "2016-03-25", "2016-03-26", "2016-03-27", "2016-03-28", "2016-03-29", "2016-03-30", "2016-03-31", "2016-04-01", "2016-04-02", "2016-04-03", "2016-04-04", "2016-04-05", "2016-04-06", "2016-04-07", "2016-04-08", "2016-04-09", "2016-04-10", "2016-04-11", "2016-04-12", "2016-04-13", "2016-04-14", "2016-04-15", "2016-04-16", "2016-04-17", "2016-04-18", "2016-04-19", "2016-04-20", "2016-04-21", "2016-04-22", "2016-04-23", "2016-04-24", "2016-04-25", "2016-04-26", "2016-04-27", "2016-04-28", "2016-04-29", "2016-04-30", "2016-05-01", "2016-05-02", "2016-05-03", "2016-05-04", "2016-05-05", "2016-05-06", "2016-05-07", "2016-05-08", "2016-05-09", "2016-05-10", "2016-05-11", "2016-05-12", "2016-05-13", "2016-05-14", "2016-05-15", "2016-05-16", "2016-05-17", "2016-05-18", "2016-05-19", "2016-05-20", "2016-05-21", "2016-05-22", "2016-05-23", "2016-05-24", "2016-05-25", "2016-05-26", "2016-05-27", "2016-05-28", "2016-05-29", "2016-05-30", "2016-05-31", "2016-06-01", "2016-06-02", "2016-06-03", "2016-06-04", "2016-06-05", "2016-06-06", "2016-06-07", "2016-06-08", "2016-06-09", "2016-06-10", "2016-06-11", "2016-06-12", "2016-06-13", "2016-06-14", "2016-06-15", "2016-06-16", "2016-06-17", "2016-06-18", "2016-06-19", "2016-06-20", "2016-06-21", "2016-06-22", "2016-06-23", "2016-06-24", "2016-06-25", "2016-06-26", "2016-06-27", "2016-06-28", "2016-06-29", "2016-06-30", "2016-07-01", "2016-07-02", "2016-07-03", "2016-07-04", "2016-07-05", "2016-07-06", "2016-07-07", "2016-07-08", "2016-07-09", "2016-07-10", "2016-07-11", "2016-07-12", "2016-07-13", "2016-07-14", "2016-07-15", "2016-07-16", "2016-07-17", "2016-07-18", "2016-07-19", "2016-07-20", "2016-07-21", "2016-07-22", "2016-07-23", "2016-07-24", "2016-07-25", "2016-07-26", "2016-07-27", "2016-07-28", "2016-07-29", "2016-07-30", "2016-07-31", "2016-08-01", "2016-08-02", "2016-08-03", "2016-08-04", "2016-08-05", "2016-08-06", "2016-08-07", "2016-08-08", "2016-08-09", "2016-08-10", "2016-08-11", "2016-08-12", "2016-08-13", "2016-08-14", "2016-08-15", "2016-08-16", "2016-08-17", "2016-08-18", "2016-08-19", "2016-08-20", "2016-08-21", "2016-08-22", "2016-08-23", "2016-08-24", "2016-08-25", "2016-08-26", "2016-08-27", "2016-08-28", "2016-08-29", "2016-08-30", "2016-08-31", "2016-09-01", "2016-09-02", "2016-09-03", "2016-09-04", "2016-09-05", "2016-09-06", "2016-09-07", "2016-09-08", "2016-09-09", "2016-09-10", "2016-09-11", "2016-09-12", "2016-09-13", "2016-09-14", "2016-09-15", "2016-09-16", "2016-09-17", "2016-09-18", "2016-09-19", "2016-09-20", "2016-09-21", "2016-09-22", "2016-09-23", "2016-09-24", "2016-09-25", "2016-09-26", "2016-09-27", "2016-09-28", "2016-09-29", "2016-09-30", "2016-10-01", "2016-10-02", "2016-10-03", "2016-10-04", "2016-10-05", "2016-10-06", "2016-10-07", "2016-10-08", "2016-10-09", "2016-10-10", "2016-10-11", "2016-10-12", "2016-10-13", "2016-10-14", "2016-10-15", "2016-10-16", "2016-10-17", "2016-10-18", "2016-10-19", "2016-10-20", "2016-10-21", "2016-10-22", "2016-10-23", "2016-10-24", "2016-10-25", "2016-10-26", "2016-10-27", "2016-10-28", "2016-10-29", "2016-10-30", "2016-10-31", "2016-11-01", "2016-11-02", "2016-11-03", "2016-11-04", "2016-11-05", "2016-11-06", "2016-11-07", "2016-11-08", "2016-11-09", "2016-11-10", "2016-11-11", "2016-11-12", "2016-11-13", "2016-11-14", "2016-11-15", "2016-11-16", "2016-11-17", "2016-11-18", "2016-11-19", "2016-11-20", "2016-11-21", "2016-11-22", "2016-11-23", "2016-11-24", "2016-11-25", "2016-11-26", "2016-11-27", "2016-11-28", "2016-11-29", "2016-11-30", "2016-12-01", "2016-12-02", "2016-12-03", "2016-12-04", "2016-12-05", "2016-12-06", "2016-12-07", "2016-12-08", "2016-12-09", "2016-12-10", "2016-12-11", "2016-12-12", "2016-12-13", "2016-12-14", "2016-12-15", "2016-12-16", "2016-12-17", "2016-12-18", "2016-12-19", "2016-12-20", "2016-12-21", "2016-12-22", "2016-12-23", "2016-12-24", "2016-12-25", "2016-12-26", "2016-12-27", "2016-12-28", "2016-12-29", "2016-12-30", "2016-12-31"], "y": [11.86755359172821, 9.649510771036148, 8.498528212308884, 10.612948313355446, 12.747093915939331, 14.996103554964066, 15.339785993099213, 15.35192558169365, 12.394741863012314, 9.889135032892227, 13.316040426492691, 15.552305549383163, 17.884866625070572, 18.26206934452057, 18.44247606396675, 13.935060650110245, 11.163173988461494, 15.071953564882278, 17.205636352300644, 19.121636420488358, 18.545683085918427, 19.067071348428726, 14.553898483514786, 11.534499943256378, 16.12605956196785, 19.08323112130165, 20.729431986808777, 20.10522124171257, 19.928137063980103, 15.759096533060074, 11.99474948644638, 16.835110634565353, 18.90948012471199, 20.062753200531006, 19.864785343408585, 20.396300822496414, 15.950004369020462, 12.075697302818298, 16.336954325437546, 19.161815464496613, 19.077447831630707, 18.804248571395874, 18.775196850299835, 14.3600435256958, 11.1015405356884, 14.13182321190834, 16.592213988304138, 18.130661755800247, 17.710825324058533, 17.97936299443245, 14.33933311700821, 11.738614350557327, 15.331295728683472, 17.47735369205475, 17.316584318876266, 17.486467123031616, 17.894977122545242, 13.699961185455322, 11.2223482131958, 15.200901925563812, 18.29287201166153, 18.45613557100296, 18.113237410783768, 18.95003306865692, 14.251357197761536, 11.132957249879837, 14.287456780672073, 17.292384177446365, 18.828483670949936, 18.71490928530693, 19.669820845127106, 14.616316974163055, 11.991167038679123, 16.92662340402603, 20.131321281194687, 20.893517822027206, 20.189946055412292, 20.40786436200142, 15.307747632265091, 11.625280112028122, 14.638159722089767, 16.86197367310524, 18.11632588505745, 18.072690546512604, 18.192555874586105, 13.940846979618073, 11.352451711893082, 14.482741981744766, 17.14693558216095, 18.01840513944626, 17.249771744012833, 17.13179263472557, 13.805385768413544, 11.28877928853035, 15.130671054124832, 17.11043018102646, 17.65935328602791, 18.773619174957275, 19.806154489517212, 14.926395535469055, 12.367243498563766, 16.7971293926239, 18.791566371917725, 19.28963604569435, 19.15746545791626, 19.30735069513321, 14.964531809091568, 12.414420247077942, 16.42331001162529, 19.548684865236282, 21.404374569654465, 21.03573051095009, 20.152663975954056, 14.57857283949852, 11.339299857616425, 15.401879221200943, 17.671673744916916, 17.6728592813015, 17.087374538183212, 18.49853825569153, 14.5772003531456, 12.293261468410492, 16.37603598833084, 19.12199056148529, 20.50731110572815, 20.32051768898964, 20.030149430036545, 16.27811524271965, 13.794047176837921, 17.75822550058365, 20.081363081932068, 21.234268337488174, 20.295405596494675, 19.711604923009872, 16.173552453517914, 13.54553747177124, 17.7576342523098, 18.597723573446274, 20.44856169819832, 19.41328901052475, 19.572974681854248, 15.721089452505112, 13.121156483888626, 16.73126980662346, 18.875029653310776, 20.960521906614304, 20.727956146001816, 20.853975623846054, 16.563838630914688, 13.17923104763031, 17.698650777339935, 19.480799227952957, 19.376563221216202, 18.174494683742523, 18.665692806243896, 14.221028745174408, 11.30954897403717, 17.522706538438797, 20.92195701599121, 23.02884668111801, 22.781610667705536, 24.123119562864304, 17.074789613485336, 12.38952550292015, 18.19621279835701, 20.413313269615173, 22.506818532943726, 22.375032484531403, 20.20537170767784, 15.70577323436737, 11.96859472990036, 17.546353429555893, 19.657197922468185, 21.934751629829407, 21.734148234128952, 22.592880874872208, 15.881475806236267, 12.130338370800018, 18.713380247354507, 21.941574543714523, 24.643208295106888, 24.019646555185318, 24.02893477678299, 17.071558266878128, 12.545367300510406, 18.64437898993492, 20.319354951381683, 20.67258855700493, 19.51560840010643, 20.355743318796158, 14.84623047709465, 12.011503547430038, 18.411658197641373, 19.101517260074615, 19.370168924331665, 18.01887023448944, 17.95408523082733, 13.726202577352524, 10.612389743328094, 16.896200716495514, 18.761949241161346, 20.290550976991653, 18.511646032333374, 17.378213971853256, 12.244640797376633, 9.973145484924316, 14.826384902000427, 15.808474123477936, 16.54366171360016, 15.746815592050552, 16.213024735450745, 12.417765587568283, 10.17332710325718, 13.654710173606873, 14.571619212627411, 14.687421798706055, 13.59807801246643, 13.307794868946075, 10.794896230101585, 8.801919892430305, 11.625523298978806, 12.398534059524536, 13.353868156671524, 12.972113281488419, 12.782760322093964, 10.604451969265938, 8.796439826488495, 11.499073684215546, 12.466767758131027, 13.659455358982086, 13.392337292432785, 12.703349143266678, 10.57167112827301, 8.732390463352203, 11.362463414669037, 12.884420067071915, 14.357035607099533, 14.772064536809921, 15.674672663211823, 13.074520826339722, 11.437510907649994, 16.83106765151024, 17.396278202533722, 18.526833057403564, 18.5445613861084, 20.02914324402809, 15.62126424908638, 12.57682353258133, 16.897957742214203, 18.51604163646698, 19.98204857110977, 20.961955189704895, 22.80954220890999, 18.01229962706566, 14.020458787679672, 19.689432352781296, 21.03850892186165, 21.775879114866257, 21.181147187948227, 20.95747447013855, 17.12449398636818, 13.995570123195648, 19.82800179719925, 21.879990488290787, 22.630583971738815, 23.143535166978836, 23.358171969652176, 18.29244339466095, 14.762940466403961, 19.813298106193542, 21.955667227506638, 22.559518665075302, 22.167414665222168, 23.970574468374252, 17.79360768198967, 13.881279855966568, 20.204155772924423, 23.423014730215073, 24.490634322166443, 23.711179107427597, 25.017994344234467, 17.930152595043182, 14.116826176643372, 19.251850873231888, 20.92676755785942, 21.54015800356865, 21.299773782491684, 22.629170447587967, 16.473167896270752, 12.947876662015915, 18.24067497253418, 20.171941101551056, 20.795572757720947, 20.086833268404007, 20.884991079568863, 15.697295129299164, 12.005577385425568, 16.53259214758873, 17.785561233758926, 18.082494020462036, 17.79200568795204, 19.09741348028183, 15.441918432712555, 12.830883979797363, 17.643502056598663, 19.158184379339218, 17.946231812238693, 19.081046998500824, 19.50326818227768, 14.778917849063873, 12.011325716972351, 17.268989592790604, 19.22110292315483, 20.17411458492279, 19.220555752515793, 19.534862726926804, 14.345900684595108, 12.225201040506363, 16.86119395494461, 19.798884719610214, 20.2118359208107, 20.50027084350586, 21.704623818397522, 16.082272231578827, 13.137883186340332, 18.994498282670975, 22.031407803297043, 23.14868313074112, 22.366554379463196, 23.1600202023983, 16.845678627490997, 12.896319508552551, 18.477440267801285, 21.175553888082504, 22.335385411977768, 22.664876371622086, 23.60645216703415, 16.89372020959854, 13.8725084066391, 19.20388376712799, 20.8891222178936, 21.05753830075264, 20.259468644857407, 20.848461359739304, 16.252214312553406, 13.3743596971035, 17.851264268159866, 18.22262442111969, 18.18727719783783, 17.94507059454918, 17.691523879766464, 13.919349253177643, 11.768228441476822, 14.83793780207634, 14.935697436332703, 15.18548235297203, 14.574879437685013, 13.594044148921967, 10.792299449443817, 8.804356321692467, 9.65400516986847, 10.550332993268967, 11.406142830848694, 11.887672752141953, 12.094045758247375], "mode": "lines+markers", "name": "prediction"}, {"type": "scatter", "x": ["2016-01-02", "2016-01-03", "2016-01-04", "2016-01-05", "2016-01-06", "2016-01-07", "2016-01-08", "2016-01-09", "2016-01-10", "2016-01-11", "2016-01-12", "2016-01-13", "2016-01-14", "2016-01-15", "2016-01-16", "2016-01-17", "2016-01-18", "2016-01-19", "2016-01-20", "2016-01-21", "2016-01-22", "2016-01-23", "2016-01-24", "2016-01-25", "2016-01-26", "2016-01-27", "2016-01-28", "2016-01-29", "2016-01-30", "2016-01-31", "2016-02-01", "2016-02-02", "2016-02-03", "2016-02-04", "2016-02-05", "2016-02-06", "2016-02-07", "2016-02-08", "2016-02-09", "2016-02-10", "2016-02-11", "2016-02-12", "2016-02-13", "2016-02-14", "2016-02-15", "2016-02-16", "2016-02-17", "2016-02-18", "2016-02-19", "2016-02-20", "2016-02-21", "2016-02-22", "2016-02-23", "2016-02-24", "2016-02-25", "2016-02-26", "2016-02-27", "2016-02-28", "2016-02-29", "2016-03-01", "2016-03-02", "2016-03-03", "2016-03-04", "2016-03-05", "2016-03-06", "2016-03-07", "2016-03-08", "2016-03-09", "2016-03-10", "2016-03-11", "2016-03-12", "2016-03-13", "2016-03-14", "2016-03-15", "2016-03-16", "2016-03-17", "2016-03-18", "2016-03-19", "2016-03-20", "2016-03-21", "2016-03-22", "2016-03-23", "2016-03-24", "2016-03-25", "2016-03-26", "2016-03-27", "2016-03-28", "2016-03-29", "2016-03-30", "2016-03-31", "2016-04-01", "2016-04-02", "2016-04-03", "2016-04-04", "2016-04-05", "2016-04-06", "2016-04-07", "2016-04-08", "2016-04-09", "2016-04-10", "2016-04-11", "2016-04-12", "2016-04-13", "2016-04-14", "2016-04-15", "2016-04-16", "2016-04-17", "2016-04-18", "2016-04-19", "2016-04-20", "2016-04-21", "2016-04-22", "2016-04-23", "2016-04-24", "2016-04-25", "2016-04-26", "2016-04-27", "2016-04-28", "2016-04-29", "2016-04-30", "2016-05-01", "2016-05-02", "2016-05-03", "2016-05-04", "2016-05-05", "2016-05-06", "2016-05-07", "2016-05-08", "2016-05-09", "2016-05-10", "2016-05-11", "2016-05-12", "2016-05-13", "2016-05-14", "2016-05-15", "2016-05-16", "2016-05-17", "2016-05-18", "2016-05-19", "2016-05-20", "2016-05-21", "2016-05-22", "2016-05-23", "2016-05-24", "2016-05-25", "2016-05-26", "2016-05-27", "2016-05-28", "2016-05-29", "2016-05-30", "2016-05-31", "2016-06-01", "2016-06-02", "2016-06-03", "2016-06-04", "2016-06-05", "2016-06-06", "2016-06-07", "2016-06-08", "2016-06-09", "2016-06-10", "2016-06-11", "2016-06-12", "2016-06-13", "2016-06-14", "2016-06-15", "2016-06-16", "2016-06-17", "2016-06-18", "2016-06-19", "2016-06-20", "2016-06-21", "2016-06-22", "2016-06-23", "2016-06-24", "2016-06-25", "2016-06-26", "2016-06-27", "2016-06-28", "2016-06-29", "2016-06-30", "2016-07-01", "2016-07-02", "2016-07-03", "2016-07-04", "2016-07-05", "2016-07-06", "2016-07-07", "2016-07-08", "2016-07-09", "2016-07-10", "2016-07-11", "2016-07-12", "2016-07-13", "2016-07-14", "2016-07-15", "2016-07-16", "2016-07-17", "2016-07-18", "2016-07-19", "2016-07-20", "2016-07-21", "2016-07-22", "2016-07-23", "2016-07-24", "2016-07-25", "2016-07-26", "2016-07-27", "2016-07-28", "2016-07-29", "2016-07-30", "2016-07-31", "2016-08-01", "2016-08-02", "2016-08-03", "2016-08-04", "2016-08-05", "2016-08-06", "2016-08-07", "2016-08-08", "2016-08-09", "2016-08-10", "2016-08-11", "2016-08-12", "2016-08-13", "2016-08-14", "2016-08-15", "2016-08-16", "2016-08-17", "2016-08-18", "2016-08-19", "2016-08-20", "2016-08-21", "2016-08-22", "2016-08-23", "2016-08-24", "2016-08-25", "2016-08-26", "2016-08-27", "2016-08-28", "2016-08-29", "2016-08-30", "2016-08-31", "2016-09-01", "2016-09-02", "2016-09-03", "2016-09-04", "2016-09-05", "2016-09-06", "2016-09-07", "2016-09-08", "2016-09-09", "2016-09-10", "2016-09-11", "2016-09-12", "2016-09-13", "2016-09-14", "2016-09-15", "2016-09-16", "2016-09-17", "2016-09-18", "2016-09-19", "2016-09-20", "2016-09-21", "2016-09-22", "2016-09-23", "2016-09-24", "2016-09-25", "2016-09-26", "2016-09-27", "2016-09-28", "2016-09-29", "2016-09-30", "2016-10-01", "2016-10-02", "2016-10-03", "2016-10-04", "2016-10-05", "2016-10-06", "2016-10-07", "2016-10-08", "2016-10-09", "2016-10-10", "2016-10-11", "2016-10-12", "2016-10-13", "2016-10-14", "2016-10-15", "2016-10-16", "2016-10-17", "2016-10-18", "2016-10-19", "2016-10-20", "2016-10-21", "2016-10-22", "2016-10-23", "2016-10-24", "2016-10-25", "2016-10-26", "2016-10-27", "2016-10-28", "2016-10-29", "2016-10-30", "2016-10-31", "2016-11-01", "2016-11-02", "2016-11-03", "2016-11-04", "2016-11-05", "2016-11-06", "2016-11-07", "2016-11-08", "2016-11-09", "2016-11-10", "2016-11-11", "2016-11-12", "2016-11-13", "2016-11-14", "2016-11-15", "2016-11-16", "2016-11-17", "2016-11-18", "2016-11-19", "2016-11-20", "2016-11-21", "2016-11-22", "2016-11-23", "2016-11-24", "2016-11-25", "2016-11-26", "2016-11-27", "2016-11-28", "2016-11-29", "2016-11-30", "2016-12-01", "2016-12-02", "2016-12-03", "2016-12-04", "2016-12-05", "2016-12-06", "2016-12-07", "2016-12-08", "2016-12-09", "2016-12-10", "2016-12-11", "2016-12-12", "2016-12-13", "2016-12-14", "2016-12-15", "2016-12-16", "2016-12-17", "2016-12-18", "2016-12-19", "2016-12-20", "2016-12-21", "2016-12-22", "2016-12-23", "2016-12-24", "2016-12-25", "2016-12-26", "2016-12-27", "2016-12-28", "2016-12-29", "2016-12-30", "2016-12-31"], "y": [6.0, 7.000000000000001, 11.0, 12.0, 27.0, 21.0, 24.0, 16.0, 13.0, 12.0, 16.0, 15.0, 15.0, 25.0, 17.0, 15.0, 9.0, 8.0, 22.0, 20.0, 26.0, 29.0, 12.0, 13.0, 18.0, 23.0, 17.0, 24.0, 20.0, 13.0, 17.0, 21.0, 18.0, 30.0, 16.0, 12.0, 16.0, 11.0, 21.0, 22.0, 17.0, 17.0, 23.0, 13.0, 9.0, 14.000000000000002, 20.0, 20.0, 24.0, 18.0, 17.0, 12.0, 13.0, 16.0, 10.0, 12.0, 19.0, 13.0, 5.0, 17.0, 23.0, 24.0, 20.0, 25.0, 22.0, 13.0, 16.0, 25.0, 17.0, 13.0, 22.0, 17.0, 9.0, 15.0, 13.0, 16.0, 19.0, 19.0, 11.0, 13.0, 12.0, 20.0, 16.0, 28.000000000000004, 26.0, 7.000000000000001, 17.0, 9.0, 20.0, 22.0, 22.0, 19.0, 8.0, 17.0, 21.0, 22.0, 22.0, 26.0, 25.0, 17.0, 11.0, 26.0, 14.000000000000002, 21.0, 33.0, 20.0, 13.0, 19.0, 14.000000000000002, 17.0, 18.0, 19.0, 9.0, 15.0, 3.0, 14.000000000000002, 15.0, 13.0, 22.0, 16.0, 16.0, 12.0, 17.0, 25.0, 21.0, 16.0, 13.0, 10.0, 21.0, 18.0, 30.0, 22.0, 14.000000000000002, 15.0, 12.0, 17.0, 24.0, 18.0, 25.0, 24.0, 21.0, 18.0, 18.0, 24.0, 14.000000000000002, 23.0, 23.0, 23.0, 17.0, 11.0, 25.0, 22.0, 24.0, 16.0, 19.0, 15.0, 8.0, 13.0, 21.0, 20.0, 28.000000000000004, 30.0, 12.0, 17.0, 20.0, 18.0, 29.0, 25.0, 17.0, 19.0, 18.0, 16.0, 15.0, 25.0, 27.0, 18.0, 20.0, 25.0, 19.0, 26.0, 29.0, 24.0, 21.0, 18.0, 12.0, 19.0, 24.0, 29.0, 28.000000000000004, 19.0, 17.0, 20.0, 33.0, 19.0, 23.0, 6.0, 14.000000000000002, 11.0, 12.0, 14.000000000000002, 17.0, 19.0, 15.0, 19.0, 16.0, 11.0, 27.0, 20.0, 19.0, 18.0, 19.0, 13.0, 11.0, 15.0, 14.000000000000002, 18.0, 15.0, 10.0, 13.0, 10.0, 10.0, 6.0, 13.0, 2.0, 11.0, 8.0, 8.0, 3.0, 12.0, 5.0, 15.0, 8.0, 10.0, 10.0, 14.000000000000002, 19.0, 15.0, 22.0, 10.0, 10.0, 11.0, 12.0, 19.0, 15.0, 16.0, 23.0, 9.0, 15.0, 29.0, 20.0, 27.0, 20.0, 22.0, 20.0, 12.0, 16.0, 23.0, 27.0, 25.0, 21.0, 16.0, 10.0, 20.0, 10.0, 24.0, 26.0, 21.0, 18.0, 9.0, 19.0, 20.0, 18.0, 19.0, 22.0, 20.0, 15.0, 18.0, 25.0, 9.0, 45.0, 18.0, 17.0, 16.0, 23.0, 27.0, 18.0, 30.0, 30.0, 15.0, 14.000000000000002, 20.0, 23.0, 24.0, 23.0, 18.0, 10.0, 17.0, 19.0, 17.0, 16.0, 18.0, 18.0, 15.0, 11.0, 23.0, 14.000000000000002, 23.0, 14.000000000000002, 30.0, 15.0, 12.0, 18.0, 18.0, 26.0, 30.999999999999996, 15.0, 19.0, 9.0, 19.0, 19.0, 21.0, 34.0, 23.0, 18.0, 16.0, 21.0, 13.0, 24.0, 17.0, 20.0, 14.000000000000002, 17.0, 20.0, 30.999999999999996, 27.0, 23.0, 23.0, 14.000000000000002, 10.0, 16.0, 16.0, 18.0, 20.0, 13.0, 16.0, 8.0, 17.0, 23.0, 18.0, 19.0, 18.0, 11.0, 6.0, 13.0, 10.0, 17.0, 26.0, 15.0, 12.0, 9.0, 16.0, 17.0, 12.0, 12.0, 16.0], "mode": "lines+markers", "name": "target"}] , {}, {"showLink": true, "linkText": "Export to plot.ly"})</script><script type="text/javascript">window.addEventListener("resize", function(){Plotly.Plots.resize(document.getElementById("21d4d405-eb35-4707-9fda-7393d0b88ffb"));});</script></body></html>
</div>

<p>We can see that the results are stable and almost the same as Prophet. Let&rsquo;s try another way to model our problem with LSTMs:</p>

<h3 id="multivariate-time-series-with-lstms">Multivariate Time series with LSTMs:</h3>

<p>What if we want to get an approximate location of future accidents?
This would be a highly valuable information if we want to take preventive measures. Paris is made up of 20 separate districts. Instead of predicting the sum of the total number of accidents, we are going to predict the number of accidents in each district in a multivariate way. This means that instead of outputting a single neuron, our model will output 20 neurons, each one representing a district. To score the model, we are going to sum the predictions and see if we get good results.</p>

<pre><code class="language-python">cdtsers = caracs.loc[(caracs.dep.isin([750])) , ['Num_Acc' , 'dep', 'com', 'jour' , 'mois' , 'an']]


cdtsers['day'] = pd.to_datetime((2000+cdtsers.an)*10000+cdtsers.mois*100+cdtsers.jour,format='%Y%m%d')
cdtsers.drop(['jour' , 'mois' , 'an'] , axis = 1 ,inplace = True)

def correct(x):
    if x&gt;100:
        return x - 100
    return x

cdtsers.com = cdtsers.com.apply( correct )

cdtsers = cdtsers.groupby(['day' , 'dep' , 'com'] , as_index = False).count()

cdtsers = cdtsers.pivot_table(index = ['day' , 'dep'] , columns = 'com' , values = 'Num_Acc').reset_index()

cdtsers.fillna(0).head()

cdtsers['isholiday'] = 0
cdtsers.loc[cdtsers.day.isin(holidays.ds) , 'isholiday'] = 1

# Weather
cdtsers = cdtsers.merge(wdata , on = 'day')


cdtsers['weekday'] = cdtsers.day.dt.weekday
cdtsers['month'] = cdtsers.day.dt.month
cdtsers = pd.get_dummies(cdtsers , columns = ['weekday' , 'month'])


cdtsers.drop([56 , 'dep'] , axis = 1 , inplace = True)
cdtsers.fillna(0 , inplace = True)
</code></pre>

<pre><code class="language-python">X , Y , maxes  = reshape_timeseries(cdtsers.iloc[: , 1:] , list(range(19)), window_size = 28 , take_curr = True , scale = True)

ntest_day = 365

nmodel = model(X , Y , lr = 0.005, lstm_layers = [64 , 64] , lstm_dropout = [.2 , .2] ,
               dense_layers = [64] , dense_dropout = [.2] , batch_size = 64 , epochs = 20)
</code></pre>

<pre><code>Model Summary:
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
masking_2 (Masking)          (None, 28, 50)            0         
_________________________________________________________________
bidirectional_2 (Bidirection (None, 28, 128)           58880     
_________________________________________________________________
dropout_3 (Dropout)          (None, 28, 128)           0         
_________________________________________________________________
bidirectional_3 (Bidirection (None, 128)               98816     
_________________________________________________________________
dropout_4 (Dropout)          (None, 128)               0         
_________________________________________________________________
dense_3 (Dense)              (None, 64)                8256      
_________________________________________________________________
dropout_5 (Dropout)          (None, 64)                0         
_________________________________________________________________
activation_2 (Activation)    (None, 64)                0         
_________________________________________________________________
dense_4 (Dense)              (None, 19)                1235      
=================================================================
Total params: 167,187
Trainable params: 167,187
Non-trainable params: 0
_________________________________________________________________
None


 Training :
Train on 3986 samples, validate on 365 samples
Epoch 1/20
3986/3986 [==============================] - 36s 9ms/step - loss: 0.0294 - val_loss: 0.0202
Epoch 2/20
3986/3986 [==============================] - 30s 7ms/step - loss: 0.0248 - val_loss: 0.0201
Epoch 3/20
3986/3986 [==============================] - 26s 7ms/step - loss: 0.0241 - val_loss: 0.0197
Epoch 4/20
3986/3986 [==============================] - 29s 7ms/step - loss: 0.0238 - val_loss: 0.0200
Epoch 5/20
3986/3986 [==============================] - 29s 7ms/step - loss: 0.0235 - val_loss: 0.0198
Epoch 6/20
3986/3986 [==============================] - 29s 7ms/step - loss: 0.0234 - val_loss: 0.0198
Epoch 7/20
3986/3986 [==============================] - 30s 8ms/step - loss: 0.0233 - val_loss: 0.0198
Epoch 8/20
3986/3986 [==============================] - 30s 8ms/step - loss: 0.0232 - val_loss: 0.0200
Epoch 9/20
3986/3986 [==============================] - 30s 8ms/step - loss: 0.0232 - val_loss: 0.0198
Epoch 10/20
3986/3986 [==============================] - 30s 8ms/step - loss: 0.0231 - val_loss: 0.0199
Epoch 11/20
3986/3986 [==============================] - 30s 8ms/step - loss: 0.0231 - val_loss: 0.0198
Epoch 12/20
3986/3986 [==============================] - 29s 7ms/step - loss: 0.0230 - val_loss: 0.0198
Epoch 13/20
3986/3986 [==============================] - 26s 7ms/step - loss: 0.0231 - val_loss: 0.0198
Epoch 14/20
3986/3986 [==============================] - 28s 7ms/step - loss: 0.0230 - val_loss: 0.0198
Epoch 15/20
3986/3986 [==============================] - 30s 8ms/step - loss: 0.0230 - val_loss: 0.0199
Epoch 16/20
3986/3986 [==============================] - 30s 7ms/step - loss: 0.0229 - val_loss: 0.0198
Epoch 17/20
3986/3986 [==============================] - 28s 7ms/step - loss: 0.0229 - val_loss: 0.0198
Epoch 18/20
3986/3986 [==============================] - 29s 7ms/step - loss: 0.0229 - val_loss: 0.0197
Epoch 19/20
3986/3986 [==============================] - 29s 7ms/step - loss: 0.0229 - val_loss: 0.0199
Epoch 20/20
3986/3986 [==============================] - 30s 8ms/step - loss: 0.0229 - val_loss: 0.0198
</code></pre>

<pre><code class="language-python"># Evaluating:
y_predict = (nmodel.predict(X[- ntest_day:]) * maxes).sum(axis = 1)
y_true = (Y[- ntest_day:] * maxes).sum(axis = 1)

evaluate(y_true , y_predict , cdtsers.day[-365:])
</code></pre>

<pre><code>Mean Absolute Error   : 3.59
Root Mean Square Error: 4.8
Mean Percentage Error : 0.25
Error Density :
</code></pre>

<p><img src="/accidents/output_65_1.png" alt="png" /></p>

<pre><code>Mean Error                       : 0.92
True Value And error Correlation : 0.78
</code></pre>

<div>
<html><head><meta charset="utf-8" /></head><body><div id="46463e14-93d6-4b60-a595-933b068fbe29" style="height: 100%; width: 100%;" class="plotly-graph-div"></div><script type="text/javascript">window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("46463e14-93d6-4b60-a595-933b068fbe29", [{"type": "scatter", "x": ["2016-01-02", "2016-01-03", "2016-01-04", "2016-01-05", "2016-01-06", "2016-01-07", "2016-01-08", "2016-01-09", "2016-01-10", "2016-01-11", "2016-01-12", "2016-01-13", "2016-01-14", "2016-01-15", "2016-01-16", "2016-01-17", "2016-01-18", "2016-01-19", "2016-01-20", "2016-01-21", "2016-01-22", "2016-01-23", "2016-01-24", "2016-01-25", "2016-01-26", "2016-01-27", "2016-01-28", "2016-01-29", "2016-01-30", "2016-01-31", "2016-02-01", "2016-02-02", "2016-02-03", "2016-02-04", "2016-02-05", "2016-02-06", "2016-02-07", "2016-02-08", "2016-02-09", "2016-02-10", "2016-02-11", "2016-02-12", "2016-02-13", "2016-02-14", "2016-02-15", "2016-02-16", "2016-02-17", "2016-02-18", "2016-02-19", "2016-02-20", "2016-02-21", "2016-02-22", "2016-02-23", "2016-02-24", "2016-02-25", "2016-02-26", "2016-02-27", "2016-02-28", "2016-02-29", "2016-03-01", "2016-03-02", "2016-03-03", "2016-03-04", "2016-03-05", "2016-03-06", "2016-03-07", "2016-03-08", "2016-03-09", "2016-03-10", "2016-03-11", "2016-03-12", "2016-03-13", "2016-03-14", "2016-03-15", "2016-03-16", "2016-03-17", "2016-03-18", "2016-03-19", "2016-03-20", "2016-03-21", "2016-03-22", "2016-03-23", "2016-03-24", "2016-03-25", "2016-03-26", "2016-03-27", "2016-03-28", "2016-03-29", "2016-03-30", "2016-03-31", "2016-04-01", "2016-04-02", "2016-04-03", "2016-04-04", "2016-04-05", "2016-04-06", "2016-04-07", "2016-04-08", "2016-04-09", "2016-04-10", "2016-04-11", "2016-04-12", "2016-04-13", "2016-04-14", "2016-04-15", "2016-04-16", "2016-04-17", "2016-04-18", "2016-04-19", "2016-04-20", "2016-04-21", "2016-04-22", "2016-04-23", "2016-04-24", "2016-04-25", "2016-04-26", "2016-04-27", "2016-04-28", "2016-04-29", "2016-04-30", "2016-05-01", "2016-05-02", "2016-05-03", "2016-05-04", "2016-05-05", "2016-05-06", "2016-05-07", "2016-05-08", "2016-05-09", "2016-05-10", "2016-05-11", "2016-05-12", "2016-05-13", "2016-05-14", "2016-05-15", "2016-05-16", "2016-05-17", "2016-05-18", "2016-05-19", "2016-05-20", "2016-05-21", "2016-05-22", "2016-05-23", "2016-05-24", "2016-05-25", "2016-05-26", "2016-05-27", "2016-05-28", "2016-05-29", "2016-05-30", "2016-05-31", "2016-06-01", "2016-06-02", "2016-06-03", "2016-06-04", "2016-06-05", "2016-06-06", "2016-06-07", "2016-06-08", "2016-06-09", "2016-06-10", "2016-06-11", "2016-06-12", "2016-06-13", "2016-06-14", "2016-06-15", "2016-06-16", "2016-06-17", "2016-06-18", "2016-06-19", "2016-06-20", "2016-06-21", "2016-06-22", "2016-06-23", "2016-06-24", "2016-06-25", "2016-06-26", "2016-06-27", "2016-06-28", "2016-06-29", "2016-06-30", "2016-07-01", "2016-07-02", "2016-07-03", "2016-07-04", "2016-07-05", "2016-07-06", "2016-07-07", "2016-07-08", "2016-07-09", "2016-07-10", "2016-07-11", "2016-07-12", "2016-07-13", "2016-07-14", "2016-07-15", "2016-07-16", "2016-07-17", "2016-07-18", "2016-07-19", "2016-07-20", "2016-07-21", "2016-07-22", "2016-07-23", "2016-07-24", "2016-07-25", "2016-07-26", "2016-07-27", "2016-07-28", "2016-07-29", "2016-07-30", "2016-07-31", "2016-08-01", "2016-08-02", "2016-08-03", "2016-08-04", "2016-08-05", "2016-08-06", "2016-08-07", "2016-08-08", "2016-08-09", "2016-08-10", "2016-08-11", "2016-08-12", "2016-08-13", "2016-08-14", "2016-08-15", "2016-08-16", "2016-08-17", "2016-08-18", "2016-08-19", "2016-08-20", "2016-08-21", "2016-08-22", "2016-08-23", "2016-08-24", "2016-08-25", "2016-08-26", "2016-08-27", "2016-08-28", "2016-08-29", "2016-08-30", "2016-08-31", "2016-09-01", "2016-09-02", "2016-09-03", "2016-09-04", "2016-09-05", "2016-09-06", "2016-09-07", "2016-09-08", "2016-09-09", "2016-09-10", "2016-09-11", "2016-09-12", "2016-09-13", "2016-09-14", "2016-09-15", "2016-09-16", "2016-09-17", "2016-09-18", "2016-09-19", "2016-09-20", "2016-09-21", "2016-09-22", "2016-09-23", "2016-09-24", "2016-09-25", "2016-09-26", "2016-09-27", "2016-09-28", "2016-09-29", "2016-09-30", "2016-10-01", "2016-10-02", "2016-10-03", "2016-10-04", "2016-10-05", "2016-10-06", "2016-10-07", "2016-10-08", "2016-10-09", "2016-10-10", "2016-10-11", "2016-10-12", "2016-10-13", "2016-10-14", "2016-10-15", "2016-10-16", "2016-10-17", "2016-10-18", "2016-10-19", "2016-10-20", "2016-10-21", "2016-10-22", "2016-10-23", "2016-10-24", "2016-10-25", "2016-10-26", "2016-10-27", "2016-10-28", "2016-10-29", "2016-10-30", "2016-10-31", "2016-11-01", "2016-11-02", "2016-11-03", "2016-11-04", "2016-11-05", "2016-11-06", "2016-11-07", "2016-11-08", "2016-11-09", "2016-11-10", "2016-11-11", "2016-11-12", "2016-11-13", "2016-11-14", "2016-11-15", "2016-11-16", "2016-11-17", "2016-11-18", "2016-11-19", "2016-11-20", "2016-11-21", "2016-11-22", "2016-11-23", "2016-11-24", "2016-11-25", "2016-11-26", "2016-11-27", "2016-11-28", "2016-11-29", "2016-11-30", "2016-12-01", "2016-12-02", "2016-12-03", "2016-12-04", "2016-12-05", "2016-12-06", "2016-12-07", "2016-12-08", "2016-12-09", "2016-12-10", "2016-12-11", "2016-12-12", "2016-12-13", "2016-12-14", "2016-12-15", "2016-12-16", "2016-12-17", "2016-12-18", "2016-12-19", "2016-12-20", "2016-12-21", "2016-12-22", "2016-12-23", "2016-12-24", "2016-12-25", "2016-12-26", "2016-12-27", "2016-12-28", "2016-12-29", "2016-12-30", "2016-12-31"], "y": [11.04475449770689, 7.774363990873098, 7.430397007614374, 9.914094347506762, 12.032592844218016, 12.929242044687271, 13.543012734502554, 14.315299026668072, 10.921616092324257, 9.459001448005438, 13.016410611569881, 14.795653693377972, 15.558433063328266, 16.156408675014973, 15.957420848309994, 12.304351050406694, 9.828935511410236, 13.422723092138767, 15.720448479056358, 16.56388158351183, 17.050852239131927, 17.13729777932167, 13.12970781326294, 11.113721828907728, 14.663255698978901, 16.744519531726837, 18.30112161487341, 19.275743387639523, 19.112579368054867, 14.942599043250084, 12.846562542021275, 17.163512244820595, 19.62077420204878, 19.62250042706728, 19.745441772043705, 19.35311683267355, 14.668583609163761, 11.883808098733425, 15.714569129049778, 18.073260724544525, 18.912443444132805, 19.325152210891247, 18.825304351747036, 14.63592904806137, 11.726819232106209, 14.974735334515572, 17.18821730464697, 18.444235235452652, 18.758236847817898, 17.96933774650097, 13.439023487269878, 10.88487971574068, 14.366073861718178, 15.903905726969242, 16.378889873623848, 16.893320679664612, 15.920067682862282, 11.855878666043282, 10.217818059027195, 13.21429643779993, 15.097671873867512, 15.687831453979015, 16.197005107998848, 16.07861039042473, 11.945162981748581, 9.841849185526371, 13.199350602924824, 15.754579178988934, 17.142608180642128, 18.128854878246784, 17.30164110660553, 12.950250647962093, 11.099234215915203, 14.889140471816063, 17.576887853443623, 17.788588136434555, 17.885471485555172, 16.89620031416416, 12.651049084961414, 11.038236901164055, 14.148971416056156, 16.349676579236984, 16.94821038097143, 16.93825053423643, 16.219293914735317, 12.10119092464447, 10.59010610356927, 13.940284371376038, 15.30347178131342, 15.571114271879196, 15.91516587883234, 15.311681658029556, 11.493356220424175, 10.029142372310162, 12.43348152935505, 14.42072755843401, 14.608236759901047, 16.055361032485962, 16.03295110911131, 11.898733727633953, 9.846327226608992, 13.601563692092896, 15.93397705256939, 16.968122608959675, 17.573124565184116, 16.88085214793682, 12.425926640629768, 10.269668519496918, 14.025155149400234, 16.715190768241882, 17.677686534821987, 18.200116708874702, 17.36766119301319, 12.39659759402275, 9.982278913259506, 13.157279331237078, 15.500114388763905, 16.214100539684296, 16.496791020035744, 17.056371077895164, 13.199251912534237, 10.876337949186563, 13.873729337006807, 16.763866543769836, 17.948238529264927, 19.001347117125988, 18.73186219483614, 14.180028021335602, 11.371408835053444, 15.229153335094452, 17.70192576944828, 18.043139532208443, 18.14008841663599, 16.98372109234333, 12.413543999195099, 10.527983494102955, 14.404561519622803, 16.696964114904404, 17.338364891707897, 17.887107096612453, 17.4583710283041, 13.304017648100853, 11.154027931392193, 14.981887474656105, 17.11636095494032, 18.079796209931374, 18.69554079324007, 18.315253719687462, 14.216799356043339, 12.48781394585967, 15.882665298879147, 18.60196151584387, 19.353284761309624, 19.64086900651455, 19.399505615234375, 15.415731601417065, 13.182983301579952, 16.98788719624281, 19.814239136874676, 20.156646735966206, 20.287860937416553, 20.67253517359495, 16.595129013061523, 13.685936324298382, 17.678783610463142, 19.932247020304203, 20.769794210791588, 21.336316011846066, 20.67062472552061, 16.035112239420414, 13.126901179552078, 17.115927830338478, 20.030398204922676, 20.6849754601717, 20.746139965951443, 20.276880614459515, 15.715910769999027, 13.773472405970097, 17.74134685844183, 20.471044301986694, 21.68414042890072, 22.248792432248592, 22.159325890243053, 17.990858882665634, 14.58618200570345, 18.259858682751656, 19.95789261162281, 20.195684418082237, 20.305087111890316, 19.588159441947937, 14.805337846279144, 12.013879209756851, 15.349649794399738, 17.45544534176588, 17.89581774920225, 17.992771551012993, 17.56662928313017, 13.480096094310284, 11.04463842138648, 14.29145547002554, 16.640996880829334, 17.63893137127161, 18.03348294645548, 16.9892265945673, 12.48575484007597, 10.13594914227724, 12.97181335836649, 14.666277296841145, 15.037102535367012, 15.201483182609081, 14.326156802475452, 11.00250006467104, 8.88748973235488, 11.93162690103054, 13.447232730686665, 14.196032859385014, 13.666013389825821, 12.49571643024683, 9.174889076501131, 7.492522444576025, 9.70602535456419, 11.166977494955063, 11.916695609688759, 11.922122694551945, 11.46355602890253, 8.499375980347395, 7.439437314867973, 9.480189081281424, 11.492489740252495, 12.191342256963253, 12.281093582510948, 12.045323744416237, 8.776992574334145, 7.852589998394251, 9.78647505864501, 11.513971835374832, 12.395070441067219, 13.098351337015629, 13.437353305518627, 10.549596935510635, 8.959855206310749, 13.031393617391586, 15.15597440302372, 15.845031931996346, 16.378586776554585, 16.419320456683636, 12.598831973969936, 10.19476443529129, 14.034146025776863, 16.876884199678898, 18.407570242881775, 19.09802120178938, 19.28682614862919, 14.905986905097961, 12.584703154861927, 16.93003534525633, 19.261726208031178, 20.186830461025238, 20.831215657293797, 21.418860271573067, 16.780825182795525, 14.611214272677898, 18.835948422551155, 21.306382790207863, 22.04872216284275, 22.135316245257854, 21.920008048415184, 17.44380398839712, 14.617436401546001, 18.66330013424158, 21.47179952263832, 22.14024282246828, 22.361077718436718, 22.081451006233692, 17.06267821788788, 14.84079372137785, 19.026684679090977, 21.401801615953445, 22.226122736930847, 22.299306258559227, 22.167655780911446, 17.53834156692028, 14.031051777303219, 17.866882376372814, 20.45943584293127, 21.007314175367355, 20.928653851151466, 20.65192122757435, 15.94715652614832, 13.18804619461298, 17.16496380418539, 19.953189603984356, 21.09008253365755, 20.54711990058422, 20.163409948349, 15.459012895822525, 12.129675805568695, 16.07685288786888, 17.95203833281994, 18.00238724797964, 18.104183577001095, 17.702313400804996, 13.343351632356644, 11.020473316311836, 14.549754977226257, 17.279963195323944, 17.91608851402998, 18.542276956140995, 17.959922797977924, 13.885322608053684, 11.389239609241486, 15.609214961528778, 18.220778681337833, 19.192002557218075, 19.258091613650322, 18.558525294065475, 14.179496489465237, 12.293526098132133, 16.136313937604427, 18.55505957454443, 19.204778261482716, 19.079614497721195, 19.19134823232889, 15.833718918263912, 13.739331014454365, 18.180461898446083, 20.84554509818554, 21.707363210618496, 22.029897287487984, 22.045261465013027, 17.19802839308977, 14.69676025211811, 18.999063976109028, 21.434914402663708, 22.01942279189825, 22.52698204666376, 21.657750755548477, 16.292599089443684, 13.266923405230045, 16.774849340319633, 18.34498604387045, 18.57863662391901, 18.634407699108124, 17.867612093687057, 12.780604138970375, 10.617520526051521, 14.063436269760132, 15.865088172256947, 16.089689664542675, 16.452495954930782, 15.535023756325245, 11.091244645416737, 9.4948178678751, 12.176887229084969, 14.026080951094627, 14.485803492367268, 14.25455018132925, 13.574372790753841, 10.019216060638428, 8.338415030390024, 10.49638555943966, 11.955912604928017, 12.35745607689023, 12.374576829373837, 11.880997821688652], "mode": "lines+markers", "name": "prediction"}, {"type": "scatter", "x": ["2016-01-02", "2016-01-03", "2016-01-04", "2016-01-05", "2016-01-06", "2016-01-07", "2016-01-08", "2016-01-09", "2016-01-10", "2016-01-11", "2016-01-12", "2016-01-13", "2016-01-14", "2016-01-15", "2016-01-16", "2016-01-17", "2016-01-18", "2016-01-19", "2016-01-20", "2016-01-21", "2016-01-22", "2016-01-23", "2016-01-24", "2016-01-25", "2016-01-26", "2016-01-27", "2016-01-28", "2016-01-29", "2016-01-30", "2016-01-31", "2016-02-01", "2016-02-02", "2016-02-03", "2016-02-04", "2016-02-05", "2016-02-06", "2016-02-07", "2016-02-08", "2016-02-09", "2016-02-10", "2016-02-11", "2016-02-12", "2016-02-13", "2016-02-14", "2016-02-15", "2016-02-16", "2016-02-17", "2016-02-18", "2016-02-19", "2016-02-20", "2016-02-21", "2016-02-22", "2016-02-23", "2016-02-24", "2016-02-25", "2016-02-26", "2016-02-27", "2016-02-28", "2016-02-29", "2016-03-01", "2016-03-02", "2016-03-03", "2016-03-04", "2016-03-05", "2016-03-06", "2016-03-07", "2016-03-08", "2016-03-09", "2016-03-10", "2016-03-11", "2016-03-12", "2016-03-13", "2016-03-14", "2016-03-15", "2016-03-16", "2016-03-17", "2016-03-18", "2016-03-19", "2016-03-20", "2016-03-21", "2016-03-22", "2016-03-23", "2016-03-24", "2016-03-25", "2016-03-26", "2016-03-27", "2016-03-28", "2016-03-29", "2016-03-30", "2016-03-31", "2016-04-01", "2016-04-02", "2016-04-03", "2016-04-04", "2016-04-05", "2016-04-06", "2016-04-07", "2016-04-08", "2016-04-09", "2016-04-10", "2016-04-11", "2016-04-12", "2016-04-13", "2016-04-14", "2016-04-15", "2016-04-16", "2016-04-17", "2016-04-18", "2016-04-19", "2016-04-20", "2016-04-21", "2016-04-22", "2016-04-23", "2016-04-24", "2016-04-25", "2016-04-26", "2016-04-27", "2016-04-28", "2016-04-29", "2016-04-30", "2016-05-01", "2016-05-02", "2016-05-03", "2016-05-04", "2016-05-05", "2016-05-06", "2016-05-07", "2016-05-08", "2016-05-09", "2016-05-10", "2016-05-11", "2016-05-12", "2016-05-13", "2016-05-14", "2016-05-15", "2016-05-16", "2016-05-17", "2016-05-18", "2016-05-19", "2016-05-20", "2016-05-21", "2016-05-22", "2016-05-23", "2016-05-24", "2016-05-25", "2016-05-26", "2016-05-27", "2016-05-28", "2016-05-29", "2016-05-30", "2016-05-31", "2016-06-01", "2016-06-02", "2016-06-03", "2016-06-04", "2016-06-05", "2016-06-06", "2016-06-07", "2016-06-08", "2016-06-09", "2016-06-10", "2016-06-11", "2016-06-12", "2016-06-13", "2016-06-14", "2016-06-15", "2016-06-16", "2016-06-17", "2016-06-18", "2016-06-19", "2016-06-20", "2016-06-21", "2016-06-22", "2016-06-23", "2016-06-24", "2016-06-25", "2016-06-26", "2016-06-27", "2016-06-28", "2016-06-29", "2016-06-30", "2016-07-01", "2016-07-02", "2016-07-03", "2016-07-04", "2016-07-05", "2016-07-06", "2016-07-07", "2016-07-08", "2016-07-09", "2016-07-10", "2016-07-11", "2016-07-12", "2016-07-13", "2016-07-14", "2016-07-15", "2016-07-16", "2016-07-17", "2016-07-18", "2016-07-19", "2016-07-20", "2016-07-21", "2016-07-22", "2016-07-23", "2016-07-24", "2016-07-25", "2016-07-26", "2016-07-27", "2016-07-28", "2016-07-29", "2016-07-30", "2016-07-31", "2016-08-01", "2016-08-02", "2016-08-03", "2016-08-04", "2016-08-05", "2016-08-06", "2016-08-07", "2016-08-08", "2016-08-09", "2016-08-10", "2016-08-11", "2016-08-12", "2016-08-13", "2016-08-14", "2016-08-15", "2016-08-16", "2016-08-17", "2016-08-18", "2016-08-19", "2016-08-20", "2016-08-21", "2016-08-22", "2016-08-23", "2016-08-24", "2016-08-25", "2016-08-26", "2016-08-27", "2016-08-28", "2016-08-29", "2016-08-30", "2016-08-31", "2016-09-01", "2016-09-02", "2016-09-03", "2016-09-04", "2016-09-05", "2016-09-06", "2016-09-07", "2016-09-08", "2016-09-09", "2016-09-10", "2016-09-11", "2016-09-12", "2016-09-13", "2016-09-14", "2016-09-15", "2016-09-16", "2016-09-17", "2016-09-18", "2016-09-19", "2016-09-20", "2016-09-21", "2016-09-22", "2016-09-23", "2016-09-24", "2016-09-25", "2016-09-26", "2016-09-27", "2016-09-28", "2016-09-29", "2016-09-30", "2016-10-01", "2016-10-02", "2016-10-03", "2016-10-04", "2016-10-05", "2016-10-06", "2016-10-07", "2016-10-08", "2016-10-09", "2016-10-10", "2016-10-11", "2016-10-12", "2016-10-13", "2016-10-14", "2016-10-15", "2016-10-16", "2016-10-17", "2016-10-18", "2016-10-19", "2016-10-20", "2016-10-21", "2016-10-22", "2016-10-23", "2016-10-24", "2016-10-25", "2016-10-26", "2016-10-27", "2016-10-28", "2016-10-29", "2016-10-30", "2016-10-31", "2016-11-01", "2016-11-02", "2016-11-03", "2016-11-04", "2016-11-05", "2016-11-06", "2016-11-07", "2016-11-08", "2016-11-09", "2016-11-10", "2016-11-11", "2016-11-12", "2016-11-13", "2016-11-14", "2016-11-15", "2016-11-16", "2016-11-17", "2016-11-18", "2016-11-19", "2016-11-20", "2016-11-21", "2016-11-22", "2016-11-23", "2016-11-24", "2016-11-25", "2016-11-26", "2016-11-27", "2016-11-28", "2016-11-29", "2016-11-30", "2016-12-01", "2016-12-02", "2016-12-03", "2016-12-04", "2016-12-05", "2016-12-06", "2016-12-07", "2016-12-08", "2016-12-09", "2016-12-10", "2016-12-11", "2016-12-12", "2016-12-13", "2016-12-14", "2016-12-15", "2016-12-16", "2016-12-17", "2016-12-18", "2016-12-19", "2016-12-20", "2016-12-21", "2016-12-22", "2016-12-23", "2016-12-24", "2016-12-25", "2016-12-26", "2016-12-27", "2016-12-28", "2016-12-29", "2016-12-30", "2016-12-31"], "y": [6.0, 7.0, 10.0, 11.0, 27.0, 18.0, 23.0, 15.0, 11.0, 9.0, 13.0, 14.0, 14.0, 24.0, 16.0, 15.0, 9.0, 8.0, 21.0, 20.0, 25.0, 25.0, 12.0, 11.0, 18.0, 21.0, 17.0, 24.0, 17.0, 12.0, 14.0, 20.0, 17.0, 28.0, 15.0, 10.0, 15.0, 11.0, 20.0, 20.0, 16.0, 16.0, 22.0, 13.0, 9.0, 14.0, 20.0, 19.0, 24.0, 17.0, 16.0, 11.0, 12.0, 15.0, 10.0, 11.0, 18.0, 12.0, 5.0, 16.0, 23.0, 24.0, 20.0, 23.0, 22.0, 12.0, 16.0, 24.0, 15.0, 13.0, 20.0, 15.0, 9.0, 14.0, 12.0, 15.0, 19.0, 18.0, 10.0, 11.0, 11.0, 19.0, 16.0, 27.0, 25.0, 7.0, 17.0, 9.0, 19.0, 19.0, 19.0, 18.0, 7.0, 16.0, 19.0, 19.0, 20.0, 25.0, 22.0, 17.0, 11.0, 24.0, 11.0, 21.0, 31.0, 19.0, 12.0, 15.0, 13.0, 12.0, 16.0, 18.0, 9.0, 14.0, 3.0, 13.0, 14.0, 12.0, 21.0, 14.0, 15.0, 11.0, 16.0, 23.0, 19.0, 16.0, 12.0, 10.0, 21.0, 17.0, 27.0, 21.0, 13.0, 15.0, 12.0, 17.0, 24.0, 18.0, 23.0, 23.0, 19.0, 17.0, 15.0, 24.0, 11.0, 23.0, 20.0, 22.0, 16.0, 11.0, 23.0, 21.0, 21.0, 16.0, 17.0, 14.0, 6.0, 11.0, 20.0, 19.0, 26.0, 28.0, 12.0, 14.0, 13.0, 18.0, 26.0, 23.0, 17.0, 17.0, 18.0, 15.0, 14.0, 23.0, 26.0, 18.0, 19.0, 24.0, 18.0, 24.0, 26.0, 24.0, 21.0, 18.0, 12.0, 19.0, 22.0, 26.0, 26.0, 17.0, 15.0, 20.0, 33.0, 19.0, 20.0, 6.0, 14.0, 11.0, 11.0, 14.0, 16.0, 18.0, 14.0, 18.0, 14.0, 11.0, 27.0, 19.0, 17.0, 18.0, 17.0, 13.0, 10.0, 15.0, 13.0, 18.0, 15.0, 8.0, 13.0, 10.0, 9.0, 6.0, 13.0, 2.0, 10.0, 7.0, 7.0, 3.0, 11.0, 4.0, 13.0, 8.0, 10.0, 10.0, 14.0, 19.0, 15.0, 21.0, 10.0, 10.0, 11.0, 11.0, 18.0, 14.0, 16.0, 23.0, 9.0, 14.0, 28.0, 17.0, 26.0, 19.0, 22.0, 19.0, 11.0, 16.0, 22.0, 26.0, 21.0, 19.0, 15.0, 10.0, 16.0, 9.0, 24.0, 23.0, 21.0, 18.0, 9.0, 18.0, 19.0, 15.0, 18.0, 22.0, 17.0, 13.0, 17.0, 22.0, 9.0, 42.0, 17.0, 17.0, 15.0, 23.0, 26.0, 18.0, 29.0, 28.0, 14.0, 14.0, 18.0, 21.0, 23.0, 22.0, 16.0, 10.0, 17.0, 18.0, 17.0, 16.0, 16.0, 15.0, 13.0, 9.0, 23.0, 14.0, 23.0, 13.0, 29.0, 14.0, 12.0, 16.0, 16.0, 26.0, 30.0, 14.0, 17.0, 9.0, 19.0, 19.0, 20.0, 30.0, 22.0, 18.0, 15.0, 20.0, 11.0, 22.0, 13.0, 17.0, 12.0, 15.0, 19.0, 27.0, 25.0, 23.0, 22.0, 13.0, 8.0, 16.0, 15.0, 13.0, 19.0, 13.0, 15.0, 8.0, 17.0, 23.0, 17.0, 19.0, 17.0, 10.0, 5.0, 13.0, 9.0, 16.0, 25.0, 15.0, 10.0, 8.0, 16.0, 17.0, 11.0, 11.0, 13.0], "mode": "lines+markers", "name": "target"}] , {}, {"showLink": true, "linkText": "Export to plot.ly"})</script><script type="text/javascript">window.addEventListener("resize", function(){Plotly.Plots.resize(document.getElementById("21d4d405-eb35-4707-9fda-7393d0b88ffb"));});</script></body></html>
</div>

<pre><code class="language-python"># Evaluating:
y_predict =( long_term_prediction(nmodel , X[- ntest_day:] , 19)* maxes).sum(axis = 1)
y_true = (Y[- ntest_day:] * maxes).sum(axis = 1)
    
evaluate(y_true , y_predict , cdtsers.day[-365:])
</code></pre>

<pre><code>Mean Absolute Error   : 3.61
Root Mean Square Error: 4.82
Mean Percentage Error : 0.25
Error Density :
</code></pre>

<p><img src="/accidents/output_66_1.png" alt="png" /></p>

<pre><code>Mean Error                       : 0.92
True Value And error Correlation : 0.78
</code></pre>

<div>
<html><head><meta charset="utf-8" /></head><body><div id="ecc742c7-32a5-40be-94fd-43ba13cc14f2" style="height: 100%; width: 100%;" class="plotly-graph-div"></div><script type="text/javascript">window.PLOTLYENV=window.PLOTLYENV || {};window.PLOTLYENV.BASE_URL="https://plot.ly";Plotly.newPlot("ecc742c7-32a5-40be-94fd-43ba13cc14f2", [{"type": "scatter", "x": ["2016-01-02", "2016-01-03", "2016-01-04", "2016-01-05", "2016-01-06", "2016-01-07", "2016-01-08", "2016-01-09", "2016-01-10", "2016-01-11", "2016-01-12", "2016-01-13", "2016-01-14", "2016-01-15", "2016-01-16", "2016-01-17", "2016-01-18", "2016-01-19", "2016-01-20", "2016-01-21", "2016-01-22", "2016-01-23", "2016-01-24", "2016-01-25", "2016-01-26", "2016-01-27", "2016-01-28", "2016-01-29", "2016-01-30", "2016-01-31", "2016-02-01", "2016-02-02", "2016-02-03", "2016-02-04", "2016-02-05", "2016-02-06", "2016-02-07", "2016-02-08", "2016-02-09", "2016-02-10", "2016-02-11", "2016-02-12", "2016-02-13", "2016-02-14", "2016-02-15", "2016-02-16", "2016-02-17", "2016-02-18", "2016-02-19", "2016-02-20", "2016-02-21", "2016-02-22", "2016-02-23", "2016-02-24", "2016-02-25", "2016-02-26", "2016-02-27", "2016-02-28", "2016-02-29", "2016-03-01", "2016-03-02", "2016-03-03", "2016-03-04", "2016-03-05", "2016-03-06", "2016-03-07", "2016-03-08", "2016-03-09", "2016-03-10", "2016-03-11", "2016-03-12", "2016-03-13", "2016-03-14", "2016-03-15", "2016-03-16", "2016-03-17", "2016-03-18", "2016-03-19", "2016-03-20", "2016-03-21", "2016-03-22", "2016-03-23", "2016-03-24", "2016-03-25", "2016-03-26", "2016-03-27", "2016-03-28", "2016-03-29", "2016-03-30", "2016-03-31", "2016-04-01", "2016-04-02", "2016-04-03", "2016-04-04", "2016-04-05", "2016-04-06", "2016-04-07", "2016-04-08", "2016-04-09", "2016-04-10", "2016-04-11", "2016-04-12", "2016-04-13", "2016-04-14", "2016-04-15", "2016-04-16", "2016-04-17", "2016-04-18", "2016-04-19", "2016-04-20", "2016-04-21", "2016-04-22", "2016-04-23", "2016-04-24", "2016-04-25", "2016-04-26", "2016-04-27", "2016-04-28", "2016-04-29", "2016-04-30", "2016-05-01", "2016-05-02", "2016-05-03", "2016-05-04", "2016-05-05", "2016-05-06", "2016-05-07", "2016-05-08", "2016-05-09", "2016-05-10", "2016-05-11", "2016-05-12", "2016-05-13", "2016-05-14", "2016-05-15", "2016-05-16", "2016-05-17", "2016-05-18", "2016-05-19", "2016-05-20", "2016-05-21", "2016-05-22", "2016-05-23", "2016-05-24", "2016-05-25", "2016-05-26", "2016-05-27", "2016-05-28", "2016-05-29", "2016-05-30", "2016-05-31", "2016-06-01", "2016-06-02", "2016-06-03", "2016-06-04", "2016-06-05", "2016-06-06", "2016-06-07", "2016-06-08", "2016-06-09", "2016-06-10", "2016-06-11", "2016-06-12", "2016-06-13", "2016-06-14", "2016-06-15", "2016-06-16", "2016-06-17", "2016-06-18", "2016-06-19", "2016-06-20", "2016-06-21", "2016-06-22", "2016-06-23", "2016-06-24", "2016-06-25", "2016-06-26", "2016-06-27", "2016-06-28", "2016-06-29", "2016-06-30", "2016-07-01", "2016-07-02", "2016-07-03", "2016-07-04", "2016-07-05", "2016-07-06", "2016-07-07", "2016-07-08", "2016-07-09", "2016-07-10", "2016-07-11", "2016-07-12", "2016-07-13", "2016-07-14", "2016-07-15", "2016-07-16", "2016-07-17", "2016-07-18", "2016-07-19", "2016-07-20", "2016-07-21", "2016-07-22", "2016-07-23", "2016-07-24", "2016-07-25", "2016-07-26", "2016-07-27", "2016-07-28", "2016-07-29", "2016-07-30", "2016-07-31", "2016-08-01", "2016-08-02", "2016-08-03", "2016-08-04", "2016-08-05", "2016-08-06", "2016-08-07", "2016-08-08", "2016-08-09", "2016-08-10", "2016-08-11", "2016-08-12", "2016-08-13", "2016-08-14", "2016-08-15", "2016-08-16", "2016-08-17", "2016-08-18", "2016-08-19", "2016-08-20", "2016-08-21", "2016-08-22", "2016-08-23", "2016-08-24", "2016-08-25", "2016-08-26", "2016-08-27", "2016-08-28", "2016-08-29", "2016-08-30", "2016-08-31", "2016-09-01", "2016-09-02", "2016-09-03", "2016-09-04", "2016-09-05", "2016-09-06", "2016-09-07", "2016-09-08", "2016-09-09", "2016-09-10", "2016-09-11", "2016-09-12", "2016-09-13", "2016-09-14", "2016-09-15", "2016-09-16", "2016-09-17", "2016-09-18", "2016-09-19", "2016-09-20", "2016-09-21", "2016-09-22", "2016-09-23", "2016-09-24", "2016-09-25", "2016-09-26", "2016-09-27", "2016-09-28", "2016-09-29", "2016-09-30", "2016-10-01", "2016-10-02", "2016-10-03", "2016-10-04", "2016-10-05", "2016-10-06", "2016-10-07", "2016-10-08", "2016-10-09", "2016-10-10", "2016-10-11", "2016-10-12", "2016-10-13", "2016-10-14", "2016-10-15", "2016-10-16", "2016-10-17", "2016-10-18", "2016-10-19", "2016-10-20", "2016-10-21", "2016-10-22", "2016-10-23", "2016-10-24", "2016-10-25", "2016-10-26", "2016-10-27", "2016-10-28", "2016-10-29", "2016-10-30", "2016-10-31", "2016-11-01", "2016-11-02", "2016-11-03", "2016-11-04", "2016-11-05", "2016-11-06", "2016-11-07", "2016-11-08", "2016-11-09", "2016-11-10", "2016-11-11", "2016-11-12", "2016-11-13", "2016-11-14", "2016-11-15", "2016-11-16", "2016-11-17", "2016-11-18", "2016-11-19", "2016-11-20", "2016-11-21", "2016-11-22", "2016-11-23", "2016-11-24", "2016-11-25", "2016-11-26", "2016-11-27", "2016-11-28", "2016-11-29", "2016-11-30", "2016-12-01", "2016-12-02", "2016-12-03", "2016-12-04", "2016-12-05", "2016-12-06", "2016-12-07", "2016-12-08", "2016-12-09", "2016-12-10", "2016-12-11", "2016-12-12", "2016-12-13", "2016-12-14", "2016-12-15", "2016-12-16", "2016-12-17", "2016-12-18", "2016-12-19", "2016-12-20", "2016-12-21", "2016-12-22", "2016-12-23", "2016-12-24", "2016-12-25", "2016-12-26", "2016-12-27", "2016-12-28", "2016-12-29", "2016-12-30", "2016-12-31"], "y": [11.044755157083273, 7.78149288892746, 7.41729362308979, 9.930862907320261, 12.051270313560963, 12.99795088171959, 13.496487006545067, 14.338073618710041, 10.790301132947206, 9.36480612307787, 12.97999919950962, 14.904532503336668, 15.667144551873207, 16.109941840171814, 16.01910913735628, 12.13302606716752, 9.758954595774412, 13.349193572998047, 15.683913946151733, 16.766720451414585, 16.930081866681576, 17.166499979794025, 13.12923926115036, 11.012135289609432, 14.712611258029938, 17.02094804495573, 18.158295333385468, 19.20600824058056, 19.098010040819645, 14.830580040812492, 12.76689201593399, 17.145351350307465, 19.785949409008026, 19.711649909615517, 19.78383482992649, 19.221904657781124, 14.719076924026012, 11.93838419765234, 15.508409179747105, 18.317708529531956, 18.861941069364548, 19.25565081089735, 18.85759476572275, 14.683875113725662, 11.693440347909927, 14.945695340633392, 17.18753097206354, 18.355065777897835, 18.703564547002316, 18.108530044555664, 13.45511880517006, 10.868865706026554, 14.238453403115273, 15.927897155284882, 16.495884530246258, 16.77391505986452, 16.028772979974747, 11.891113884747028, 10.196526661515236, 13.172244787216187, 15.240033142268658, 15.792000032961369, 15.933597803115845, 15.86727811396122, 11.872115857899189, 9.854550588876009, 13.088099829852581, 15.83287514001131, 17.059324763715267, 17.787684880197048, 17.369095534086227, 13.023827090859413, 11.172919005155563, 14.922200076282024, 17.681965813040733, 17.79466037452221, 17.778303764760494, 17.086514584720135, 12.628024995326996, 10.926212213933468, 14.155116699635983, 16.448354586958885, 17.10478876531124, 16.984852083027363, 16.442936681210995, 12.11137804389, 10.239217169582844, 13.947294168174267, 15.37747386842966, 15.596610210835934, 15.727324157953262, 15.347558863461018, 11.42710056528449, 9.84423777461052, 12.57003878429532, 14.467243924736977, 14.645272001624107, 15.91058761626482, 15.974352084100246, 11.862914368510246, 9.793087478727102, 13.66360555589199, 15.863937370479107, 16.697670243680477, 17.591055780649185, 16.942025370895863, 12.232236348092556, 10.075171895325184, 14.100779935717583, 16.511803776025772, 17.61491196602583, 18.21421042084694, 17.34606744349003, 12.411413542926311, 9.963170390576124, 13.188133373856544, 15.626398861408234, 16.279576636850834, 16.60964409261942, 17.22223625332117, 13.159334570169449, 11.00467898324132, 13.917222879827023, 16.673591621220112, 17.896163776516914, 18.802213072776794, 18.667147859930992, 14.200911477208138, 11.355280745774508, 15.09475114196539, 17.416184693574905, 18.115108370780945, 17.92979423701763, 17.028167709708214, 12.455697633326054, 10.418846983462572, 14.401282660663128, 16.533377803862095, 17.330275237560272, 17.75089879333973, 17.51395234465599, 13.426557555794716, 11.074082680046558, 14.977891869843006, 17.140259355306625, 18.095469929277897, 18.837897434830666, 18.14565020799637, 13.970835529267788, 12.569283653050661, 15.69767789542675, 18.63866215199232, 19.287942461669445, 19.640343569219112, 19.32901695370674, 15.486687399446964, 13.11573839187622, 16.888820439577103, 20.05597124993801, 20.409703098237514, 20.392974518239498, 20.61827677488327, 16.60280741751194, 13.68637616187334, 17.687629155814648, 19.825294502079487, 20.728667981922626, 21.228537030518055, 20.74630668759346, 15.861853994429111, 13.067880742251873, 17.19179854542017, 19.987333938479424, 20.82179895788431, 20.841119319200516, 20.12491063028574, 15.616575829684734, 13.593944534659386, 17.48512514680624, 20.342259481549263, 21.65799555927515, 22.17244505137205, 21.964574716985226, 17.905847437679768, 14.701831310987473, 18.07426568865776, 20.11330045759678, 20.319544561207294, 20.42932979017496, 19.4242445230484, 14.829991169273853, 12.143132500350475, 15.333210095763206, 17.516774781048298, 17.73723518103361, 18.12990491092205, 17.499995209276676, 13.609346382319927, 11.046054236590862, 14.280691310763359, 16.68847393244505, 17.56101305037737, 17.78063714504242, 17.184043489396572, 12.591019168496132, 10.122397858649492, 12.89997099339962, 14.729683458805084, 14.888421699404716, 15.102896511554718, 14.353817641735077, 11.01186154782772, 8.829858981072903, 11.808221340179443, 13.426637209951878, 14.05607546120882, 13.723039537668228, 12.516718119382858, 9.161306578665972, 7.497777082026005, 9.757049679756165, 11.150691643357277, 11.848260827362537, 12.06178468465805, 11.478542655706406, 8.521600969135761, 7.422071360051632, 9.480981826782227, 11.631300501525402, 12.234841033816338, 12.248731397092342, 12.139078088104725, 8.858829416334629, 7.817698270082474, 9.804048374295235, 11.522801123559475, 12.429258055984974, 13.154653646051884, 13.51850925385952, 10.231254801154137, 8.956083502620459, 13.061806723475456, 15.07001929730177, 16.00636624544859, 16.265092194080353, 16.481187649071217, 12.708219781517982, 10.024075418710709, 14.005316451191902, 16.787822030484676, 18.15871922671795, 19.192412242293358, 19.3798835426569, 15.163999170064926, 12.368894450366497, 16.79176051914692, 19.419397592544556, 20.139647483825684, 20.680663123726845, 21.125060960650444, 16.85206437110901, 14.55598447471857, 18.95303536206484, 21.386946871876717, 22.16859056800604, 22.23811035603285, 21.705125734210014, 17.368403613567352, 14.446430370211601, 18.468714468181133, 21.634746178984642, 22.25639983266592, 22.483425728976727, 22.365894116461277, 17.152139969170094, 14.817513577640057, 18.86574574559927, 21.587946519255638, 22.385451644659042, 22.113032162189484, 22.418991819024086, 17.001819275319576, 14.11201723664999, 17.871333725750446, 20.310761533677578, 20.914062172174454, 20.770100452005863, 20.711550012230873, 15.72742935270071, 13.08948490023613, 17.04919021576643, 20.09917663782835, 21.193063154816628, 20.789084941148758, 20.093626871705055, 15.533448904752731, 12.162099942564964, 16.02233750373125, 17.846328526735306, 18.118076503276825, 17.915380083024502, 17.7843504473567, 13.343767158687115, 10.940857838839293, 14.493402689695358, 17.340813905000687, 17.62145870178938, 18.45090527832508, 17.964931540191174, 13.946033008396626, 11.200403556227684, 15.586307294666767, 18.16024822741747, 19.18029061704874, 19.38041316717863, 18.647780992090702, 14.104350209236145, 12.253517039120197, 15.945588059723377, 18.64250310510397, 18.98956587165594, 19.20204707980156, 19.07253322005272, 15.491112984716892, 13.327238038182259, 18.078251034021378, 20.826468519866467, 21.8036455437541, 22.28206282109022, 21.993809148669243, 17.54974737763405, 14.688523836433887, 19.058909490704536, 21.601933658123016, 22.080439999699593, 22.52554240822792, 21.545287758111954, 16.099770702421665, 12.9932427033782, 16.894266687333584, 18.617317646741867, 18.704524472355843, 18.5306708663702, 17.855034790933132, 12.956095851957798, 10.643451895564795, 13.918666623532772, 15.979018799960613, 16.16930892318487, 16.149858057498932, 15.415499731898308, 11.221635535359383, 9.332754410803318, 12.294767126441002, 14.144898615777493, 14.48809089511633, 14.440487250685692, 13.586475186049938, 10.017527185380459, 8.3861034065485, 10.44961304590106, 11.970543913543224, 12.200309552252293, 12.348746258765459, 11.8786467500031], "mode": "lines+markers", "name": "prediction"}, {"type": "scatter", "x": ["2016-01-02", "2016-01-03", "2016-01-04", "2016-01-05", "2016-01-06", "2016-01-07", "2016-01-08", "2016-01-09", "2016-01-10", "2016-01-11", "2016-01-12", "2016-01-13", "2016-01-14", "2016-01-15", "2016-01-16", "2016-01-17", "2016-01-18", "2016-01-19", "2016-01-20", "2016-01-21", "2016-01-22", "2016-01-23", "2016-01-24", "2016-01-25", "2016-01-26", "2016-01-27", "2016-01-28", "2016-01-29", "2016-01-30", "2016-01-31", "2016-02-01", "2016-02-02", "2016-02-03", "2016-02-04", "2016-02-05", "2016-02-06", "2016-02-07", "2016-02-08", "2016-02-09", "2016-02-10", "2016-02-11", "2016-02-12", "2016-02-13", "2016-02-14", "2016-02-15", "2016-02-16", "2016-02-17", "2016-02-18", "2016-02-19", "2016-02-20", "2016-02-21", "2016-02-22", "2016-02-23", "2016-02-24", "2016-02-25", "2016-02-26", "2016-02-27", "2016-02-28", "2016-02-29", "2016-03-01", "2016-03-02", "2016-03-03", "2016-03-04", "2016-03-05", "2016-03-06", "2016-03-07", "2016-03-08", "2016-03-09", "2016-03-10", "2016-03-11", "2016-03-12", "2016-03-13", "2016-03-14", "2016-03-15", "2016-03-16", "2016-03-17", "2016-03-18", "2016-03-19", "2016-03-20", "2016-03-21", "2016-03-22", "2016-03-23", "2016-03-24", "2016-03-25", "2016-03-26", "2016-03-27", "2016-03-28", "2016-03-29", "2016-03-30", "2016-03-31", "2016-04-01", "2016-04-02", "2016-04-03", "2016-04-04", "2016-04-05", "2016-04-06", "2016-04-07", "2016-04-08", "2016-04-09", "2016-04-10", "2016-04-11", "2016-04-12", "2016-04-13", "2016-04-14", "2016-04-15", "2016-04-16", "2016-04-17", "2016-04-18", "2016-04-19", "2016-04-20", "2016-04-21", "2016-04-22", "2016-04-23", "2016-04-24", "2016-04-25", "2016-04-26", "2016-04-27", "2016-04-28", "2016-04-29", "2016-04-30", "2016-05-01", "2016-05-02", "2016-05-03", "2016-05-04", "2016-05-05", "2016-05-06", "2016-05-07", "2016-05-08", "2016-05-09", "2016-05-10", "2016-05-11", "2016-05-12", "2016-05-13", "2016-05-14", "2016-05-15", "2016-05-16", "2016-05-17", "2016-05-18", "2016-05-19", "2016-05-20", "2016-05-21", "2016-05-22", "2016-05-23", "2016-05-24", "2016-05-25", "2016-05-26", "2016-05-27", "2016-05-28", "2016-05-29", "2016-05-30", "2016-05-31", "2016-06-01", "2016-06-02", "2016-06-03", "2016-06-04", "2016-06-05", "2016-06-06", "2016-06-07", "2016-06-08", "2016-06-09", "2016-06-10", "2016-06-11", "2016-06-12", "2016-06-13", "2016-06-14", "2016-06-15", "2016-06-16", "2016-06-17", "2016-06-18", "2016-06-19", "2016-06-20", "2016-06-21", "2016-06-22", "2016-06-23", "2016-06-24", "2016-06-25", "2016-06-26", "2016-06-27", "2016-06-28", "2016-06-29", "2016-06-30", "2016-07-01", "2016-07-02", "2016-07-03", "2016-07-04", "2016-07-05", "2016-07-06", "2016-07-07", "2016-07-08", "2016-07-09", "2016-07-10", "2016-07-11", "2016-07-12", "2016-07-13", "2016-07-14", "2016-07-15", "2016-07-16", "2016-07-17", "2016-07-18", "2016-07-19", "2016-07-20", "2016-07-21", "2016-07-22", "2016-07-23", "2016-07-24", "2016-07-25", "2016-07-26", "2016-07-27", "2016-07-28", "2016-07-29", "2016-07-30", "2016-07-31", "2016-08-01", "2016-08-02", "2016-08-03", "2016-08-04", "2016-08-05", "2016-08-06", "2016-08-07", "2016-08-08", "2016-08-09", "2016-08-10", "2016-08-11", "2016-08-12", "2016-08-13", "2016-08-14", "2016-08-15", "2016-08-16", "2016-08-17", "2016-08-18", "2016-08-19", "2016-08-20", "2016-08-21", "2016-08-22", "2016-08-23", "2016-08-24", "2016-08-25", "2016-08-26", "2016-08-27", "2016-08-28", "2016-08-29", "2016-08-30", "2016-08-31", "2016-09-01", "2016-09-02", "2016-09-03", "2016-09-04", "2016-09-05", "2016-09-06", "2016-09-07", "2016-09-08", "2016-09-09", "2016-09-10", "2016-09-11", "2016-09-12", "2016-09-13", "2016-09-14", "2016-09-15", "2016-09-16", "2016-09-17", "2016-09-18", "2016-09-19", "2016-09-20", "2016-09-21", "2016-09-22", "2016-09-23", "2016-09-24", "2016-09-25", "2016-09-26", "2016-09-27", "2016-09-28", "2016-09-29", "2016-09-30", "2016-10-01", "2016-10-02", "2016-10-03", "2016-10-04", "2016-10-05", "2016-10-06", "2016-10-07", "2016-10-08", "2016-10-09", "2016-10-10", "2016-10-11", "2016-10-12", "2016-10-13", "2016-10-14", "2016-10-15", "2016-10-16", "2016-10-17", "2016-10-18", "2016-10-19", "2016-10-20", "2016-10-21", "2016-10-22", "2016-10-23", "2016-10-24", "2016-10-25", "2016-10-26", "2016-10-27", "2016-10-28", "2016-10-29", "2016-10-30", "2016-10-31", "2016-11-01", "2016-11-02", "2016-11-03", "2016-11-04", "2016-11-05", "2016-11-06", "2016-11-07", "2016-11-08", "2016-11-09", "2016-11-10", "2016-11-11", "2016-11-12", "2016-11-13", "2016-11-14", "2016-11-15", "2016-11-16", "2016-11-17", "2016-11-18", "2016-11-19", "2016-11-20", "2016-11-21", "2016-11-22", "2016-11-23", "2016-11-24", "2016-11-25", "2016-11-26", "2016-11-27", "2016-11-28", "2016-11-29", "2016-11-30", "2016-12-01", "2016-12-02", "2016-12-03", "2016-12-04", "2016-12-05", "2016-12-06", "2016-12-07", "2016-12-08", "2016-12-09", "2016-12-10", "2016-12-11", "2016-12-12", "2016-12-13", "2016-12-14", "2016-12-15", "2016-12-16", "2016-12-17", "2016-12-18", "2016-12-19", "2016-12-20", "2016-12-21", "2016-12-22", "2016-12-23", "2016-12-24", "2016-12-25", "2016-12-26", "2016-12-27", "2016-12-28", "2016-12-29", "2016-12-30", "2016-12-31"], "y": [6.0, 7.0, 10.0, 11.0, 27.0, 18.0, 23.0, 15.0, 11.0, 9.0, 13.0, 14.0, 14.0, 24.0, 16.0, 15.0, 9.0, 8.0, 21.0, 20.0, 25.0, 25.0, 12.0, 11.0, 18.0, 21.0, 17.0, 24.0, 17.0, 12.0, 14.0, 20.0, 17.0, 28.0, 15.0, 10.0, 15.0, 11.0, 20.0, 20.0, 16.0, 16.0, 22.0, 13.0, 9.0, 14.0, 20.0, 19.0, 24.0, 17.0, 16.0, 11.0, 12.0, 15.0, 10.0, 11.0, 18.0, 12.0, 5.0, 16.0, 23.0, 24.0, 20.0, 23.0, 22.0, 12.0, 16.0, 24.0, 15.0, 13.0, 20.0, 15.0, 9.0, 14.0, 12.0, 15.0, 19.0, 18.0, 10.0, 11.0, 11.0, 19.0, 16.0, 27.0, 25.0, 7.0, 17.0, 9.0, 19.0, 19.0, 19.0, 18.0, 7.0, 16.0, 19.0, 19.0, 20.0, 25.0, 22.0, 17.0, 11.0, 24.0, 11.0, 21.0, 31.0, 19.0, 12.0, 15.0, 13.0, 12.0, 16.0, 18.0, 9.0, 14.0, 3.0, 13.0, 14.0, 12.0, 21.0, 14.0, 15.0, 11.0, 16.0, 23.0, 19.0, 16.0, 12.0, 10.0, 21.0, 17.0, 27.0, 21.0, 13.0, 15.0, 12.0, 17.0, 24.0, 18.0, 23.0, 23.0, 19.0, 17.0, 15.0, 24.0, 11.0, 23.0, 20.0, 22.0, 16.0, 11.0, 23.0, 21.0, 21.0, 16.0, 17.0, 14.0, 6.0, 11.0, 20.0, 19.0, 26.0, 28.0, 12.0, 14.0, 13.0, 18.0, 26.0, 23.0, 17.0, 17.0, 18.0, 15.0, 14.0, 23.0, 26.0, 18.0, 19.0, 24.0, 18.0, 24.0, 26.0, 24.0, 21.0, 18.0, 12.0, 19.0, 22.0, 26.0, 26.0, 17.0, 15.0, 20.0, 33.0, 19.0, 20.0, 6.0, 14.0, 11.0, 11.0, 14.0, 16.0, 18.0, 14.0, 18.0, 14.0, 11.0, 27.0, 19.0, 17.0, 18.0, 17.0, 13.0, 10.0, 15.0, 13.0, 18.0, 15.0, 8.0, 13.0, 10.0, 9.0, 6.0, 13.0, 2.0, 10.0, 7.0, 7.0, 3.0, 11.0, 4.0, 13.0, 8.0, 10.0, 10.0, 14.0, 19.0, 15.0, 21.0, 10.0, 10.0, 11.0, 11.0, 18.0, 14.0, 16.0, 23.0, 9.0, 14.0, 28.0, 17.0, 26.0, 19.0, 22.0, 19.0, 11.0, 16.0, 22.0, 26.0, 21.0, 19.0, 15.0, 10.0, 16.0, 9.0, 24.0, 23.0, 21.0, 18.0, 9.0, 18.0, 19.0, 15.0, 18.0, 22.0, 17.0, 13.0, 17.0, 22.0, 9.0, 42.0, 17.0, 17.0, 15.0, 23.0, 26.0, 18.0, 29.0, 28.0, 14.0, 14.0, 18.0, 21.0, 23.0, 22.0, 16.0, 10.0, 17.0, 18.0, 17.0, 16.0, 16.0, 15.0, 13.0, 9.0, 23.0, 14.0, 23.0, 13.0, 29.0, 14.0, 12.0, 16.0, 16.0, 26.0, 30.0, 14.0, 17.0, 9.0, 19.0, 19.0, 20.0, 30.0, 22.0, 18.0, 15.0, 20.0, 11.0, 22.0, 13.0, 17.0, 12.0, 15.0, 19.0, 27.0, 25.0, 23.0, 22.0, 13.0, 8.0, 16.0, 15.0, 13.0, 19.0, 13.0, 15.0, 8.0, 17.0, 23.0, 17.0, 19.0, 17.0, 10.0, 5.0, 13.0, 9.0, 16.0, 25.0, 15.0, 10.0, 8.0, 16.0, 17.0, 11.0, 11.0, 13.0], "mode": "lines+markers", "name": "target"}] , {}, {"showLink": true, "linkText": "Export to plot.ly"})</script><script type="text/javascript">window.addEventListener("resize", function(){Plotly.Plots.resize(document.getElementById("21d4d405-eb35-4707-9fda-7393d0b88ffb"));});</script></body></html>
</div>

<p>We get the same performance than the previous model, but we have an additional information which is the number of accidents per district.</p>

<h2 id="conclusion-next-steps">Conclusion &amp; Next steps.</h2>

<p>Using the power of Prophet and LSTMs, we were already able to gain much performance compared to the Naïve model. But there is still room for improvement:</p>

<ul>
<li>We can visualize the biggest differences returned by the model and try to understand them to extract more Insights and think about new variables/transformations to do on the data.</li>
<li>The idea I had, in the beginning, was to build a big neural network where each output neuron would represent a road in France. This would allow the network to learn the dependencies between roads and give us a precise location of future accidents. I still think that it can work and will probably implement it in the future.</li>
<li>I think it would be more beneficial for us to have an hourly model instead of a daily model. The code can easily be modified to make this change.</li>
<li>I&rsquo;m still trying to retrieve more data, especially traffic data, which will probably greatly improve the results.</li>
</ul>
</div>
            <div class="footer">
                <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

<script type="text/javascript">
    hljs.configure({languages: []});
    hljs.initHighlightingOnLoad();
</script>


        <h2>Comments</h2>
        <div id="disqus_thread"></div>
<script type="text/javascript">
      (function () {
            
            
            
            if (location.hostname === "localhost" || 
            	location.hostname === "127.0.0.1" || 
            	location.hostname === "") {
                return;
			}
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            var disqus_shortname = 'ahmedlahlou';
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(
                  dsq);
      })();
</script>

<noscript>
	Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      

            </div>
        </div>
        
        
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-119861753-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>
        
    </body>
</html>
